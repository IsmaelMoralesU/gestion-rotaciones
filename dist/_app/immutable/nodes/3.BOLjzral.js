var zs=Object.defineProperty,Fs=Object.defineProperties;var Bs=Object.getOwnPropertyDescriptors;var Xo=Object.getOwnPropertySymbols;var Ns=Object.prototype.hasOwnProperty,Ls=Object.prototype.propertyIsEnumerable;var Eo=(f,s,l)=>s in f?zs(f,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):f[s]=l,ve=(f,s)=>{for(var l in s||(s={}))Ns.call(s,l)&&Eo(f,l,s[l]);if(Xo)for(var l of Xo(s))Ls.call(s,l)&&Eo(f,l,s[l]);return f},Aa=(f,s)=>Fs(f,Bs(s));var fo=(f,s,l)=>Eo(f,typeof s!="symbol"?s+"":s,l);var L=(f,s,l)=>new Promise((u,h)=>{var _=j=>{try{m(l.next(j))}catch(oe){h(oe)}},k=j=>{try{m(l.throw(j))}catch(oe){h(oe)}},m=j=>j.done?u(j.value):Promise.resolve(j.value).then(_,k);m((l=l.apply(f,s)).next())});import{t as M,a as A,c as rs,d as js}from"../chunks/Bwek_EPP.js";import{i as so}from"../chunks/DZrEz94V.js";import{h as pa,a as ns,as as is,at as Ps,au as Gs,b as ls,p as cs,f as zo,g as Lt,U as Hs,B as Ws,s as Ao,q as Js,K as e,ag as je,c as Us,r as Qo,d as Do,v as Ys,e as ds,av as Mo,z as us,D as Zo,aw as es,aj as Vs,a6 as as,ax as Fo,ay as Ks,y as Xs,az as Qs,R as Zs,aA as Bo,aB as er,t as ar,$ as vs,aC as fs,Z as tr,aD as or,aE as sr,ab as rr,aF as nr,aG as ir,aH as lr,J as cr,ad as dr,i as ro,a8 as v,T as Y,j as no,aI as K,l as r,m as o,k as c,n as Da,aJ as Pa,aK as No,S as At,aL as da,aM as ts}from"../chunks/DrTJpTtf.js";import{s as I}from"../chunks/CFYXcz1s.js";import{i as U}from"../chunks/Bx8okI50.js";import{b as ur,l as vr,e as q}from"../chunks/CYsNNZf8.js";import{o as io,a as go}from"../chunks/DX1BXpyP.js";import{w as fr,g as mr}from"../chunks/CX_88K5K.js";function gr(f,s,l){pa&&ns();var u=f,h=Hs,_,k=is()?Ps:Gs;ls(()=>{k(h,h=s())&&(_&&cs(_),_=zo(()=>l(u)))}),pa&&(u=Lt)}function wa(f,s){return s}function pr(f,s,l,u){for(var h=[],_=s.length,k=0;k<_;k++)Ks(s[k].e,h,!0);var m=_>0&&h.length===0&&l!==null;if(m){var j=l.parentNode;Xs(j),j.append(l),u.clear(),ut(f,s[0].prev,s[_-1].next)}Qs(h,()=>{for(var oe=0;oe<_;oe++){var se=s[oe];m||(u.delete(se.k),ut(f,se.prev,se.next)),Zs(se.e,!m)}})}function oa(f,s,l,u,h,_=null){var k=f,m={flags:s,items:new Map,first:null},j=(s&fs)!==0;if(j){var oe=f;k=pa?Ao(Js(oe)):oe.appendChild(Ws())}pa&&ns();var se=null,N=!1,C=je(()=>{var y=l();return vs(y)?y:y==null?[]:us(y)});ls(()=>{var y=e(C),z=y.length;if(N&&z===0)return;N=z===0;let F=!1;if(pa){var Q=k.data===Us;Q!==(z===0)&&(k=Qo(),Ao(k),Do(!1),F=!0)}if(pa){for(var Z=null,$,G=0;G<z;G++){if(Lt.nodeType===8&&Lt.data===Ys){k=Lt,F=!0,Do(!1);break}var R=y[G],V=u(R,G);$=ms(Lt,m,Z,null,R,V,G,h,s,l),m.items.set(V,$),Z=$}z>0&&Ao(Qo())}pa||hr(y,m,k,h,s,u,l),_!==null&&(z===0?se?ds(se):se=zo(()=>_(k)):se!==null&&cs(se,()=>{se=null})),F&&Do(!0),e(C)}),pa&&(k=Lt)}function hr(f,s,l,u,h,_,k){var sa,ia,Ve,va;var m=(h&or)!==0,j=(h&(Bo|Fo))!==0,oe=f.length,se=s.items,N=s.first,C=N,y,z=null,F,Q=[],Z=[],$,G,R,V;if(m)for(V=0;V<oe;V+=1)$=f[V],G=_($,V),R=se.get(G),R!==void 0&&((sa=R.a)==null||sa.measure(),(F!=null?F:F=new Set).add(R));for(V=0;V<oe;V+=1){if($=f[V],G=_($,V),R=se.get(G),R===void 0){var Se=C?C.e.nodes_start:l;z=ms(Se,s,z,z===null?s.first:z.next,$,G,V,u,h,k),se.set(G,z),Q=[],Z=[],C=z.next;continue}if(j&&br(R,$,V,h),(R.e.f&Mo)!==0&&(ds(R.e),m&&((ia=R.a)==null||ia.unfix(),(F!=null?F:F=new Set).delete(R))),R!==C){if(y!==void 0&&y.has(R)){if(Q.length<Z.length){var Ne=Z[0],O;z=Ne.prev;var We=Q[0],Je=Q[Q.length-1];for(O=0;O<Q.length;O+=1)os(Q[O],Ne,l);for(O=0;O<Z.length;O+=1)y.delete(Z[O]);ut(s,We.prev,Je.next),ut(s,z,We),ut(s,Je,Ne),C=Ne,z=Je,V-=1,Q=[],Z=[]}else y.delete(R),os(R,C,l),ut(s,R.prev,R.next),ut(s,R,z===null?s.first:z.next),ut(s,z,R),z=R;continue}for(Q=[],Z=[];C!==null&&C.k!==G;)(C.e.f&Mo)===0&&(y!=null?y:y=new Set).add(C),Z.push(C),C=C.next;if(C===null)continue;R=C}Q.push(R),z=R,C=R.next}if(C!==null||y!==void 0){for(var Ye=y===void 0?[]:us(y);C!==null;)(C.e.f&Mo)===0&&Ye.push(C),C=C.next;var ra=Ye.length;if(ra>0){var na=(h&fs)!==0&&oe===0?l:null;if(m){for(V=0;V<ra;V+=1)(Ve=Ye[V].a)==null||Ve.measure();for(V=0;V<ra;V+=1)(va=Ye[V].a)==null||va.fix()}pr(s,Ye,na,se)}}m&&tr(()=>{var Me;if(F!==void 0)for(R of F)(Me=R.a)==null||Me.apply()}),Zo.first=s.first&&s.first.e,Zo.last=z&&z.e}function br(f,s,l,u){(u&Bo)!==0&&es(f.v,s),(u&Fo)!==0?es(f.i,l):f.i=l}function ms(f,s,l,u,h,_,k,m,j,oe){var se=(j&Bo)!==0,N=(j&er)===0,C=se?N?Vs(h):as(h):h,y=(j&Fo)===0?k:as(k),z={i:y,v:C,k:_,a:null,e:null,prev:l,next:u};try{return z.e=zo(()=>m(f,C,y,oe),pa),z.e.prev=l&&l.e,z.e.next=u&&u.e,l===null?s.first=z:(l.next=z,l.e.next=z.e),u!==null&&(u.prev=z,u.e.prev=z.e),z}finally{}}function os(f,s,l){for(var u=f.next?f.next.e.nodes_start:l,h=s?s.e.nodes_start:l,_=f.e.nodes_start;_!==u;){var k=ar(_);h.before(_),_=k}}function ut(f,s,l){s===null?f.first=l:(s.next=l,s.e.next=l&&l.e),l!==null&&(l.prev=s,l.e.prev=s&&s.e)}function gs(f){var s,l,u="";if(typeof f=="string"||typeof f=="number")u+=f;else if(typeof f=="object")if(Array.isArray(f)){var h=f.length;for(s=0;s<h;s++)f[s]&&(l=gs(f[s]))&&(u&&(u+=" "),u+=l)}else for(l in f)f[l]&&(u&&(u+=" "),u+=l);return u}function yr(){for(var f,s,l=0,u="",h=arguments.length;l<h;l++)(f=arguments[l])&&(s=gs(f))&&(u&&(u+=" "),u+=s);return u}function _r(f){return typeof f=="object"?yr(f):f!=null?f:""}function wr(f,s,l){var u=f==null?"":""+f;return s&&(u=u?u+" "+s:s),u===""?null:u}function Sr(f,s){return f==null?null:String(f)}function ua(f,s,l,u,h,_){var k=f.__className;if(pa||k!==l){var m=wr(l,u);(!pa||m!==f.getAttribute("class"))&&(m==null?f.removeAttribute("class"):f.className=m),f.__className=l}return _}function Ya(f,s,l,u){var h=f.__style;if(pa||h!==s){var _=Sr(s);(!pa||_!==f.getAttribute("style"))&&(_==null?f.removeAttribute("style"):f.style.cssText=_),f.__style=s}return u}const Cr=Symbol("is custom element"),xr=Symbol("is html");function Io(f){if(pa){var s=!1,l=()=>{if(!s){if(s=!0,f.hasAttribute("value")){var u=f.value;Oa(f,"value",null),f.value=u}if(f.hasAttribute("checked")){var h=f.checked;Oa(f,"checked",null),f.checked=h}}};f.__on_r=l,ir(l),ur()}}function Oa(f,s,l,u){var h=Rr(f);pa&&(h[s]=f.getAttribute(s),s==="src"||s==="srcset"||s==="href"&&f.nodeName==="LINK")||h[s]!==(h[s]=l)&&(s==="loading"&&(f[lr]=l),l==null?f.removeAttribute(s):typeof l!="string"&&kr(f).includes(s)?f[s]=l:f.setAttribute(s,l))}function Rr(f){var s;return(s=f.__attributes)!=null?s:f.__attributes={[Cr]:f.nodeName.includes("-"),[xr]:f.namespaceURI===sr}}var ss=new Map;function kr(f){var s=ss.get(f.nodeName);if(s)return s;ss.set(f.nodeName,s=[]);for(var l,u=f,h=Element.prototype;h!==u;){l=nr(u);for(var _ in l)l[_].set&&s.push(_);u=rr(u)}return s}function qo(f,s,l=s){var u=is();vr(f,"input",h=>{var _=h?f.defaultValue:f.value;if(_=$o(f)?To(_):_,l(_),u&&_!==(_=s())){var k=f.selectionStart,m=f.selectionEnd;f.value=_!=null?_:"",m!==null&&(f.selectionStart=k,f.selectionEnd=Math.min(m,f.value.length))}}),(pa&&f.defaultValue!==f.value||cr(s)==null&&f.value)&&l($o(f)?To(f.value):f.value),dr(()=>{var h=s();$o(f)&&h===To(f.value)||f.type==="date"&&!h&&!f.value||h!==f.value&&(f.value=h!=null?h:"")})}function $o(f){var s=f.type;return s==="number"||s==="range"}function To(f){return f===""?null:+f}function jt(f){return function(...s){var l=s[0];return l.stopPropagation(),f==null?void 0:f.apply(this,s)}}function ps(f){return function(...s){var l=s[0];return l.preventDefault(),f==null?void 0:f.apply(this,s)}}function Pt(f,s){var _;var l=(_=f.$$events)==null?void 0:_[s.type],u=vs(l)?l.slice():l==null?[]:[l];for(var h of u)h.call(this,s)}const mo=fr(0);var Er=M('<span class="active-indicator svelte-f1u16a"></span>'),Ar=M('<button><span class="team-icon svelte-f1u16a"> </span> <span class="team-name svelte-f1u16a"> </span> <!></button>'),Dr=M('<div class="team-switcher svelte-f1u16a"><div class="team-tabs svelte-f1u16a"></div> <div class="team-info svelte-f1u16a"><span class="current-team svelte-f1u16a"> </span> <span class="shortcut-hint svelte-f1u16a">Ctrl+Tab para cambiar</span></div></div>');function Mr(f,s){ro(s,!1);const l=[{id:0,name:"Equipo 1",icon:"1️⃣",color:"#3498db"},{id:1,name:"Equipo 2",icon:"2️⃣",color:"#e74c3c"},{id:2,name:"Equipo 3",icon:"3️⃣",color:"#2ecc71"}];let u=K(0);mo.subscribe(N=>{v(u,N)});function h(N){mo.set(N),localStorage.setItem("gestionRotaciones_activeTeam",N.toString())}function _(N){if((N.ctrlKey||N.metaKey)&&N.key>="1"&&N.key<="3"){N.preventDefault();const C=parseInt(N.key)-1;C<l.length&&h(C)}if((N.ctrlKey||N.metaKey)&&N.key==="Tab"){N.preventDefault();const C=(e(u)+1)%l.length;h(C)}}io(()=>{const N=localStorage.getItem("gestionRotaciones_activeTeam");return N&&mo.set(parseInt(N)),window.addEventListener("keydown",_),()=>{window.removeEventListener("keydown",_)}}),so();var k=Dr(),m=r(k);oa(m,5,()=>l,wa,(N,C)=>{var y=Ar(),z=r(y),F=r(z,!0);o(z);var Q=c(z,2),Z=r(Q,!0);o(Q);var $=c(Q,2);{var G=R=>{var V=Er();A(R,V)};U($,R=>{e(u)===e(C).id&&R(G)})}o(y),Y(()=>{var R,V,Se;ua(y,1,`team-tab ${(R=e(u)===e(C).id?"active":"")!=null?R:""}`,"svelte-f1u16a"),Ya(y,`--team-color: ${(V=e(C).color)!=null?V:""}`),Oa(y,"title",`${(Se=e(C).name)!=null?Se:""} (Ctrl+${e(C).id+1})`),I(F,e(C).icon),I(Z,e(C).name)}),q("click",y,()=>h(e(C).id)),A(N,y)}),o(m);var j=c(m,2),oe=r(j),se=r(oe);o(oe),Da(2),o(j),o(k),Y(()=>{var N;return I(se,`Trabajando en: ${(N=l[e(u)].name)!=null?N:""}`)}),A(f,k),no()}const Ia=class Ia{constructor(){if(Ia.instance)return Ia.instance;this.db=null,this.isInitialized=!1,this.subscribers=new Map,this.initPromise=null,this.currentTeamId=0,Ia.instance=this}static getDBName(s=0){return`${Ia.DB_NAME_PREFIX}_Team${s}`}switchTeam(s){return L(this,null,function*(){return this.currentTeamId===s&&this.isInitialized?(console.log(`✅ Ya estás en el equipo ${s}`),this.db):(console.log(`🔄 Cambiando del equipo ${this.currentTeamId} al equipo ${s}...`),this.db&&(this.db.close(),console.log(`🔒 Conexión cerrada para equipo ${this.currentTeamId}`)),this.db=null,this.isInitialized=!1,this.initPromise=null,this.currentTeamId=s,this._notifyTeamChange(s),this.init(s))})}getCurrentTeamId(){return this.currentTeamId}_notifyTeamChange(s){this.subscribers.forEach((l,u)=>{l.forEach(h=>{try{h({storeName:u,action:"teamChange",data:{oldTeamId:this.currentTeamId,newTeamId:s}})}catch(_){console.error("❌ Error en callback de cambio de equipo:",_)}})})}init(s=null){return L(this,null,function*(){if(s!==null&&s!==this.currentTeamId)return this.switchTeam(s);if(this.isInitialized&&this.db&&this.currentTeamId===(s!=null?s:this.currentTeamId))return this.db;if(this.initPromise)return this.initPromise;this.initPromise=this._initDatabase(s!=null?s:this.currentTeamId);try{const l=yield this.initPromise;return this.isInitialized=!0,l}catch(l){throw this.initPromise=null,l}})}_initDatabase(s){return new Promise((l,u)=>{const h=Ia.getDBName(s);console.log(`🚀 Inicializando base de datos para equipo ${s}: ${h}...`);const _=indexedDB.open(h,Ia.DB_VERSION);_.onerror=k=>{console.error(`❌ Error abriendo base de datos del equipo ${s}:`,k),u(new Error("Failed to open database"))},_.onsuccess=k=>{this.db=k.target.result,this.currentTeamId=s,console.log(`✅ Base de datos abierta correctamente para equipo ${s}`),this.db.onerror=m=>{console.error(`❌ Error en base de datos del equipo ${s}:`,m)},l(this.db)},_.onupgradeneeded=k=>{const m=k.target.result;console.log(`🔄 Actualizando estructura de base de datos del equipo ${s} de v${k.oldVersion} a v${k.newVersion}...`),this._createObjectStores(m,k.oldVersion),this._migrateData(k.oldVersion,k.newVersion,s)}})}_createObjectStores(s,l){[{name:"roles",keyPath:"id",autoIncrement:!0,description:"Almacén de roles y certificaciones"},{name:"collaborators",keyPath:"id",autoIncrement:!0,description:"Almacén de colaboradores"},{name:"coverage",keyPath:"id",description:"Configuración de roles compartidos (legacy)"},{name:"colorGroups",keyPath:"id",description:"Configuración de grupos por colores"},{name:"rotations",keyPath:"id",autoIncrement:!0,description:"Rotaciones por mes/año"},{name:"rotationConfig",keyPath:"id",description:"Configuración general del sistema de rotaciones"},{name:"teamConfig",keyPath:"id",description:"Configuración específica del equipo"}].forEach(h=>{if(s.objectStoreNames.contains(h.name))console.log(`✓ Almacén ya existe: ${h.name}`);else{console.log(`📦 Creando almacén: ${h.name}`);const _=s.createObjectStore(h.name,{keyPath:h.keyPath,autoIncrement:h.autoIncrement||!1});h.name==="rotations"&&(_.createIndex("monthYear",["year","month"],{unique:!1}),_.createIndex("rotationNumber","rotationNumber",{unique:!1})),console.log(`✅ ${h.description} creado`)}})}_migrateData(s,l,u){console.log(`🔄 Migrando datos de versión ${s} a ${l} para equipo ${u}`),s<2&&this._migrateFromLocalStorage(u),s<3&&(console.log("🔄 Inicializando datos para grupos por colores..."),setTimeout(()=>{this._initializeColorGroups()},100))}_initializeColorGroups(){return L(this,null,function*(){try{if(!(yield this.getById("colorGroups",1).catch(()=>null))){const l={id:1,groups:{blue:[],orange:[],green:[]},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};yield this.save("colorGroups",l),console.log("✅ Grupos por colores inicializados")}}catch(s){console.error("❌ Error inicializando grupos por colores:",s)}})}_migrateFromLocalStorage(s){return L(this,null,function*(){try{console.log(`📦 Migrando datos desde localStorage para equipo ${s}...`);const l=s>0?`gestionRotaciones_team${s}_`:"gestionRotaciones_",u=localStorage.getItem(`${l}roles`);if(u){const m=JSON.parse(u);yield this.saveAll("roles",m),console.log("✅ Roles migrados")}const h=localStorage.getItem(`${l}collaborators`);if(h){const m=JSON.parse(h);yield this.saveAll("collaborators",m),console.log("✅ Colaboradores migrados")}const _=localStorage.getItem(`${l}coverage`);_&&(yield this.save("coverage",{id:1,roleNames:JSON.parse(_)}),console.log("✅ Cobertura migrada"));const k=localStorage.getItem(`${l}colorGroups`);k&&(yield this.save("colorGroups",{id:1,groups:JSON.parse(k)}),console.log("✅ Grupos por colores migrados desde localStorage")),console.log("🎉 Migración completada exitosamente")}catch(l){console.error("❌ Error en migración:",l)}})}save(s,l){return L(this,null,function*(){return this.db||(yield this.init()),new Promise((u,h)=>{try{const _=this.db.transaction([s],"readwrite"),k=_.objectStore(s);_.oncomplete=()=>{console.log(`✅ Datos guardados en ${s} (Equipo ${this.currentTeamId})`),this.notify(s,"save",l),u()},_.onerror=()=>{console.error(`❌ Error guardando en ${s}:`,_.error),h(_.error)},l.id?k.put(l):k.add(l)}catch(_){console.error(`❌ Error en transacción ${s}:`,_),h(_)}})})}saveAll(s,l){return L(this,null,function*(){return this.db||(yield this.init()),new Promise((u,h)=>{try{const _=this.db.transaction([s],"readwrite"),k=_.objectStore(s);_.oncomplete=()=>{console.log(`✅ ${l.length} elementos guardados en ${s} (Equipo ${this.currentTeamId})`),this.notify(s,"saveAll",l),u()},_.onerror=()=>{console.error(`❌ Error guardando múltiples en ${s}:`,_.error),h(_.error)};const m=k.clear();m.onsuccess=()=>{l.forEach((j,oe)=>{const se=Aa(ve({},j),{id:j.id||oe+1});k.add(se)})},m.onerror=()=>{h(m.error)}}catch(_){console.error(`❌ Error en transacción saveAll ${s}:`,_),h(_)}})})}getAll(s){return L(this,null,function*(){return this.db||(yield this.init()),new Promise((l,u)=>{try{const k=this.db.transaction([s],"readonly").objectStore(s).getAll();k.onsuccess=()=>{console.log(`📖 ${k.result.length} elementos cargados de ${s} (Equipo ${this.currentTeamId})`),l(k.result)},k.onerror=()=>{console.error(`❌ Error cargando de ${s}:`,k.error),u(k.error)}}catch(h){console.error(`❌ Error en transacción getAll ${s}:`,h),u(h)}})})}getById(s,l){return L(this,null,function*(){return this.db||(yield this.init()),new Promise((u,h)=>{try{const m=this.db.transaction([s],"readonly").objectStore(s).get(l);m.onsuccess=()=>{u(m.result)},m.onerror=()=>{h(m.error)}}catch(_){console.error(`❌ Error en transacción getById ${s}:`,_),h(_)}})})}delete(s,l){return L(this,null,function*(){return this.db||(yield this.init()),new Promise((u,h)=>{try{const m=this.db.transaction([s],"readwrite").objectStore(s).delete(l);m.onsuccess=()=>{console.log(`🗑️ Elemento ${l} eliminado de ${s} (Equipo ${this.currentTeamId})`),this.notify(s,"delete",{id:l}),u()},m.onerror=()=>{console.error(`❌ Error eliminando de ${s}:`,m.error),h(m.error)}}catch(_){console.error(`❌ Error en transacción delete ${s}:`,_),h(_)}})})}clear(s){return L(this,null,function*(){return this.db||(yield this.init()),new Promise((l,u)=>{try{const k=this.db.transaction([s],"readwrite").objectStore(s).clear();k.onsuccess=()=>{console.log(`🧹 Almacén ${s} limpiado (Equipo ${this.currentTeamId})`),this.notify(s,"clear"),l()},k.onerror=()=>{console.error(`❌ Error limpiando ${s}:`,k.error),u(k.error)}}catch(h){console.error(`❌ Error en transacción clear ${s}:`,h),u(h)}})})}subscribe(s,l){return this.subscribers.has(s)||this.subscribers.set(s,new Set),this.subscribers.get(s).add(l),console.log(`🔔 Suscripción agregada para ${s} (Equipo ${this.currentTeamId})`),()=>this.unsubscribe(s,l)}unsubscribe(s,l){this.subscribers.has(s)&&(this.subscribers.get(s).delete(l),console.log(`🔕 Suscripción removida para ${s}`))}notify(s,l,u=null){this.subscribers.has(s)&&this.subscribers.get(s).forEach(_=>{try{_({storeName:s,action:l,data:u,teamId:this.currentTeamId})}catch(k){console.error("❌ Error en callback de notificación:",k)}})}isStoreEmpty(s){return L(this,null,function*(){try{return(yield this.getAll(s)).length===0}catch(l){return console.error(`❌ Error verificando si ${s} está vacío:`,l),!0}})}getStorageStats(){return L(this,null,function*(){if(!this.db)return null;try{const s={},l=["roles","collaborators","coverage","colorGroups","rotations","rotationConfig","teamConfig"];for(const u of l)try{const h=yield this.getAll(u);s[u]={count:h.length,size:JSON.stringify(h).length}}catch(h){console.warn(`⚠️ No se pudo obtener stats para ${u}:`,h),s[u]={count:0,size:0,error:h.message}}return{teamId:this.currentTeamId,stores:s,totalSize:Object.values(s).reduce((u,h)=>u+(h.size||0),0),lastAccessed:new Date().toISOString()}}catch(s){return console.error("❌ Error obteniendo estadísticas:",s),null}})}getTeamConfig(){return L(this,null,function*(){try{return(yield this.getById("teamConfig",1))||{id:1,teamId:this.currentTeamId,name:`Equipo ${this.currentTeamId+1}`,color:this.currentTeamId===0?"#3498db":this.currentTeamId===1?"#e74c3c":"#2ecc71",createdAt:new Date().toISOString()}}catch(s){return console.error("❌ Error obteniendo configuración del equipo:",s),null}})}saveTeamConfig(s){return L(this,null,function*(){try{yield this.save("teamConfig",Aa(ve({id:1},s),{teamId:this.currentTeamId,updatedAt:new Date().toISOString()})),console.log("✅ Configuración del equipo guardada")}catch(l){console.error("❌ Error guardando configuración del equipo:",l)}})}saveToLocalStorage(s,l){return L(this,null,function*(){try{const u=this.currentTeamId>0?`team${this.currentTeamId}_${s}`:s;localStorage.setItem(u,JSON.stringify(l)),console.log(`💾 Respaldo guardado en localStorage: ${u}`)}catch(u){console.error("❌ Error guardando en localStorage:",u)}})}getFromLocalStorage(s,l=null){try{const u=this.currentTeamId>0?`team${this.currentTeamId}_${s}`:s,h=localStorage.getItem(u);return h?JSON.parse(h):l}catch(u){return console.error("❌ Error cargando de localStorage:",u),l}}getRotationByMonthYear(s,l){return L(this,null,function*(){try{return(yield this.getAll("rotations")).find(h=>h.year===s&&h.month===l)}catch(u){return console.error("❌ Error obteniendo rotación:",u),null}})}saveRotation(s,l,u){return L(this,null,function*(){try{const _=(yield this.getAll("rotations")).find(m=>m.year===s&&m.month===l),k={year:s,month:l,assignments:u,teamId:this.currentTeamId,updatedAt:new Date().toISOString()};return _&&(k.id=_.id),yield this.save("rotations",k),yield this.saveToLocalStorage("gestionRotaciones_currentRotation",k),k}catch(h){throw console.error("❌ Error guardando rotación:",h),h}})}reinitializeDatabase(){return L(this,null,function*(){try{console.log(`🔄 Reinicializando base de datos del equipo ${this.currentTeamId}...`),this.db&&this.db.close(),this.db=null,this.isInitialized=!1,this.initPromise=null;const s=Ia.getDBName(this.currentTeamId);return yield new Promise((l,u)=>{const h=indexedDB.deleteDatabase(s);h.onsuccess=()=>{console.log(`✅ Base de datos ${s} eliminada`),l()},h.onerror=()=>{console.error("❌ Error eliminando base de datos:",h.error),u(h.error)}}),yield this.init(this.currentTeamId),console.log("✅ Base de datos reinicializada correctamente"),!0}catch(s){return console.error("❌ Error reinicializando base de datos:",s),!1}})}copyDataBetweenTeams(h,_){return L(this,arguments,function*(s,l,u=["roles","collaborators"]){try{console.log(`📋 Copiando datos del equipo ${s} al equipo ${l}...`);const k=this.currentTeamId;yield this.switchTeam(s);const m={};for(const j of u)m[j]=yield this.getAll(j);yield this.switchTeam(l);for(const j of u)m[j]&&m[j].length>0&&(yield this.saveAll(j,m[j]));return yield this.switchTeam(k),console.log("✅ Datos copiados exitosamente"),!0}catch(k){return console.error("❌ Error copiando datos entre equipos:",k),!1}})}};fo(Ia,"instance",null),fo(Ia,"DB_NAME_PREFIX","GestionRotacionesDB"),fo(Ia,"DB_VERSION",3);let Oo=Ia;const ta=new Oo,xe={init:f=>ta.init(f),save:(f,s)=>ta.save(f,s),saveAll:(f,s)=>ta.saveAll(f,s),getAll:f=>ta.getAll(f),getById:(f,s)=>ta.getById(f,s),delete:(f,s)=>ta.delete(f,s),clear:f=>ta.clear(f),subscribe:(f,s)=>ta.subscribe(f,s),notify:(f,s,l)=>ta.notify(f,s,l),getRotation:(f,s)=>ta.getRotationByMonthYear(f,s),saveRotation:(f,s,l)=>ta.saveRotation(f,s,l),stats:()=>ta.getStorageStats(),isEmpty:f=>ta.isStoreEmpty(f),reinitialize:()=>ta.reinitializeDatabase(),switchTeam:f=>ta.switchTeam(f),getCurrentTeamId:()=>ta.getCurrentTeamId(),getTeamConfig:()=>ta.getTeamConfig(),saveTeamConfig:f=>ta.saveTeamConfig(f),copyDataBetweenTeams:(f,s,l)=>ta.copyDataBetweenTeams(f,s,l)};var $r=M('<div class="input-hint error"> </div>'),Tr=M('<div class="error-message"> </div>'),Ir=M('<tr><td> </td><td> </td><td><span> </span></td><td><span> </span></td><td><button class="icon-button edit">✏️</button> <button class="icon-button calendar">📅</button> <button class="icon-button daily-max" title="Configurar máximos por día">👥</button> <button class="icon-button delete">🗑️</button></td></tr>'),qr=M('<div class="roles-list"><h3>Roles Configurados</h3> <div class="table-container"><table><thead><tr><th>Nombre del Rol</th><th>Mín</th><th>Máx</th><th>Días</th><th>Acción</th></tr></thead><tbody></tbody></table></div></div>'),Or=M('<p class="no-data">No hay roles configurados</p>'),zr=M('<span class="role-count"> </span>'),Fr=M('<button><span class="color-dot"></span> <!></button>'),Br=M('<p class="color-instruction selected"><span class="instruction-icon">👆</span> Seleccionando roles para: <strong> </strong></p>'),Nr=M('<p class="color-instruction"><span class="instruction-icon">💡</span> Selecciona un color para empezar a agrupar roles</p>'),Lr=M('<span class="role-color-indicator"></span>'),jr=M('<div><span class="role-name"> </span> <!></div>'),Pr=M(`<div class="roles-coverage-list"><h3>Roles a cubrir por el mismo colaborador</h3> <div class="color-selector"><h4>Selecciona un grupo de color:</h4> <div class="color-buttons"></div> <!></div> <div class="coverage-items"></div> <div class="coverage-info"><div class="coverage-summary"><h4><span class="summary-icon">🔄</span> Resumen de Roles Compartidos</h4> <p class="help-text">Los siguientes roles serán considerados para asignación compartida: <br> <strong> <br> <br> Selecciona un color y luego los roles que serán cubiertos por el mismo colaborador.
                  Cada color representa un grupo diferente.</strong></p></div></div></div>`),Gr=M('<span class="modal-subtitle"> </span>'),Hr=M('<div class="error-message"> </div>'),Wr=M('<div class="modal-backdrop"><div class="modal-content"><div class="modal-header"><h3>Actualizar Rol <!></h3> <button class="modal-close">×</button></div> <div class="modal-body"><div class="form-group"><label for="modalRoleName">Nombre del Rol:</label> <input id="modalRoleName" type="text" placeholder="Nombre del Rol" required></div> <div class="form-row"><div class="form-group"><label for="modalMinCollaborators">Mínimo Colaboradores:</label> <div class="number-input-container"><button type="button" class="number-button">-</button> <span class="number-display"> </span> <button type="button" class="number-button">+</button></div></div> <div class="form-group"><label for="modalMaxCollaborators">Máximo Colaboradores:</label> <div class="number-input-container"><button type="button" class="number-button">-</button> <span class="number-display"> </span> <button type="button" class="number-button">+</button></div></div></div> <div class="form-group"><label for="modalPriority">Prioridad:</label> <div class="number-input-container"><button type="button" class="number-button">-</button> <span class="number-display"> </span> <button type="button" class="number-button">+</button></div> <div class="input-hint">1 = Mayor prioridad, 2 = Menor prioridad</div></div> <!></div> <div class="modal-footer"><button class="cancel-button">Cancelar</button> <button class="action-button roles-button">Guardar Cambios</button></div></div></div>'),Jr=M('<span class="modal-subtitle"> </span>'),Ur=M('<div><div class="day-name"> </div> <div class="day-status"> </div></div>'),Yr=M('<div class="modal-backdrop"><div class="modal-content"><div class="modal-header"><h3>Configurar días excluidos <!></h3> <button class="modal-close">×</button></div> <div class="modal-body"><div class="days-section"><div class="days-header"><h4>Días en que NO se requiere este rol</h4> <div class="days-actions"><button class="days-action-button select-all">Excluir todos</button> <button class="days-action-button clear-all">Incluir todos</button></div></div> <p class="modal-description">Nota: Por defecto, los roles se requieren todos los días (lunes a viernes). Selecciona los días en los que excepcionalmente NO se requiere este rol.</p> <div class="days-grid"></div></div></div> <div class="modal-footer"><button class="cancel-button">Cancelar</button> <button class="action-button roles-button">Guardar Cambios</button></div></div></div>'),Vr=M('<span class="modal-subtitle"> </span>'),Kr=M('<div class="day-item daily-max-item"><div class="day-name"> </div> <div class="day-max-control"><div class="number-input-container compact"><button type="button" class="number-button">-</button> <span class="number-display"> </span> <button type="button" class="number-button">+</button></div></div></div>'),Xr=M('<div class="modal-backdrop"><div class="modal-content"><div class="modal-header"><h3>Configurar Máximos por Día <!></h3> <button class="modal-close">×</button></div> <div class="modal-body"><div class="days-section"><div class="days-header"><h4>Máximo de colaboradores por día</h4></div> <p class="modal-description">Configure el número máximo de colaboradores permitidos para cada día de la semana.</p> <div class="days-grid"></div> <div class="modal-note"><p> </p></div></div></div> <div class="modal-footer"><button class="cancel-button">Cancelar</button> <button class="action-button roles-button">Guardar Cambios</button></div></div></div>'),Qr=M('<section class="section-container roles-section"><h2>Gestión de Roles</h2> <div class="content"><form class="role-form"><div class="form-group"><label for="roleName">Nombre del Rol:</label> <input id="roleName" type="text" placeholder="Nombre del Rol" required> <!></div> <div class="form-row"><div class="form-group"><label for="minCollaborators">Mínimo Colaboradores:</label> <div class="number-input-container"><button type="button" class="number-button">-</button> <span class="number-display"> </span> <button type="button" class="number-button">+</button></div></div> <div class="form-group"><label for="maxCollaborators">Máximo Colaboradores:</label> <div class="number-input-container"><button type="button" class="number-button">-</button> <span class="number-display"> </span> <button type="button" class="number-button">+</button></div> <div class="input-hint">Máximo de colaboradores que pueden ser asignados a este rol por día</div></div></div> <!> <div class="form-actions"><button type="submit" class="action-button roles-button">Agregar Rol</button></div></form> <div class="role-management-container"><!> <!></div></div></section> <!> <!> <!>',1);function Zr(f,s){ro(s,!1);const l=K();let u=K(""),h=K(1),_=K(1),k=1,m=K([]),j=K(-1),oe=K(""),se=K(!1),N=K([]),C=K("blue"),y=K({blue:[],orange:[],green:[]});const z=[{id:"blue",name:"Grupo Azul",color:"#3498db",bgColor:"rgba(52, 152, 219, 0.2)"},{id:"orange",name:"Grupo Naranja",color:"#f39c12",bgColor:"rgba(243, 156, 18, 0.2)"},{id:"green",name:"Grupo Verde",color:"#2ecc71",bgColor:"rgba(46, 204, 113, 0.2)"}];let F={monday:!1,tuesday:!1,wednesday:!1,thursday:!1,friday:!1},Q={monday:1,tuesday:1,wednesday:1,thursday:1,friday:1},Z=K(!1),$=K(-1),G=K(ve({},F)),R=K(!1),V=K(-1),Se=K(ve({},Q)),Ne=K(!1),O=K({name:"",min:1,max:1,priority:1,dailyMaxCollabs:ve({},Q)});const We={monday:"Lunes",tuesday:"Martes",wednesday:"Miércoles",thursday:"Jueves",friday:"Viernes"};let Je=null,Ye=null;io(()=>L(this,null,function*(){try{console.log("🚀 Inicializando RolesManagement..."),yield xe.init(),console.log("✅ Servicio de base de datos inicializado"),yield ra(),Je=xe.subscribe("roles",Me),Ye=xe.subscribe("coverage",Va),console.log("✅ Suscripciones configuradas"),v(se,!0),console.log("✅ RolesManagement inicializado correctamente")}catch(p){console.error("❌ Error inicializando RolesManagement:",p),yield sa(),v(se,!0)}})),go(()=>{Je&&Je(),Ye&&Ye()});function ra(){return L(this,null,function*(){try{console.log("📖 Cargando datos desde servicio...");const p=yield xe.getAll("roles");v(m,(p||[]).map(ia)),console.log(`✅ ${e(m).length} roles cargados`);const w=yield xe.getById("coverage",1);v(N,(w==null?void 0:w.roleNames)||[]),yield na(),console.log(`✅ ${e(N).length} roles compartidos cargados (legacy)`)}catch(p){console.error("❌ Error cargando datos desde servicio:",p),yield sa()}})}function na(){return L(this,null,function*(){try{const p=yield xe.getById("colorGroups",1);v(y,(p==null?void 0:p.groups)||{blue:[],orange:[],green:[]}),console.log("✅ Grupos por colores cargados:",e(y))}catch(p){console.error("❌ Error cargando grupos por colores:",p);const w=localStorage.getItem("gestionRotaciones_colorGroups");w&&v(y,JSON.parse(w))}})}function sa(){return L(this,null,function*(){console.log("📁 Usando fallback a localStorage...");try{const p=localStorage.getItem("gestionRotaciones_roles");v(m,p?JSON.parse(p).map(ia):[]);const w=localStorage.getItem("gestionRotaciones_coverage");v(N,w?JSON.parse(w):[]);const H=localStorage.getItem("gestionRotaciones_colorGroups");H&&v(y,JSON.parse(H)),console.log("📁 Datos cargados desde localStorage")}catch(p){console.error("❌ Error en fallback localStorage:",p)}})}function ia(p){return Aa(ve({},p),{excludedDays:p.excludedDays||ve({},F),dailyMaxCollabs:p.dailyMaxCollabs||{monday:p.max||1,tuesday:p.max||1,wednesday:p.max||1,thursday:p.max||1,friday:p.max||1},priority:p.priority||1})}function Ve(){return L(this,null,function*(){if(e(se))try{yield xe.saveAll("roles",e(m)),console.log("✅ Roles guardados correctamente"),yield xe.save("coverage",{id:1,roleNames:e(N)}),yield xe.save("colorGroups",{id:1,groups:e(y)}),console.log("✅ Cobertura guardada correctamente"),console.log("✅ Grupos por colores guardados correctamente")}catch(p){console.error("❌ Error guardando datos:",p),va()}})}function va(){try{localStorage.setItem("gestionRotaciones_roles",JSON.stringify(e(m))),localStorage.setItem("gestionRotaciones_coverage",JSON.stringify(e(N))),localStorage.setItem("gestionRotaciones_colorGroups",JSON.stringify(e(y))),console.log("💾 Datos guardados en localStorage (fallback)")}catch(p){console.error("❌ Error guardando en localStorage:",p)}}function Me(p){p.action==="saveAll"&&p.data&&e(se)&&console.log("🔄 Roles actualizados externamente")}function Va(p){p.action==="save"&&p.data&&e(se)&&console.log("🔄 Cobertura actualizada externamente")}function Ka(p){const w=p.trimEnd();return w.length<3?"El nombre del rol debe tener al menos 3 caracteres":/^(\w)\1{2,}$/.test(w)?"El nombre no puede ser tres letras iguales consecutivas":/^[a-zA-ZáéíóúüÁÉÍÓÚÜñÑ0-9\s\(\)\-\/_]+$/.test(w)?p!==w?"El nombre no puede terminar con espacios":w.trim().length===0?"El nombre no puede estar vacío o contener solo espacios":null:"Solo se permiten letras, números, espacios, paréntesis (), guiones -, barras / y guiones bajos _"}function Dt(p){return p.trimEnd()}function Ke(){e(h)<1&&v(h,1),e(_)<1&&v(_,1),e(_)<e(h)&&v(_,e(h)),Object.keys(Q).forEach(p=>{Q[p]=e(_)})}function Gt(){v(h,e(h)+1),Ke()}function Ht(){e(h)>1&&v(h,e(h)-1),Ke()}function Wt(){v(_,e(_)+1),Ke()}function Jt(){e(_)>1&&v(_,e(_)-1),Ke()}function Ut(){v(oe,"");const p=Ka(e(u));if(p){v(oe,p);return}const w=Dt(e(u));if(Ke(),e(h)>e(_)){v(oe,"El mínimo no puede ser mayor que el máximo");return}if(e(m).find((ee,me)=>ee.name.toLowerCase()===w.toLowerCase()&&me!==e(j))){v(oe,"Ya existe un rol con este nombre");return}const X={name:w,min:e(h),max:e(_),priority:k,excludedDays:ve({},F),dailyMaxCollabs:ve({},Q)};v(m,[...e(m),X]),Mt()}function Mt(){v(u,""),v(h,1),v(_,1),k=1,Q={monday:1,tuesday:1,wednesday:1,thursday:1,friday:1}}function za(p){const w=e(m)[p].name;v(m,e(m).filter((H,X)=>X!==p)),e(j)===p&&(Mt(),v(j,-1)),e(N).includes(w)&&v(N,e(N).filter(H=>H!==w)),Object.keys(e(y)).forEach(H=>{da(y,e(y)[H]=e(y)[H].filter(X=>X!==w))}),v(y,ve({},e(y))),xe.notify("roles","delete",{roleName:w})}function $t(p){e(C)===p?(da(y,e(y)[p]=[]),v(y,ve({},e(y))),v(C,null)):v(C,p)}function Yt(p){e(C)&&(e(y)[e(C)].includes(p)?da(y,e(y)[e(C)]=e(y)[e(C)].filter(w=>w!==p)):(Object.keys(e(y)).forEach(w=>{da(y,e(y)[w]=e(y)[w].filter(H=>H!==p))}),da(y,e(y)[e(C)]=[...e(y)[e(C)],p])),v(y,ve({},e(y))))}function Tt(p){for(const[w,H]of Object.entries(e(y)))if(H.includes(p))return z.find(X=>X.id===w);return null}function Xa(){const p=[];return Object.values(e(y)).forEach(w=>{p.push(...w)}),p}function vt(p){const w=e(m)[p];v(O,{name:w.name,min:w.min,max:w.max,priority:w.priority||1,dailyMaxCollabs:w.dailyMaxCollabs?ve({},w.dailyMaxCollabs):{monday:w.max||1,tuesday:w.max||1,wednesday:w.max||1,thursday:w.max||1,friday:w.max||1}}),v(j,p),v(Ne,!0),v(oe,"")}function ha(){v(Ne,!1),v(j,-1),v(oe,"")}function Vt(){const p=Ka(e(O).name);if(p){v(oe,p);return}const w=Dt(e(O).name);if(e(m).find((ee,me)=>ee.name.toLowerCase()===w.toLowerCase()&&me!==e(j))){v(oe,"Ya existe un rol con este nombre");return}const X=e(m)[e(j)];if(e(O).max!==X.max&&Object.keys(e(O).dailyMaxCollabs).forEach(ee=>{da(O,e(O).dailyMaxCollabs[ee]=e(O).max)}),e(j)>=0&&e(j)<e(m).length){const ee=e(m)[e(j)].name,me=w,Ce=Aa(ve({},e(m)[e(j)]),{name:me,min:e(O).min,max:e(O).max,priority:e(O).priority,dailyMaxCollabs:ve({},e(O).dailyMaxCollabs)}),Ie=[...e(m)];Ie[e(j)]=Ce,v(m,Ie),ee!==me&&(Object.keys(e(y)).forEach(ie=>{da(y,e(y)[ie]=e(y)[ie].map(ge=>ge===ee?me:ge))}),v(y,ve({},e(y))),xe.notify("roles","rename",{oldName:ee,newName:me})),ha()}}function ft(p){const w=e(m)[p];v(G,ve({},w.excludedDays||F)),v($,p),v(Z,!0)}function Ga(){v(Z,!1),v($,-1),v(G,ve({},F))}function It(p){v(G,Aa(ve({},e(G)),{[p]:!e(G)[p]}))}function Kt(){if(e($)>=0&&e($)<e(m).length){const p=[...e(m)];p[e($)].excludedDays=ve({},e(G)),v(m,p),Ga()}}function Xt(p){const w=e(m)[p];v(Se,ve({},w.dailyMaxCollabs||{monday:w.max||1,tuesday:w.max||1,wednesday:w.max||1,thursday:w.max||1,friday:w.max||1})),v(V,p),v(R,!0)}function Fa(){v(R,!1),v(V,-1),v(Se,ve({},Q))}function Qa(p){v(Se,Aa(ve({},e(Se)),{[p]:e(Se)[p]+1}))}function mt(p){const H=e(m)[e(V)].min||1;e(Se)[p]>H&&v(Se,Aa(ve({},e(Se)),{[p]:e(Se)[p]-1}))}function Za(){if(e(V)>=0&&e(V)<e(m).length){const p=[...e(m)];p[e(V)].dailyMaxCollabs=ve({},e(Se)),v(m,p),Fa()}}function et(p=!0){const w={};Object.keys(e(G)).forEach(H=>{w[H]=p}),v(G,w)}function Ba(p){if(!p)return"Requerido todos los días";const w=Object.entries(p).filter(([H,X])=>X).map(([H,X])=>We[H]);return w.length>0?`No requerido: ${w.join(", ")}`:"Requerido todos los días"}function gt(p){return p.excludedDays?Object.values(p.excludedDays).some(w=>w):!1}function Qt(p){if(!p.dailyMaxCollabs)return`Máx: ${p.max||1}`;const w=Object.values(p.dailyMaxCollabs);return w.every(X=>X===w[0])&&w[0]===p.max?`Máx: ${p.max}`:"Máx. por día: Varía"}function qt(p){if(!p.dailyMaxCollabs)return!1;const w=Object.values(p.dailyMaxCollabs);return!w.every(X=>X===w[0])||w[0]!==p.max}Pa(()=>(e(se),e(m)),()=>{e(se)&&e(m)&&Ve()}),Pa(()=>(e(se),e(y)),()=>{e(se)&&e(y)&&Ve()}),Pa(()=>(e(Ne),e(O),e(m),e(j)),()=>{if(e(Ne)&&e(O).max){const p=e(m)[e(j)];p&&e(O).max!==p.max&&da(O,e(O).dailyMaxCollabs={monday:e(O).max,tuesday:e(O).max,wednesday:e(O).max,thursday:e(O).max,friday:e(O).max})}}),Pa(()=>e(u),()=>{v(l,e(u).trim()?Ka(e(u)):null)}),Pa(()=>e(se),()=>{e(se)&&v(N,Xa())}),No(),so();var at=Qr(),pt=At(at),Ot=c(r(pt),2),tt=r(Ot),ot=r(tt),st=c(r(ot),2);Io(st);var Zt=c(st,2);{var ht=p=>{var w=$r(),H=r(w,!0);o(w),Y(()=>I(H,e(l))),A(p,w)};U(Zt,p=>{e(l)&&e(u).trim()&&p(ht)})}o(ot);var rt=c(ot,2),bt=r(rt),ka=c(r(bt),2),yt=r(ka),_t=c(yt,2),zt=r(_t,!0);o(_t);var eo=c(_t,2);o(ka),o(bt);var Ft=c(bt,2),wt=c(r(Ft),2),g=r(wt),T=c(g,2),W=r(T,!0);o(T);var B=c(T,2);o(wt),Da(2),o(Ft),o(rt);var J=c(rt,2);{var ue=p=>{var w=Tr(),H=r(w,!0);o(w),Y(()=>I(H,e(oe))),A(p,w)};U(J,p=>{e(oe)&&p(ue)})}Da(2),o(tt);var De=c(tt,2),$e=r(De);{var Re=p=>{var w=qr(),H=c(r(w),2),X=r(H),ee=c(r(X));oa(ee,5,()=>[...e(m)].sort((me,Ce)=>me.name.localeCompare(Ce.name)),me=>me.id||me.name,(me,Ce)=>{var Ie=Ir(),ie=r(Ie),ge=r(ie,!0);o(ie);var he=c(ie),ke=r(he,!0);o(he);var Te=c(he),be=r(Te),ce=r(be,!0);o(be),o(Te);var le=c(Te),Ee=r(le),_e=r(Ee,!0);o(Ee),o(le);var ne=c(le),ae=r(ne),ye=c(ae,2),de=c(ye,2),we=c(de,2);o(ne),o(Ie),Y((pe,Ae,la,Ze)=>{I(ge,e(Ce).name),I(ke,e(Ce).min),ua(be,1,`max-value ${pe!=null?pe:""}`),I(ce,Ae),ua(Ee,1,`days-info ${la!=null?la:""}`),I(_e,Ze)},[()=>qt(e(Ce))?"has-variable-maxs":"",()=>Qt(e(Ce)),()=>gt(e(Ce))?"has-excluded":"",()=>Ba(e(Ce).excludedDays)],je),q("click",ae,()=>{const pe=e(m).findIndex(Ae=>Ae.name===e(Ce).name);vt(pe)}),q("click",ye,()=>{const pe=e(m).findIndex(Ae=>Ae.name===e(Ce).name);ft(pe)}),q("click",de,()=>{const pe=e(m).findIndex(Ae=>Ae.name===e(Ce).name);Xt(pe)}),q("click",we,()=>{const pe=e(m).findIndex(Ae=>Ae.name===e(Ce).name);za(pe)}),A(me,Ie)}),o(ee),o(X),o(H),o(w),A(p,w)},Pe=p=>{var w=Or();A(p,w)};U($e,p=>{e(m).length>0?p(Re):p(Pe,!1)})}var Xe=c($e,2);{var ba=p=>{var w=Pr(),H=c(r(w),2),X=c(r(H),2);oa(X,5,()=>z,wa,(be,ce)=>{var le=Fr(),Ee=c(r(le),2);{var _e=ne=>{var ae=zr(),ye=r(ae,!0);o(ae),Y(()=>I(ye,e(y)[e(ce).id].length)),A(ne,ae)};U(Ee,ne=>{e(y)[e(ce).id].length>0&&ne(_e)})}o(le),Y(()=>{var ne,ae,ye,de,we;ua(le,1,`color-button ${(ne=e(C)===e(ce).id?"active":"")!=null?ne:""}`),Ya(le,`background-color: ${(ae=e(ce).color)!=null?ae:""}`),Oa(le,"title",`${(ye=e(ce).name)!=null?ye:""} (${(de=e(y)[e(ce).id].length)!=null?de:""} roles) - Clic para ${(we=e(C)===e(ce).id?"desmarcar":"seleccionar")!=null?we:""}`)}),q("click",le,()=>$t(e(ce).id)),A(be,le)}),o(X);var ee=c(X,2);{var me=be=>{var ce=Br(),le=c(r(ce),2),Ee=r(le,!0);o(le),o(ce),Y(_e=>I(Ee,_e),[()=>{var _e;return(_e=z.find(ne=>ne.id===e(C)))==null?void 0:_e.name}],je),A(be,ce)},Ce=be=>{var ce=Nr();A(be,ce)};U(ee,be=>{e(C)!==null?be(me):be(Ce,!1)})}o(H);var Ie=c(H,2);oa(Ie,5,()=>[...e(m)].sort((be,ce)=>be.name.localeCompare(ce.name)),be=>be.id||be.name,(be,ce)=>{var le=jr();const Ee=je(()=>Tt(e(ce).name));var _e=r(le),ne=r(_e,!0);o(_e);var ae=c(_e,2);{var ye=de=>{var we=Lr();Y(()=>{var pe;return Ya(we,`background-color: ${(pe=e(Ee).color)!=null?pe:""}`)}),A(de,we)};U(ae,de=>{e(Ee)&&de(ye)})}o(le),Y((de,we)=>{var pe,Ae;ua(le,1,`coverage-item ${de!=null?de:""} ${(pe=!e(C)&&e(Ee)?"has-color":"")!=null?pe:""} ${(Ae=e(C)?"":"disabled")!=null?Ae:""}`),Ya(le,e(Ee)?`border-color: ${e(Ee).color}; background-color: ${e(Ee).bgColor}`:""),Oa(le,"title",we),I(ne,e(ce).name)},[()=>e(C)&&e(y)[e(C)].includes(e(ce).name)?"selected":"",()=>{var de;return e(C)?"Clic para agregar/quitar del grupo "+((de=z.find(we=>we.id===e(C)))==null?void 0:de.name):e(Ee)?`Este rol está en ${e(Ee).name}`:"Selecciona un color primero"}],je),q("click",le,()=>{e(C)&&Yt(e(ce).name)}),A(be,le)}),o(Ie);var ie=c(Ie,2),ge=r(ie),he=c(r(ge),2),ke=c(r(he),3),Te=r(ke);Da(4),o(ke),o(he),o(ge),o(ie),o(w),Y(be=>I(Te,`${be!=null?be:""} `),[()=>e(N).length>0?`${e(N).length} roles: ${e(N).join(", ")}`:"Ningún rol seleccionado"],je),A(p,w)};U(Xe,p=>{e(m).length>0&&p(ba)})}o(De),o(Ot),o(pt);var Sa=c(pt,2);{var fa=p=>{var w=Wr(),H=r(w),X=r(H),ee=r(X),me=c(r(ee));{var Ce=He=>{var Ma=Gr(),xt=r(Ma,!0);o(Ma),Y(()=>I(xt,e(m)[e(j)].name)),A(He,Ma)};U(me,He=>{e(j)>=0&&e(j)<e(m).length&&He(Ce)})}o(ee);var Ie=c(ee,2);o(X);var ie=c(X,2),ge=r(ie),he=c(r(ge),2);Io(he),o(ge);var ke=c(ge,2),Te=r(ke),be=c(r(Te),2),ce=r(be),le=c(ce,2),Ee=r(le,!0);o(le);var _e=c(le,2);o(be),o(Te);var ne=c(Te,2),ae=c(r(ne),2),ye=r(ae),de=c(ye,2),we=r(de,!0);o(de);var pe=c(de,2);o(ae),o(ne),o(ke);var Ae=c(ke,2),la=c(r(Ae),2),Ze=r(la),Ca=c(Ze,2),nt=r(Ca,!0);o(Ca);var it=c(Ca,2);o(la),Da(2),o(Ae);var Na=c(Ae,2);{var St=He=>{var Ma=Hr(),xt=r(Ma,!0);o(Ma),Y(()=>I(xt,e(oe))),A(He,Ma)};U(Na,He=>{e(oe)&&He(St)})}o(ie);var Ct=c(ie,2),lt=r(Ct),La=c(lt,2);o(Ct),o(H),o(w),Y(()=>{I(Ee,e(O).min),I(we,e(O).max),Ze.disabled=e(O).priority<=1,I(nt,e(O).priority),it.disabled=e(O).priority>=2}),q("click",Ie,ha),qo(he,()=>e(O).name,He=>da(O,e(O).name=He)),q("click",ce,()=>{e(O).min>1&&da(O,e(O).min--),e(O).min>e(O).max&&da(O,e(O).max=e(O).min)}),q("click",_e,()=>{da(O,e(O).min++),e(O).min>e(O).max&&da(O,e(O).max=e(O).min)}),q("click",ye,()=>{e(O).max>e(O).min&&da(O,e(O).max--)}),q("click",pe,()=>{da(O,e(O).max++)}),q("click",Ze,()=>{e(O).priority>1&&da(O,e(O).priority--)}),q("click",it,()=>{e(O).priority<2&&da(O,e(O).priority++)}),q("click",lt,ha),q("click",La,Vt),q("click",H,jt(function(He){Pt.call(this,s,He)})),q("click",w,ha),A(p,w)};U(Sa,p=>{e(Ne)&&p(fa)})}var ya=c(Sa,2);{var ma=p=>{var w=Yr(),H=r(w),X=r(H),ee=r(X),me=c(r(ee));{var Ce=ne=>{var ae=Jr(),ye=r(ae);o(ae),Y(()=>{var de;return I(ye,`para ${(de=e(m)[e($)].name)!=null?de:""}`)}),A(ne,ae)};U(me,ne=>{e($)>=0&&e($)<e(m).length&&ne(Ce)})}o(ee);var Ie=c(ee,2);o(X);var ie=c(X,2),ge=r(ie),he=r(ge),ke=c(r(he),2),Te=r(ke),be=c(Te,2);o(ke),o(he);var ce=c(he,4);oa(ce,5,()=>Object.entries(e(G)),wa,(ne,ae)=>{let ye=()=>e(ae)[0],de=()=>e(ae)[1];var we=Ur(),pe=r(we),Ae=r(pe,!0);o(pe);var la=c(pe,2),Ze=r(la,!0);o(la),o(we),Y(()=>{var Ca;ua(we,1,`day-item ${(Ca=de()?"day-excluded":"")!=null?Ca:""}`),I(Ae,We[ye()]),I(Ze,de()?"No requerido":"Requerido")}),q("click",we,()=>It(ye())),A(ne,we)}),o(ce),o(ge),o(ie);var le=c(ie,2),Ee=r(le),_e=c(Ee,2);o(le),o(H),o(w),q("click",Ie,Ga),q("click",Te,()=>et(!0)),q("click",be,()=>et(!1)),q("click",Ee,Ga),q("click",_e,Kt),q("click",H,jt(function(ne){Pt.call(this,s,ne)})),q("click",w,Ga),A(p,w)};U(ya,p=>{e(Z)&&p(ma)})}var Qe=c(ya,2);{var Ge=p=>{var w=Xr(),H=r(w),X=r(H),ee=r(X),me=c(r(ee));{var Ce=_e=>{var ne=Vr(),ae=r(ne);o(ne),Y(()=>{var ye;return I(ae,`para ${(ye=e(m)[e(V)].name)!=null?ye:""}`)}),A(_e,ne)};U(me,_e=>{e(V)>=0&&e(V)<e(m).length&&_e(Ce)})}o(ee);var Ie=c(ee,2);o(X);var ie=c(X,2),ge=r(ie),he=c(r(ge),4);oa(he,5,()=>Object.entries(e(Se)),wa,(_e,ne)=>{let ae=()=>e(ne)[0],ye=()=>e(ne)[1];var de=Kr(),we=r(de),pe=r(we,!0);o(we);var Ae=c(we,2),la=r(Ae),Ze=r(la),Ca=c(Ze,2),nt=r(Ca,!0);o(Ca);var it=c(Ca,2);o(la),o(Ae),o(de),Y(()=>{var Na;I(pe,We[ae()]),Ze.disabled=ye()<=(((Na=e(m)[e(V)])==null?void 0:Na.min)||1),I(nt,ye())}),q("click",Ze,()=>mt(ae())),q("click",it,()=>Qa(ae())),A(_e,de)}),o(he);var ke=c(he,2),Te=r(ke),be=r(Te);o(Te),o(ke),o(ge),o(ie);var ce=c(ie,2),le=r(ce),Ee=c(le,2);o(ce),o(H),o(w),Y(()=>{var _e;return I(be,`Nota: El máximo global para este rol es ${((_e=e(m)[e(V)])==null?void 0:_e.max)||1}, 
              pero puede configurar un máximo diferente para cada día de la semana.`)}),q("click",Ie,Fa),q("click",le,Fa),q("click",Ee,Za),q("click",H,jt(function(_e){Pt.call(this,s,_e)})),q("click",w,Fa),A(p,w)};U(Qe,p=>{e(R)&&p(Ge)})}Y(()=>{ua(st,1,e(l)?"input-error":""),I(zt,e(h)),I(W,e(_))}),qo(st,()=>e(u),p=>v(u,p)),q("click",yt,Ht),q("click",eo,Gt),q("click",g,Jt),q("click",B,Wt),q("submit",tt,ps(Ut)),A(f,at),no()}var en=M('<div class="error-message"> </div>'),an=M('<button type="button" class="cancel-button">Cancelar</button>'),tn=M('<span class="availability-status limited">Disponibilidad limitada</span>'),on=M('<span class="availability-status full">Disponible todos los días</span>'),sn=M('<tr><td><div class="collaborator-name-cell"> </div></td><td><div class="certifications-cell-simple"><span class="certifications-count-simple"> </span></div></td><td><div class="availability-cell"><!></div></td><td><div class="action-buttons"><button class="icon-button edit" title="Editar colaborador">✏️</button> <button class="icon-button calendar" title="Configurar disponibilidad">📅</button> <button class="icon-button stats" title="Ver estadísticas">📊</button> <button class="icon-button delete" title="Eliminar colaborador">🗑️</button></div></td></tr>'),rn=M('<div class="collaborators-header"><h3>Colaboradores Registrados</h3></div> <div class="collaborators-list"><div class="table-container"><table><thead><tr><th>Nombre</th><th>Certificaciones</th><th>Disponibilidad</th><th>Acciones</th></tr></thead><tbody></tbody></table></div></div>',1),nn=M('<p class="no-data">No hay colaboradores registrados</p>'),ln=M('<span class="selected-indicator">✓</span>'),cn=M('<div><span class="certification-name"> </span> <!></div>'),dn=M('<div class="certifications-list"><div class="certifications-controls"><button type="button" class="control-button select-all-btn" title="Seleccionar todas las certificaciones"><span class="control-icon">✅</span> <span class="control-text">Seleccionar Todas</span></button> <button type="button" class="control-button clear-all-btn" title="Deseleccionar todas las certificaciones"><span class="control-icon">❌</span> <span class="control-text">Deseleccionar Todas</span></button> <div class="selection-counter"><span class="counter-text"> </span> <div class="progress-bar-mini"><div class="progress-fill-mini"></div></div></div></div> <div class="certification-items"></div> <div class="certification-info"><p class="help-text">Selecciona las certificaciones que posee el colaborador <br> Certificaciones seleccionadas: <strong> </strong></p></div></div>'),un=M('<p class="no-data">No hay certificaciones disponibles. Agregue roles primero en la sección de Gestión de Roles</p>'),vn=M('<span class="modal-subtitle"> </span>'),fn=M('<div><div class="day-name"> </div> <div class="day-status"> </div></div>'),mn=M('<div class="modal-backdrop"><div class="modal-content"><div class="modal-header"><h3>Configurar disponibilidad <!></h3> <button class="modal-close">×</button></div> <div class="modal-body"><div class="days-section"><div class="days-header"><h4>Días en que NO está disponible</h4> <div class="days-actions"><button class="days-action-button select-all">Inhabilitar todos</button> <button class="days-action-button clear-all">Habilitar todos</button></div></div> <p class="modal-description">Selecciona los días en que este colaborador NO está disponible:</p> <div class="days-grid"></div></div></div> <div class="modal-footer"><button class="cancel-button">Cancelar</button> <button class="action-button collaborators-button">Guardar Cambios</button></div></div></div>'),gn=M('<div class="frequency-item"><span class="role-name"> </span> <div class="frequency-bar"><div class="frequency-fill"></div> <span class="frequency-count"> </span></div></div>'),pn=M('<div class="stats-section"><h4>Frecuencia por Rol</h4> <div class="roles-frequency"></div></div>'),hn=M('<div class="carousel-controls"><button class="carousel-btn prev-btn" title="Rotación anterior"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button> <span class="carousel-indicator"> </span> <button class="carousel-btn next-btn" title="Siguiente rotación"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div>'),bn=M('<div class="assignment-badge"> </div>'),yn=M('<div class="day-assignments"></div>'),_n=M('<div class="no-assignment">-</div>'),wn=M("<div><!></div>"),Sn=M('<div class="carousel-item"><div class="rotation-card"><div class="rotation-header"><h5> </h5> <div class="rotation-summary"><span class="total-assignments"> </span> <span class="days-worked"> </span></div></div> <div class="rotation-calendar-container"><div class="rotation-calendar"><div class="calendar-header"><div class="calendar-day-header">Lun</div> <div class="calendar-day-header">Mar</div> <div class="calendar-day-header">Mié</div> <div class="calendar-day-header">Jue</div> <div class="calendar-day-header">Vie</div></div> <div class="calendar-body"></div></div></div></div></div>'),Cn=M("<button></button>"),xn=M('<div class="carousel-dots"></div>'),Rn=M('<div class="stats-section"><div class="rotations-header"><h4>Historial de Rotaciones</h4> <!></div> <div class="rotations-carousel"><div class="carousel-container"><div class="carousel-track"></div></div> <!></div></div>'),kn=M('<div class="no-data">Este colaborador no tiene asignaciones en ninguna rotación registrada.</div>'),En=M('<div class="modal-backdrop"><div class="modal-content stats-modal"><div class="modal-header"><h3> </h3> <button class="modal-close">×</button></div> <div class="modal-body"><div class="stats-summary"><div class="summary-cards"><div class="summary-card"><div class="card-value"> </div> <div class="card-label">Total Asignaciones</div></div> <div class="summary-card"><div class="card-value"> </div> <div class="card-label">Rotaciones</div></div> <div class="summary-card"><div class="card-value"> </div> <div class="card-label">Roles Diferentes</div></div></div></div> <!> <!></div> <div class="modal-footer"><button class="cancel-button">Cerrar</button></div></div></div>'),An=M('<section class="section-container collaborators-section"><h2>Gestión de Colaboradores</h2> <div class="content"><form class="collaborator-form"><div class="form-group"><label for="collaboratorName">Nombre del Colaborador:</label> <input id="collaboratorName" type="text" placeholder="Nombre del Colaborador" required></div> <!> <div class="form-actions"><button type="submit" class="action-button collaborators-button"> </button> <!></div></form> <!> <div class="certifications-header"><h3> </h3></div> <!></div> <!> <!></section>');function Dn(f,s){ro(s,!1);let l=K(""),u=K([]),h=K(-1),_=K(""),k=K([]),m=K([]),j=K(!1),oe={monday:!1,tuesday:!1,wednesday:!1,thursday:!1,friday:!1},se=K(!1),N=K(-1),C=K(ve({},oe)),y=K(!1),z=K(null),F=K({rotations:[],totalAssignments:0,rolesFrequency:{},monthlyBreakdown:{}}),Q=K(0);const Z={monday:"Lunes",tuesday:"Martes",wednesday:"Miércoles",thursday:"Jueves",friday:"Viernes"};let $=null,G=null,R=null;io(()=>L(this,null,function*(){try{console.log("🚀 Inicializando CollaboratorsManagement..."),yield xe.init(),console.log("✅ Servicio de base de datos inicializado"),yield V(),$=xe.subscribe("roles",Ye),G=xe.subscribe("collaborators",ra),R=xe.subscribe("rotations",na),console.log("✅ Suscripciones configuradas"),v(j,!0),console.log("✅ CollaboratorsManagement inicializado correctamente")}catch(g){console.error("❌ Error inicializando CollaboratorsManagement:",g),yield Ne(),v(j,!0)}})),go(()=>{$&&$(),G&&G(),R&&R(),document.removeEventListener("keydown",ha)});function V(){return L(this,null,function*(){try{const g=yield xe.getAll("collaborators");v(u,g.map(Va)),console.log(`✅ ${e(u).length} colaboradores cargados`),yield Se()}catch(g){console.error("❌ Error cargando datos desde servicio:",g),yield Ne()}})}function Se(){return L(this,null,function*(){try{const g=yield xe.getAll("roles");v(k,g.map(T=>T.name)),console.log(`✅ ${e(k).length} certificaciones cargadas`)}catch(g){console.error("❌ Error cargando certificaciones:",g),O()}})}function Ne(){return L(this,null,function*(){console.log("📁 Usando fallback a localStorage...");try{const g=localStorage.getItem("gestionRotaciones_collaborators");if(g){const T=JSON.parse(g);v(u,T.map(Va)),console.log(`📁 ${e(u).length} colaboradores cargados desde localStorage`)}O()}catch(g){console.error("❌ Error en fallback localStorage:",g),v(u,[]),v(k,[])}})}function O(){try{const g=localStorage.getItem("gestionRotaciones_roles");if(g){const T=JSON.parse(g);Array.isArray(T)&&T.length>0?v(k,T.map(W=>W&&typeof W=="object"&&W.name?W.name:String(W))):v(k,[])}else v(k,[]);console.log(`📁 ${e(k).length} certificaciones cargadas desde localStorage`)}catch(g){console.error("❌ Error cargando certificaciones desde localStorage:",g),v(k,[])}}function We(){return L(this,null,function*(){if(e(j))try{yield xe.saveAll("collaborators",e(u)),console.log("✅ Colaboradores guardados correctamente")}catch(g){console.error("❌ Error guardando colaboradores:",g),Je()}})}function Je(){try{localStorage.setItem("gestionRotaciones_collaborators",JSON.stringify(e(u))),console.log("💾 Colaboradores guardados en localStorage (fallback)")}catch(g){console.error("❌ Error guardando en localStorage:",g)}}function Ye(g){(g.action==="save"||g.action==="saveAll")&&(console.log("🔄 Roles actualizados, recargando certificaciones..."),Se()),g.action==="rename"&&g.data&&g.data.oldName&&g.data.newName&&(console.log(`🔄 Rol renombrado de "${g.data.oldName}" a "${g.data.newName}"`),sa(g.data.oldName,g.data.newName)),g.action==="delete"&&g.data&&g.data.roleName&&(console.log(`🔄 Rol eliminado: "${g.data.roleName}"`),ia(g.data.roleName))}function ra(g){g.action==="saveAll"&&g.data&&e(j)&&console.log("🔄 Colaboradores actualizados externamente")}function na(g){e(y)&&e(z)&&(console.log("🔄 Rotaciones actualizadas, recargando estadísticas..."),Ga(e(z)))}function sa(g,T){return L(this,null,function*(){try{console.log(`🔄 Actualizando certificaciones: ${g} → ${T}`);let W=!1,B=0;const J=e(u).map(ue=>{if(ue.certifications&&ue.certifications.includes(g)){const De=ue.certifications.map($e=>$e===g?T:$e);return W=!0,B++,console.log(`✅ Actualizada certificación para ${ue.name}`),Aa(ve({},ue),{certifications:De})}return ue});W&&(v(u,J),yield We(),Me(`Certificaciones actualizadas: ${g} → ${T} (${B} colaboradores)`,!0))}catch(W){console.error("❌ Error actualizando certificaciones:",W),Me("Error al actualizar certificaciones",!1)}})}function ia(g){return L(this,null,function*(){try{console.log(`🔄 Eliminando certificación: ${g}`);let T=!1,W=0;const B=e(u).map(J=>{if(J.certifications&&J.certifications.includes(g)){const ue=J.certifications.filter(De=>De!==g);return T=!0,W++,console.log(`✅ Eliminada certificación "${g}" de ${J.name}`),Aa(ve({},J),{certifications:ue})}return J});T&&(v(u,B),yield We(),Me(`Certificación "${g}" eliminada de ${W} colaboradores`,!0))}catch(T){console.error("❌ Error eliminando certificación:",T),Me("Error al eliminar certificación",!1)}})}let Ve="",va=null;function Me(g,T=!0){Ve=g,va&&clearTimeout(va),va=setTimeout(()=>{},5e3)}function Va(g){return Aa(ve({},g),{certifications:Array.isArray(g.certifications)?g.certifications:g.certifications?[g.certifications]:[],unavailableDays:g.unavailableDays||ve({},oe)})}function Ka(g){return g.trim().length<3?"El nombre debe tener al menos 3 caracteres":null}function Dt(){v(_,"");const g=Ka(e(l));if(g){v(_,g);return}const T=e(l).trim();if(e(u).find((J,ue)=>J.name.toLowerCase()===T.toLowerCase()&&ue!==e(h))){v(_,"Ya existe un colaborador con este nombre");return}let B={name:T,certifications:[...e(m)],unavailableDays:ve({},oe)};if(e(h)===-1)v(u,[...e(u),B]),Me(`Colaborador "${T}" agregado exitosamente`,!0);else{const J=[...e(u)],ue=J[e(h)];B.unavailableDays=ue.unavailableDays||ve({},oe),J[e(h)]=B,v(u,J),v(h,-1),Me(`Colaborador "${T}" actualizado exitosamente`,!0)}Ke()}function Ke(){v(l,""),v(m,[])}function Gt(g){const T=e(u)[g];v(l,T.name),v(m,Array.isArray(T.certifications)?[...T.certifications]:[]),v(h,g)}function Ht(g){const T=e(u)[g].name;v(u,e(u).filter((W,B)=>B!==g)),e(h)===g&&(Ke(),v(h,-1)),Me(`Colaborador "${T}" eliminado`,!0)}function Wt(g){e(m).includes(g)?v(m,e(m).filter(T=>T!==g)):v(m,[...e(m),g])}function Jt(){v(m,[...e(k)]),console.log(`✅ ${e(m).length} certificaciones seleccionadas`)}function Ut(){v(m,[]),console.log("❌ Todas las certificaciones deseleccionadas")}function Mt(g){const T=e(u)[g];v(C,ve({},T.unavailableDays||oe)),v(N,g),v(se,!0)}function za(){v(se,!1),v(N,-1),v(C,ve({},oe))}function $t(g){v(C,Aa(ve({},e(C)),{[g]:!e(C)[g]}))}function Yt(){if(e(N)>=0&&e(N)<e(u).length){const g=[...e(u)];g[e(N)].unavailableDays=ve({},e(C)),v(u,g),za(),Me(`Disponibilidad actualizada para ${e(u)[e(N)].name}`,!0)}}function Tt(g=!0){const T={};Object.keys(e(C)).forEach(W=>{T[W]=g}),v(C,T)}function Xa(g){g==="next"&&e(Q)<e(F).rotations.length-1?ts(Q):g==="prev"&&e(Q)>0&&ts(Q,-1),console.log(`🎠 Navegando a rotación ${e(Q)+1} de ${e(F).rotations.length}`)}function vt(g){g>=0&&g<e(F).rotations.length&&(v(Q,g),console.log(`🎯 Saltando a rotación ${g+1}`))}function ha(g){if(!(!e(y)||e(F).rotations.length<=1))switch(g.key){case"ArrowLeft":g.preventDefault(),Xa("prev");break;case"ArrowRight":g.preventDefault(),Xa("next");break;case"Home":g.preventDefault(),vt(0);break;case"End":g.preventDefault(),vt(e(F).rotations.length-1);break}}function Vt(g){return L(this,null,function*(){v(z,g),v(y,!0),v(Q,0),yield Ga(g),document.addEventListener("keydown",ha)})}function ft(){v(y,!1),v(z,null),v(Q,0),v(F,{rotations:[],totalAssignments:0,rolesFrequency:{},monthlyBreakdown:{}}),document.removeEventListener("keydown",ha)}function Ga(g){return L(this,null,function*(){try{const T=yield xe.getAll("rotations"),W={rotations:[],totalAssignments:0,rolesFrequency:{},monthlyBreakdown:{}};T.forEach(B=>{const J=It(B,g.name);if(J.totalAssignments>0){W.rotations.push(J),W.totalAssignments+=J.totalAssignments,Object.entries(J.rolesFrequency).forEach(([De,$e])=>{W.rolesFrequency[De]=(W.rolesFrequency[De]||0)+$e});const ue=`${B.year}-${B.month.toString().padStart(2,"0")}`;W.monthlyBreakdown[ue]=J.totalAssignments}}),W.rotations.sort((B,J)=>{const ue=new Date(B.year,B.month-1);return new Date(J.year,J.month-1)-ue}),v(F,W),console.log(`📊 Estadísticas cargadas para ${g.name}:`,W)}catch(T){console.error("❌ Error cargando estadísticas:",T);const W=localStorage.getItem("gestionRotaciones_currentRotation");if(W)try{const B=JSON.parse(W),J=It(B,g.name);J.totalAssignments>0&&v(F,{rotations:[J],totalAssignments:J.totalAssignments,rolesFrequency:J.rolesFrequency,monthlyBreakdown:{[`${B.year}-${B.month.toString().padStart(2,"0")}`]:J.totalAssignments}})}catch(B){console.error("❌ Error procesando rotación de localStorage:",B)}}})}function It(g,T){const W=["monday","tuesday","wednesday","thursday","friday"],B=["Lunes","Martes","Miércoles","Jueves","Viernes"],J={year:g.year,month:g.month,monthName:new Date(g.year,g.month-1).toLocaleString("es-ES",{month:"long"}),assignments:{},totalAssignments:0,rolesFrequency:{},daysWorked:0};return W.forEach((ue,De)=>{J.assignments[ue]={dayName:B[De],roles:[]}}),g.assignments&&W.forEach(ue=>{const De=g.assignments[ue]||{};let $e=!1;Object.entries(De).forEach(([Re,Pe])=>{Array.isArray(Pe)&&Pe.includes(T)&&(J.assignments[ue].roles.push(Re),J.totalAssignments++,J.rolesFrequency[Re]=(J.rolesFrequency[Re]||0)+1,$e=!0)}),$e&&J.daysWorked++}),J}function Kt(g,T){return`${new Date(g,T-1).toLocaleString("es-ES",{month:"long"})} ${g}`}function Xt(g){if(!g)return"Disponible todos los días";const T=Object.entries(g).filter(([W,B])=>B).map(([W,B])=>Z[W]);return T.length>0?`No disponible: ${T.join(", ")}`:"Disponible todos los días"}function Fa(g){return g.unavailableDays?Object.values(g.unavailableDays).some(T=>T):!1}Pa(()=>(e(j),e(u)),()=>{e(j)&&e(u)&&We()}),Pa(()=>(e(Q),e(F)),()=>{e(Q)>=e(F).rotations.length&&e(F).rotations.length>0&&v(Q,e(F).rotations.length-1)}),Pa(()=>(e(y),e(F),e(Q)),()=>{e(y)&&e(F).rotations.length>0&&console.log(`📊 Mostrando rotación ${e(Q)+1} de ${e(F).rotations.length}`)}),No(),so();var Qa=An(),mt=c(r(Qa),2),Za=r(mt),et=r(Za),Ba=c(r(et),2);Io(Ba),o(et);var gt=c(et,2);{var Qt=g=>{var T=en(),W=r(T,!0);o(T),Y(()=>I(W,e(_))),A(g,T)};U(gt,g=>{e(_)&&g(Qt)})}var qt=c(gt,2),at=r(qt),pt=r(at,!0);o(at);var Ot=c(at,2);{var tt=g=>{var T=an();q("click",T,()=>{Ke(),v(h,-1)}),A(g,T)};U(Ot,g=>{e(h)!==-1&&g(tt)})}o(qt),o(Za);var ot=c(Za,2);{var st=g=>{var T=rn(),W=c(At(T),2),B=r(W),J=r(B),ue=c(r(J));oa(ue,5,()=>e(u),wa,(De,$e,Re)=>{var Pe=sn(),Xe=r(Pe),ba=r(Xe),Sa=r(ba,!0);o(ba),o(Xe);var fa=c(Xe),ya=r(fa),ma=r(ya),Qe=r(ma);o(ma),o(ya),o(fa);var Ge=c(fa),p=r(Ge),w=r(p);{var H=he=>{var ke=tn();Y(Te=>Oa(ke,"title",Te),[()=>Xt(e($e).unavailableDays)],je),A(he,ke)},X=he=>{var ke=on();A(he,ke)};U(w,he=>{Fa(e($e))?he(H):he(X,!1)})}o(p),o(Ge);var ee=c(Ge),me=r(ee),Ce=r(me),Ie=c(Ce,2),ie=c(Ie,2),ge=c(ie,2);o(me),o(ee),o(Pe),Y((he,ke)=>{var Te;ua(Pe,1,he),I(Sa,e($e).name),Oa(ma,"title",ke),I(Qe,`${((Te=e($e).certifications)==null?void 0:Te.length)||0} certificaciones`)},[()=>_r(Fa(e($e))?"partially-unavailable-row":""),()=>{var he;return((he=e($e).certifications)==null?void 0:he.length)>0?e($e).certifications.join(", "):"Sin certificaciones"}],je),q("click",Ce,()=>Gt(Re)),q("click",Ie,()=>Mt(Re)),q("click",ie,()=>Vt(e($e))),q("click",ge,()=>Ht(Re)),A(De,Pe)}),o(ue),o(J),o(B),o(W),A(g,T)},Zt=g=>{var T=nn();A(g,T)};U(ot,g=>{e(u).length>0?g(st):g(Zt,!1)})}var ht=c(ot,2),rt=r(ht),bt=r(rt);o(rt),o(ht);var ka=c(ht,2);{var yt=g=>{var T=dn(),W=r(T),B=r(W),J=c(B,2),ue=c(J,2),De=r(ue),$e=r(De);o(De);var Re=c(De,2),Pe=r(Re);o(Re),o(ue),o(W);var Xe=c(W,2);oa(Xe,5,()=>e(k),wa,(ma,Qe)=>{var Ge=cn(),p=r(Ge),w=r(p,!0);o(p);var H=c(p,2);{var X=ee=>{var me=ln();A(ee,me)};U(H,ee=>{e(m).includes(e(Qe))&&ee(X)})}o(Ge),Y(ee=>{ua(Ge,1,`certification-item ${ee!=null?ee:""}`),I(w,e(Qe))},[()=>e(m).includes(e(Qe))?"selected":""],je),q("click",Ge,()=>Wt(e(Qe))),A(ma,Ge)}),o(Xe);var ba=c(Xe,2),Sa=r(ba),fa=c(r(Sa),3),ya=r(fa,!0);o(fa),o(Sa),o(ba),o(T),Y(ma=>{var Qe,Ge,p;B.disabled=e(m).length===e(k).length,J.disabled=e(m).length===0,I($e,`${(Qe=e(m).length)!=null?Qe:""} de ${(Ge=e(k).length)!=null?Ge:""} seleccionadas`),Ya(Pe,`width: ${(p=e(k).length>0?e(m).length/e(k).length*100:0)!=null?p:""}%`),I(ya,ma)},[()=>e(m).length>0?e(m).join(", "):"Ninguna"],je),q("click",B,Jt),q("click",J,Ut),A(g,T)},_t=g=>{var T=un();A(g,T)};U(ka,g=>{e(k).length>0?g(yt):g(_t,!1)})}o(mt);var zt=c(mt,2);{var eo=g=>{var T=mn(),W=r(T),B=r(W),J=r(B),ue=c(r(J));{var De=p=>{var w=vn(),H=r(w);o(w),Y(()=>{var X;return I(H,`para ${(X=e(u)[e(N)].name)!=null?X:""}`)}),A(p,w)};U(ue,p=>{e(N)>=0&&e(N)<e(u).length&&p(De)})}o(J);var $e=c(J,2);o(B);var Re=c(B,2),Pe=r(Re),Xe=r(Pe),ba=c(r(Xe),2),Sa=r(ba),fa=c(Sa,2);o(ba),o(Xe);var ya=c(Xe,4);oa(ya,5,()=>Object.entries(e(C)),wa,(p,w)=>{let H=()=>e(w)[0],X=()=>e(w)[1];var ee=fn(),me=r(ee),Ce=r(me,!0);o(me);var Ie=c(me,2),ie=r(Ie,!0);o(Ie),o(ee),Y(()=>{var ge;ua(ee,1,`day-item ${(ge=X()?"day-unavailable":"")!=null?ge:""}`),I(Ce,Z[H()]),I(ie,X()?"No disponible":"Disponible")}),q("click",ee,()=>$t(H())),A(p,ee)}),o(ya),o(Pe),o(Re);var ma=c(Re,2),Qe=r(ma),Ge=c(Qe,2);o(ma),o(W),o(T),q("click",$e,za),q("click",Sa,()=>Tt(!0)),q("click",fa,()=>Tt(!1)),q("click",Qe,za),q("click",Ge,Yt),q("click",W,jt(function(p){Pt.call(this,s,p)})),q("click",T,za),A(g,T)};U(zt,g=>{e(se)&&g(eo)})}var Ft=c(zt,2);{var wt=g=>{var T=En(),W=r(T),B=r(W),J=r(B),ue=r(J);o(J);var De=c(J,2);o(B);var $e=c(B,2),Re=r($e),Pe=r(Re),Xe=r(Pe),ba=r(Xe),Sa=r(ba,!0);o(ba),Da(2),o(Xe);var fa=c(Xe,2),ya=r(fa),ma=r(ya,!0);o(ya),Da(2),o(fa);var Qe=c(fa,2),Ge=r(Qe),p=r(Ge,!0);o(Ge),Da(2),o(Qe),o(Pe),o(Re);var w=c(Re,2);{var H=ie=>{var ge=pn(),he=c(r(ge),2);oa(he,5,()=>Object.entries(e(F).rolesFrequency).sort((ke,Te)=>Te[1]-ke[1]),wa,(ke,Te)=>{let be=()=>e(Te)[0],ce=()=>e(Te)[1];var le=gn(),Ee=r(le),_e=r(Ee,!0);o(Ee);var ne=c(Ee,2),ae=r(ne),ye=c(ae,2),de=r(ye,!0);o(ye),o(ne),o(le),Y(()=>{I(_e,be()),Ya(ae,`width: ${ce()/e(F).totalAssignments*100}%`),I(de,ce())}),A(ke,le)}),o(he),o(ge),A(ie,ge)};U(w,ie=>{Object.keys(e(F).rolesFrequency).length>0&&ie(H)})}var X=c(w,2);{var ee=ie=>{var ge=Rn(),he=r(ge),ke=c(r(he),2);{var Te=ne=>{var ae=hn(),ye=r(ae),de=c(ye,2),we=r(de);o(de);var pe=c(de,2);o(ae),Y(()=>{var Ae;ye.disabled=e(Q)===0,I(we,`${e(Q)+1} de ${(Ae=e(F).rotations.length)!=null?Ae:""}`),pe.disabled=e(Q)===e(F).rotations.length-1}),q("click",ye,()=>Xa("prev")),q("click",pe,()=>Xa("next")),A(ne,ae)};U(ke,ne=>{e(F).rotations.length>1&&ne(Te)})}o(he);var be=c(he,2),ce=r(be),le=r(ce);oa(le,5,()=>e(F).rotations,wa,(ne,ae)=>{var ye=Sn(),de=r(ye),we=r(de),pe=r(we),Ae=r(pe,!0);o(pe);var la=c(pe,2),Ze=r(la),Ca=r(Ze);o(Ze);var nt=c(Ze,2),it=r(nt);o(nt),o(la),o(we);var Na=c(we,2),St=r(Na),Ct=c(r(St),2);oa(Ct,4,()=>["monday","tuesday","wednesday","thursday","friday"],wa,(lt,La)=>{var He=wn(),Ma=r(He);{var xt=$a=>{var Rt=yn();oa(Rt,5,()=>e(ae).assignments[La].roles,wa,(lo,ct)=>{var kt=bn(),po=r(kt,!0);o(kt),Y(co=>{Oa(kt,"title",e(ct)),I(po,co)},[()=>e(ct).length>8?e(ct).substring(0,8)+"...":e(ct)],je),A(lo,kt)}),o(Rt),A($a,Rt)},ao=$a=>{var Rt=_n();A($a,Rt)};U(Ma,$a=>{e(ae).assignments[La].roles.length>0?$a(xt):$a(ao,!1)})}o(He),Y(()=>{var $a;return ua(He,1,`calendar-day ${($a=e(ae).assignments[La].roles.length>0?"has-assignments":"")!=null?$a:""}`)}),A(lt,He)}),o(Ct),o(St),o(Na),o(de),o(ye),Y(lt=>{var La,He;I(Ae,lt),I(Ca,`${(La=e(ae).totalAssignments)!=null?La:""} asignaciones`),I(it,`${(He=e(ae).daysWorked)!=null?He:""} días trabajados`)},[()=>Kt(e(ae).year,e(ae).month)],je),A(ne,ye)}),o(le),o(ce);var Ee=c(ce,2);{var _e=ne=>{var ae=xn();oa(ae,5,()=>e(F).rotations,wa,(ye,de,we)=>{var pe=Cn();Oa(pe,"title",`Ir a rotación ${we+1}`),Y(()=>{var Ae;return ua(pe,1,`dot ${(Ae=we===e(Q)?"active":"")!=null?Ae:""}`)}),q("click",pe,()=>vt(we)),A(ye,pe)}),o(ae),A(ne,ae)};U(Ee,ne=>{e(F).rotations.length>1&&ne(_e)})}o(be),o(ge),Y(()=>Ya(le,`transform: translateX(-${e(Q)*100}%)`)),A(ie,ge)},me=ie=>{var ge=kn();A(ie,ge)};U(X,ie=>{e(F).rotations.length>0?ie(ee):ie(me,!1)})}o($e);var Ce=c($e,2),Ie=r(Ce);o(Ce),o(W),o(T),Y(ie=>{var ge;I(ue,`Estadísticas de ${(ge=e(z).name)!=null?ge:""}`),I(Sa,e(F).totalAssignments),I(ma,e(F).rotations.length),I(p,ie)},[()=>Object.keys(e(F).rolesFrequency).length],je),q("click",De,ft),q("click",Ie,ft),q("click",W,jt(function(ie){Pt.call(this,s,ie)})),q("click",T,ft),A(g,T)};U(Ft,g=>{e(y)&&e(z)&&g(wt)})}o(Qa),Y(()=>{var g;I(pt,e(h)===-1?"Agregar Colaborador":"Actualizar Colaborador"),I(bt,`Certificaciones Disponibles (${(g=e(k).length)!=null?g:""})`)}),qo(Ba,()=>e(l),g=>v(l,g)),q("submit",Za,ps(Dt)),A(f,Qa),no()}var Mn=M('<span class="date-range"> </span>'),$n=M('<div class="first-rotation-notice"><span class="notice-icon">🆕</span> <span class="notice-text">Primera rotación - Genere para establecer el calendario</span></div>'),Tn=M('<div class="rotation-history-info"><span class="history-icon">📅</span> <span class="history-text"> </span></div>'),In=M('<div class="progress-bar"><div class="progress-fill current-week-progress"></div></div> <span class="progress-text">Progreso de la semana actual</span>',1),qn=M('<div class="progress-bar"><div class="progress-fill future-week-progress" style="width: 0%"></div></div> <span class="progress-text">Semana futura - Aún no iniciada</span>',1),On=M('<div class="progress-bar"><div class="progress-fill past-week-progress" style="width: 100%"></div></div> <span class="progress-text">Semana completada</span>',1),zn=M('<div class="indicator setup"><span class="indicator-icon">⚙️</span> <span class="indicator-text">Configuración inicial</span></div>'),Fn=M('<div class="indicator has-assignments"><span class="indicator-icon">✅</span> <span class="indicator-text"> </span></div>'),Bn=M('<div class="indicator no-assignments"><span class="indicator-icon">⚪</span> <span class="indicator-text">Sin asignaciones</span></div>'),Nn=M('<div> <button class="close-message">×</button></div>'),Ln=M('<span class="loading-step"></span>'),jn=M('<div class="progress-bar-loading"><div class="progress-fill-loading"></div></div> <span class="progress-percentage"></span>',1),Pn=M('<div class="loading-overlay"><div class="spinner"></div> <div class="loading-info"><p>Generando rotación...</p> <!> <!></div></div>'),Gn=M("<th> </th>"),Hn=M('<span class="priority-badge">Prioridad Baja</span>'),Wn=M('<div class="role-excluded"><span class="excluded-icon">🚫</span> <span class="excluded-text">No requerido</span></div>'),Jn=M('<div title="Clic para editar asignaciones"><div class="assignment-content"><span class="assignment-text"> </span></div></div>'),Un=M('<button class="assignment-button empty" title="Clic para asignar colaboradores"><span class="button-placeholder"><span class="plus-icon">+</span> Asignar</span></button>'),Yn=M('<td class="assignment-cell"><!></td>'),Vn=M('<tr><td class="role-cell"><div class="role-info"><span class="role-name"> </span> <!> <div class="role-requirements"><span class="req-min"> </span> <span class="req-max"> </span></div></div></td><!></tr>'),Kn=M('<tr><td colspan="6" class="no-data"><div class="no-data-content"><span class="no-data-icon">📋</span> <span class="no-data-text">No hay roles configurados</span> <span class="no-data-hint">Por favor, agregue roles primero en la sección de Gestión de Roles</span></div></td></tr>'),Xn=M('<div class="status-item"><span class="status-label">Desde:</span> <span class="status-value"> </span></div>'),Qn=M('<button class="action-button stats-button" title="Mostrar análisis de días consecutivos"><span class="button-icon">📊</span> <span class="button-text">Análisis</span></button> <button class="action-button analysis-button" title="Análisis completo de calidad de la rotación"><span class="button-icon">🔬</span> <span class="button-text">Análisis Avanzado</span></button>',1),Zn=M('<button class="action-button debug-button" title="Mostrar información de depuración en consola"><span class="button-icon">🔍</span> <span class="button-text">Debug</span></button>'),ei=M('<span class="modal-subtitle"> </span>'),ai=M('<div class="role-requirements-info"><div class="role-context"><h4>Información del Rol</h4> <div class="context-details"><span class="context-item"><span class="context-label">Rotación:</span> <span class="context-value"> </span></span> <span class="context-item"><span class="context-label">Estado:</span> <span class="context-value"> </span></span></div></div> <div class="requirements-grid"><div class="req-item"><span class="req-label">Mínimo:</span> <span class="req-value"> </span></div> <div class="req-item"><span class="req-label">Máximo:</span> <span class="req-value"> </span></div> <div class="req-item"><span class="req-label">Actual:</span> <span class="req-value current"> </span></div> <div class="req-item"><span class="req-label">Faltantes:</span> <span class="req-value needed"> </span></div></div></div>'),ti=M('<div class="assigned-collaborator"><span class="collaborator-name"> </span> <button class="remove-button" title="Quitar de la asignación"><span class="remove-icon">×</span></button></div>'),oi=M('<div class="currently-assigned"><h4><span class="section-icon">✅</span> </h4> <div class="assigned-list"></div></div>'),si=M('<div class="availability-warning"><span class="warning-icon">⚠️</span> <span class="warning-text">Disponibilidad limitada</span></div>'),ri=M('<div class="assigned-indicator"><span class="assigned-icon">✓</span> <span class="assigned-text">Asignado</span></div>'),ni=M('<div><div class="collaborator-info"><div class="collaborator-name"> </div> <div class="collaborator-certifications"><span class="cert-count"> </span> <span class="cert-label">certificaciones</span></div> <!> <!></div></div>'),ii=M('<div class="collaborators-list"><h4><span class="section-icon">👤</span> </h4> <div class="collaborators-grid"></div></div>'),li=M(`<div class="no-data"><div class="no-data-content"><span class="no-data-icon">😔</span> <span class="no-data-text">No hay colaboradores disponibles</span> <span class="no-data-hint">No hay colaboradores que puedan cubrir este rol en este día.
                  Verifique las certificaciones y disponibilidad.</span></div></div>`),ci=M('<div class="modal-backdrop"><div class="modal-content"><div class="modal-header"><h3><span class="modal-icon">👥</span> Asignar Colaborador <!></h3> <button class="modal-close">×</button></div> <div class="modal-body"><!> <!> <!></div> <div class="modal-footer"><div class="modal-info"><span class="info-text"><!></span></div> <div class="modal-actions"><button class="cancel-button"><span class="button-icon">❌</span> <span class="button-text">Cerrar</span></button></div></div></div></div>'),di=M('<section class="section-container rotation-section"><h2>Gestión de Rotación</h2> <div class="content"><div><div class="rotation-navigation"><button class="nav-button" title="Rotación anterior"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button> <div class="rotation-title-container"><h3 class="rotation-title desktop-title"> </h3> <h3 class="rotation-title mobile-title"> </h3> <div class="rotation-info"><div class="week-status-container"><span class="week-indicator"> </span> <span> </span></div> <!> <!> <!></div></div> <button class="nav-button" title="Siguiente rotación"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div> <div class="week-progress"><!></div> <div class="rotation-indicators"><!> <!></div></div> <!> <div class="rotation-table-container"><!> <table class="rotation-table"><thead><tr><th class="role-header">Roles</th><!></tr></thead><tbody><!></tbody></table></div> <div class="data-status"><div class="status-grid"><div class="status-item"><span class="status-label">Roles disponibles:</span> <span class="status-value"> </span></div> <div class="status-item"><span class="status-label">Colaboradores:</span> <span class="status-value"> </span></div> <div class="status-item"><span class="status-label">Roles compartidos:</span> <span class="status-value"> </span></div> <div class="status-item"><span class="status-label">Total asignaciones:</span> <span class="status-value"> </span></div> <!></div></div> <div class="rotation-actions"><button class="action-button refresh-button" title="Actualizar datos desde la base de datos"><span class="button-icon">🔄</span> <span class="button-text">Actualizar</span></button> <button class="action-button generate-button"><span class="button-icon"> </span> <span class="button-text"> </span></button> <button class="action-button export-button" title="Descargar calendario de rotación como imagen PNG compacta"><span class="button-icon">📸</span> <span class="button-text">Exportar Imagen</span></button> <button class="action-button clear-button" title="Limpiar todas las asignaciones de esta rotación"><span class="button-icon">🧹</span> <span class="button-text">Limpiar</span></button> <!> <!></div></div> <!></section>');function ui(f,s){ro(s,!1);let l=K([]),u=K([]),h=K([]),_=K(!1),k={blue:[],orange:[],green:[]},m=K({}),j=K(""),oe=K(!0),se=K(!1),N=K(!1),C=K(1),y=K({monday:new Date,friday:new Date}),z=K(null);const F=[{id:"monday",name:"Lunes"},{id:"tuesday",name:"Martes"},{id:"wednesday",name:"Miércoles"},{id:"thursday",name:"Jueves"},{id:"friday",name:"Viernes"}];let Q=K(!1),Z=K(null),$=K(null),G=K([]),R=K([]),V=null,Se=null,Ne=null;io(()=>L(this,null,function*(){try{console.log("🚀 Inicializando RotationManagement..."),yield xe.init(),console.log("✅ Servicio de base de datos inicializado"),yield O(),yield na(),V=xe.subscribe("roles",Gt),Se=xe.subscribe("collaborators",Ht),Ne=xe.subscribe("coverage",Wt),console.log("✅ Suscripciones configuradas"),v(_,!0),console.log("✅ RotationManagement inicializado correctamente")}catch(a){console.error("❌ Error en inicialización:",a),yield Yt(),yield We(),$t(),v(_,!0)}})),go(()=>{V&&V(),Se&&Se(),Ne&&Ne()});function O(){return L(this,null,function*(){try{console.log("📖 Cargando datos desde servicio...");const[a,t,n,i]=yield Promise.all([xe.getAll("roles"),xe.getAll("collaborators"),xe.getById("coverage",1),xe.getById("colorGroups",1)]);v(l,a||[]),v(u,(t||[]).map(za)),v(h,(n==null?void 0:n.roleNames)||[]),k=(i==null?void 0:i.groups)||{blue:[],orange:[],green:[]},console.log(`✅ Datos cargados: ${e(l).length} roles, ${e(u).length} colaboradores`)}catch(a){console.error("❌ Error cargando datos desde servicio:",a),yield We()}})}function We(){return L(this,null,function*(){console.log("🔍 Usando fallback a localStorage...");try{const a=localStorage.getItem("gestionRotaciones_roles"),t=localStorage.getItem("gestionRotaciones_collaborators"),n=localStorage.getItem("gestionRotaciones_coverage"),i=localStorage.getItem("gestionRotaciones_colorGroups");v(l,a?JSON.parse(a):[]),v(u,t?JSON.parse(t).map(za):[]),v(h,n?JSON.parse(n):[]),k=i?JSON.parse(i):{blue:[],orange:[],green:[]},console.log("💾 Datos cargados desde localStorage")}catch(a){console.error("❌ Error en fallback localStorage:",a)}})}function Je(){return L(this,null,function*(){if(e(_))try{yield Ye(),console.log("✅ Rotación guardada correctamente")}catch(a){console.error("❌ Error guardando rotación:",a)}})}function Ye(){return L(this,null,function*(){try{const a={id:`rotation_${e(C)}`,rotationNumber:e(C),year:e(y).monday?e(y).monday.getFullYear():new Date().getFullYear(),month:e(y).monday?e(y).monday.getMonth()+1:new Date().getMonth()+1,weekStartDate:e(y).monday?e(y).monday.toISOString():new Date().toISOString(),weekEndDate:e(y).friday?e(y).friday.toISOString():new Date().toISOString(),assignments:e(m),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{yield xe.save("rotations",a),console.log(`✅ Rotación #${e(C)} guardada en BD`)}catch(i){console.log("⚠️ Error guardando en BD:",i)}const t=`gestionRotaciones_rotation_${e(C)}`;localStorage.setItem(t,JSON.stringify(a)),localStorage.setItem("gestionRotaciones_currentRotation",JSON.stringify(a));const n={firstRotationDate:e(z)?e(z).toISOString():new Date().toISOString(),currentRotation:e(C),totalRotations:e(C),lastUpdated:new Date().toISOString()};localStorage.setItem("gestionRotaciones_config",JSON.stringify(n))}catch(a){console.error("❌ Error guardando rotación:",a)}})}function ra(a){return L(this,null,function*(){try{console.log(`🔍 Cargando rotación #${a}...`);const t={};F.forEach(i=>{t[i.id]={}}),v(m,t);let n=null;try{n=(yield xe.getAll("rotations")).find(d=>d.rotationNumber===a)}catch(i){console.log("⚠️ BD no disponible, buscando en localStorage...")}if(!n){const i=[`gestionRotaciones_rotation_${a}`,"gestionRotaciones_currentRotation"];for(const d of i){const b=localStorage.getItem(d);if(b)try{const E=JSON.parse(b);if(E.rotationNumber===a||a===1){n=E;break}}catch(E){console.log(`❌ Error parseando ${d}:`,E)}}}n&&n.assignments?(v(m,ve({},n.assignments)),console.log(`✅ Asignaciones de rotación #${a} cargadas correctamente`),v(m,e(m))):console.log(`ℹ️ Rotación #${a} no encontrada - iniciando vacía`)}catch(t){console.error("❌ Error cargando rotación:",t),$t()}})}function na(){return L(this,null,function*(){try{console.log("🔄 Inicializando sistema de rotaciones...");let a=null;try{const t=localStorage.getItem("gestionRotaciones_config");t&&(a=JSON.parse(t))}catch(t){console.log("⚠️ Error cargando configuración:",t)}if(a&&a.currentRotation){if(v(C,a.currentRotation),a.firstRotationDate){v(z,new Date(a.firstRotationDate));const t=e(C)-1,n=new Date(e(z));n.setDate(n.getDate()+t*7);const i=new Date(n);i.setDate(i.getDate()+4),v(y,{monday:n,friday:i})}}else v(C,1),v(y,va()),v(z,null);yield ra(e(C))}catch(a){console.error("❌ Error inicializando sistema:",a),v(C,1),v(y,va()),v(z,null)}})}function sa(){try{if(Re()&&Je(),v(C,e(C)+1),e(z))v(y,Ve(e(z),e(C)-1));else{const a=new Date(e(y).monday);a.setDate(a.getDate()+7);const t=new Date(e(y).friday);t.setDate(t.getDate()+7),v(y,{monday:a,friday:t})}ra(e(C)),B(`Avanzado a Rotación #${e(C)}`,!0)}catch(a){console.error("Error avanzando rotación:",a),B("Error avanzando rotación",!1)}}function ia(){try{if(e(C)>1){if(Re()&&Je(),v(C,e(C)-1),e(z))v(y,Ve(e(z),e(C)-1));else{const a=new Date(e(y).monday);a.setDate(a.getDate()-7);const t=new Date(e(y).friday);t.setDate(t.getDate()-7),v(y,{monday:a,friday:t})}ra(e(C)),B(`Retrocedido a Rotación #${e(C)}`,!0)}}catch(a){console.error("Error retrocediendo rotación:",a),B("Error retrocediendo rotación",!1)}}function Ve(a,t){try{const n=new Date(a);n.setDate(a.getDate()+t*7);const i=new Date(n);return i.setDate(n.getDate()+4),{monday:n,friday:i}}catch(n){return console.error("Error calculando fechas de semana:",n),va()}}function va(){const a=new Date,t=a.getDay();let n;t===0?n=1:t===1?n=0:n=-(t-1),t===6&&(n=2);const i=new Date(a);i.setDate(a.getDate()+n);const d=new Date(i);return d.setDate(i.getDate()+4),{monday:i,friday:d}}function Me(a){try{if(!a||!(a instanceof Date))return"Fecha no disponible";const t={day:"numeric",month:"long",timeZone:"America/Costa_Rica"};return a.toLocaleDateString("es-ES",t)}catch(t){return console.error("Error formateando fecha:",t),"Fecha inválida"}}function Va(a){try{return!a||!(a instanceof Date)?"??":a.getDate()}catch(t){return"??"}}function Ka(){try{if(!e(y).monday||!e(y).friday)return`Rotación #${e(C)}`;const a=e(y).monday.toLocaleString("es-ES",{month:"long"}),t=e(y).monday.getFullYear(),n=Me(e(y).monday),i=Me(e(y).friday);return`Rotación #${e(C)} / ${a} / ${n} - ${i} / ${t}`}catch(a){return`Rotación #${e(C)}`}}function Dt(){try{if(!e(y).monday||!e(y).friday)return`Rot. #${e(C)}`;const a=e(y).monday.toLocaleString("es-ES",{month:"short"}),t=e(y).monday.getFullYear(),n=Va(e(y).monday),i=Va(e(y).friday);return`Rot. #${e(C)} / ${a} / ${n}-${i} / ${t}`}catch(a){return`Rot. #${e(C)}`}}function Ke(){try{const a=new Date,t=e(y).monday,n=e(y).friday;if(!t||!n)return{isCurrentWeek:!1,isFutureWeek:!0,isPastWeek:!1,statusText:"Calculando..."};const i=t<=a&&a<=n,d=t>a,b=n<a;return{isCurrentWeek:i,isFutureWeek:d,isPastWeek:b,statusText:i?"Semana Actual":d?"Semana Futura":"Semana Pasada"}}catch(a){return{isCurrentWeek:!1,isFutureWeek:!0,isPastWeek:!1,statusText:"Estado desconocido"}}}function Gt(a){(a.action==="save"||a.action==="saveAll")&&Jt()}function Ht(a){(a.action==="save"||a.action==="saveAll")&&Ut()}function Wt(a){a.action==="save"&&Mt()}function Jt(){return L(this,null,function*(){try{const a=yield xe.getAll("roles");v(l,a||[])}catch(a){console.error("❌ Error recargando roles:",a)}})}function Ut(){return L(this,null,function*(){try{const a=yield xe.getAll("collaborators");v(u,(a||[]).map(za))}catch(a){console.error("❌ Error recargando colaboradores:",a)}})}function Mt(){return L(this,null,function*(){try{const a=yield xe.getById("coverage",1);v(h,(a==null?void 0:a.roleNames)||[])}catch(a){console.error("❌ Error recargando cobertura:",a)}})}function za(a){return Aa(ve({},a),{certifications:Array.isArray(a.certifications)?a.certifications:a.certifications?[a.certifications]:[],unavailableDays:a.unavailableDays||{monday:!1,tuesday:!1,wednesday:!1,thursday:!1,friday:!1}})}function $t(){const a={};F.forEach(t=>{a[t.id]={}}),v(m,a),console.log("📋 Asignaciones inicializadas como vacías")}function Yt(){return L(this,null,function*(){try{v(y,va()),v(C,1),v(z,null),console.log("📅 Primera rotación preparada para:",Me(e(y).monday))}catch(a){console.error("Error configurando primera rotación:",a),v(C,1),v(y,{monday:new Date,friday:new Date})}})}function Tt(){const a={};return Object.entries(k).forEach(([t,n])=>{n.length>0&&(a[t]=n.filter(i=>e(l).some(d=>d.name===i)))}),a}function Xa(a){for(const[t,n]of Object.entries(k))if(n.includes(a))return t;return null}function vt(){const a=Object.values(k).flat();return e(l).filter(t=>!a.includes(t.name))}class ha{constructor(){this.collaboratorRoleHistory=new Map,this.weeklyRoleAssignments=new Map,this.weekdays=["monday","tuesday","wednesday","thursday","friday"]}initializeFromExistingAssignments(t){this.weekdays.forEach((n,i)=>{const d=t[n]||{};Object.entries(d).forEach(([b,E])=>{Array.isArray(E)&&E.forEach(S=>{this.recordAssignment(S,b,i)})})})}recordAssignment(t,n,i){this.collaboratorRoleHistory.has(t)||this.collaboratorRoleHistory.set(t,new Map),this.collaboratorRoleHistory.get(t).set(n,i),this.weeklyRoleAssignments.has(t)||this.weeklyRoleAssignments.set(t,new Set),this.weeklyRoleAssignments.get(t).add(n)}wouldCreateConsecutiveDays(t,n,i){const d=this.collaboratorRoleHistory.get(t);if(!d||!d.has(n))return!1;const b=d.get(n);return Math.abs(i-b)===1}hasRoleThisWeek(t,n){const i=this.weeklyRoleAssignments.get(t);return i?i.has(n):!1}getWeeklyRoles(t){return this.weeklyRoleAssignments.get(t)||new Set}getWeeklyDiversityStats(){const t={totalCollaborators:this.weeklyRoleAssignments.size,averageRolesPerCollaborator:0,collaboratorDiversity:new Map,perfectDiversityCount:0};let n=0;for(const[i,d]of this.weeklyRoleAssignments){const b=d.size;n+=b,t.collaboratorDiversity.set(i,{rolesCount:b,roles:Array.from(d)})}return t.averageRolesPerCollaborator=t.totalCollaborators>0?n/t.totalCollaborators:0,t}}function Vt(){return L(this,null,function*(){if(!e(l).length||!e(u).length){B("No hay suficientes datos para generar rotación",!1);return}try{e(z)||(v(z,new Date(e(y).monday)),console.log("✅ Primera rotación establecida:",Me(e(z)))),v(N,!0);const a={};F.forEach(i=>{a[i.id]={},e(l).forEach(b=>{ue(b,i.id)||(a[i.id][b.name]=[])});const d=e(m)[i.id]||{};Object.entries(d).forEach(([b,E])=>{if(Array.isArray(E)&&E.length>0){const S=E.filter(x=>typeof x=="string"&&!x.includes("Faltan")&&!x.includes("Sin")&&!x.includes("Omitido"));S.length>0&&a[i.id][b]&&(a[i.id][b]=[...S])}})});const t=new ha;if(t.initializeFromExistingAssignments(a),yield ft(a,t)){yield et(a),v(m,a),yield Je();const i=new ha;i.initializeFromExistingAssignments(a);const d=i.getWeeklyDiversityStats(),b=Qt(a);B(`Rotación #${e(C)} generada exitosamente. Colaboradores sin repetir roles: ${d.perfectDiversityCount}/${d.totalCollaborators}. Colaboradores adicionales: ${b}`,!0)}else B("No se pudo generar una rotación óptima. Intente ajustar la configuración.",!1)}catch(a){console.error("❌ Error generando rotación:",a),B("Error al generar rotación: "+a.message,!1)}finally{setTimeout(()=>{v(N,!1)},500)}})}function ft(a,t){return L(this,null,function*(){let i=null,d={score:1/0};for(let b=1;b<=8;b++){const E=JSON.parse(JSON.stringify(a)),S=new ha;if(S.initializeFromExistingAssignments(E),yield Ga(E,S)){const D=Qa(E);if(console.log(`🔄 Intento ${b}: Score=${D.score}, Consecutivos=${D.consecutiveCount}, Repeticiones=${D.roleRepetitionCount}`),D.score<d.score&&(d=D,i=JSON.parse(JSON.stringify(E))),D.consecutiveCount===0&&D.roleRepetitionCount===0){console.log(`🎯 ¡Solución perfecta encontrada en intento ${b}!`);break}}}return i?(Object.assign(a,i),console.log("📊 Resultado final:",d),!0):!1})}function Ga(a,t){return L(this,null,function*(){const n=new Map;F.forEach(i=>{const d=new Set,b=a[i.id]||{};Object.values(b).forEach(E=>{Array.isArray(E)&&E.forEach(S=>d.add(S))}),n.set(i.id,d)});for(let i=0;i<F.length;i++){const d=F[i];if(!(yield It(d.id,i,a,t,n.get(d.id))))return!1}for(let i=0;i<F.length;i++){const d=F[i];if(!(yield Kt(d.id,i,a,t,n.get(d.id))))return!1}return!0})}function It(a,t,n,i,d){return L(this,null,function*(){const b=Tt(),E=e(u).filter(S=>{var x;return!((x=S.unavailableDays)!=null&&x[a])&&!d.has(S.name)});for(const[S,x]of Object.entries(b)){if(x.length===0)continue;const D=x.map(P=>e(l).find(re=>re.name===P)).filter(P=>P&&!ue(P,a));if(D.length===0)continue;const te=E.filter(P=>d.has(P.name)||!D.every(Oe=>{var _a;return(_a=P.certifications)==null?void 0:_a.includes(Oe.name)})?!1:!D.some(Oe=>i.hasRoleThisWeek(P.name,Oe.name))),fe=Math.max(...D.map(P=>{const re=n[a][P.name].length,Fe=P.min||1;return Math.max(0,Fe-re)}));for(let P=0;P<fe;P++){let re;if(te.length>0&&(re=Fa(te.filter(Oe=>!d.has(Oe.name)),D[0],i,t)),re||(re=mt(D,E.filter(Oe=>!d.has(Oe.name)),i,t)),!re)continue;let Fe=!1;for(const Oe of D){const _a=n[a][Oe.name].length,Ea=Oe.min||1,ea=De(Oe,a);_a<Ea&&_a<ea&&(n[a][Oe.name].push(re.name),i.recordAssignment(re.name,Oe.name,t),Fe=!0)}if(Fe){d.add(re.name);const Oe=te.findIndex(_a=>_a.name===re.name);Oe!==-1&&te.splice(Oe,1)}}}return!0})}function Kt(a,t,n,i,d){return L(this,null,function*(){var S;const b=vt().filter(x=>!ue(x,a)),E=e(u).filter(x=>{var D;return!((D=x.unavailableDays)!=null&&D[a])&&!d.has(x.name)});for(const x of b){const D=((S=n[a][x.name])==null?void 0:S.length)||0,te=x.min||1,fe=Math.max(0,te-D);for(let P=0;P<fe;P++){const re=yield Xt(x,E.filter(Fe=>!d.has(Fe.name)),i,t);if(!re)break;n[a][x.name]||(n[a][x.name]=[]),n[a][x.name].push(re.name),d.add(re.name),i.recordAssignment(re.name,x.name,t)}}return!0})}function Xt(a,t,n,i){return L(this,null,function*(){const d=t.filter(b=>{var E;return!(!((E=b.certifications)!=null&&E.includes(a.name))||n.hasRoleThisWeek(b.name,a.name)||n.wouldCreateConsecutiveDays(b.name,a.name,i))});return d.length>0?Fa(d,a,n,i):(console.log(`⚠️ No hay colaboradores disponibles para ${a.name} sin repetir rol - usando asignación tradicional`),Za(a,t,n,i))})}function Fa(a,t,n,i){if(a.length===0)return null;const d=a.map(b=>{let E=0;const S=n.getWeeklyRoles(b.name);E+=(10-S.size)*50;const x=n.wouldCreateConsecutiveDays(b.name,t.name,i)?1e3:0;E-=x;const D=Math.random()*5;return E+=D,{collaborator:b,score:E,weeklyRolesCount:S.size,wouldBeConsecutive:x>0}});return d.sort((b,E)=>E.score-b.score),d[0].collaborator}function Qa(a){let t=0,n=0,i=0;const d=new ha;d.initializeFromExistingAssignments(a),e(u).forEach(S=>{const x=Ba(S.name,a);for(let D=0;D<x.length-1;D++){const te=x[D],fe=x[D+1],P=te.filter(re=>fe.includes(re));P.length>0&&(n+=P.length,t+=P.length*100)}}),e(u).forEach(S=>{const x=d.getWeeklyRoles(S.name),te=Ba(S.name,a).flat().length,fe=x.size;if(te>fe){const P=te-fe;i+=P,t+=P*50}});const b=d.getWeeklyDiversityStats(),E=Math.floor(b.averageRolesPerCollaborator*10);return t-=E,{score:t,consecutiveCount:n,roleRepetitionCount:i,diversityStats:b}}function mt(a,t,n,i){const d=t.filter(S=>a.every(x=>{var D;return(D=S.certifications)==null?void 0:D.includes(x.name)}));if(d.length===0)return null;const b=d.map(S=>{const x=a.reduce((fe,P)=>fe+(n.wouldCreateConsecutiveDays(S.name,P.name,i)?100:0),0)/a.length,D=Math.random()*15,te=x+D;return{collaborator:S,score:te,avgConsecutiveCost:x}});b.sort((S,x)=>S.score-x.score);const E=b.filter(S=>S.avgConsecutiveCost===0);if(E.length>0){const S=E.slice(0,Math.min(3,E.length)),x=Math.floor(Math.random()*S.length);return S[x].collaborator}else{const S=b.slice(0,Math.min(2,b.length)),x=Math.floor(Math.random()*S.length);return S[x].collaborator}}function Za(a,t,n,i){const d=t.filter(S=>{var x;return(x=S.certifications)==null?void 0:x.includes(a.name)});if(d.length===0)return null;const b=d.map(S=>{const x=n.wouldCreateConsecutiveDays(S.name,a.name,i)?100:0,D=Math.random()*15,te=x+D;return{collaborator:S,score:te,consecutiveCost:x}});b.sort((S,x)=>S.score-x.score);const E=b.filter(S=>S.consecutiveCost===0);if(E.length>0){const S=E.slice(0,Math.min(3,E.length)),x=Math.floor(Math.random()*S.length);return S[x].collaborator}else{const S=b.slice(0,Math.min(2,b.length)),x=Math.floor(Math.random()*S.length);return S[x].collaborator}}function et(a){return L(this,null,function*(){for(let t=0;t<F.length;t++){const i=F[t].id,d=e(l).filter(S=>!ue(S,i)),b=new Set;Object.values(a[i]||{}).forEach(S=>{Array.isArray(S)&&S.forEach(x=>b.add(x))});let E=e(u).filter(S=>{var x;return!((x=S.unavailableDays)!=null&&x[i])&&!b.has(S.name)});E=gt(E);for(const S of E){let x=d.filter(D=>{var Fe;const te=(Fe=S.certifications)==null?void 0:Fe.includes(D.name),fe=(a[i][D.name]||[]).length,P=De(D,i),re=fe<P;return te&&re});if(x.length>0){x=gt(x);const D=x[0],te=Xa(D.name);te&&!qt(S.name,i,a)?k[te].map(P=>e(l).find(re=>re.name===P)).filter(P=>{var re;return P&&!ue(P,i)&&((re=S.certifications)==null?void 0:re.includes(P.name))&&(a[i][P.name]||[]).length<De(P,i)}).forEach(P=>{a[i][P.name]||(a[i][P.name]=[]),a[i][P.name].push(S.name)}):(a[i][D.name]||(a[i][D.name]=[]),a[i][D.name].push(S.name)),b.add(S.name)}}}})}function Ba(a,t){const n=new Array(5).fill().map(()=>[]);return F.forEach((i,d)=>{const b=t[i.id]||{};Object.entries(b).forEach(([E,S])=>{Array.isArray(S)&&S.includes(a)&&n[d].push(E)})}),n}function gt(a){const t=[...a];for(let n=t.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[t[n],t[i]]=[t[i],t[n]]}return t}function Qt(a){let t=0;return F.forEach(n=>{const i=a[n.id]||{};e(l).filter(b=>!ue(b,n.id)).forEach(b=>{const E=i[b.name]||[],S=b.min||1,x=Math.max(0,E.length-S);t+=x})}),t}function qt(a,t,n){const i=n[t]||{};for(const[d,b]of Object.entries(i))if(Array.isArray(b)&&b.includes(a))return!0;return!1}function at(){return L(this,null,function*(){if(!Re()){B("No hay asignaciones para exportar",!1);return}try{v(N,!0);const a=document.createElement("canvas"),t=a.getContext("2d"),n={width:1800,height:Math.max(1e3,e(l).length*90+400),padding:50,colors:{background:"#1a1f35",cardBackground:"rgba(255, 255, 255, 0.05)",headerCard:"rgba(255, 255, 255, 0.08)",text:"#ffffff",textSecondary:"rgba(255, 255, 255, 0.8)",textMuted:"rgba(255, 255, 255, 0.6)",border:"rgba(255, 255, 255, 0.1)",assigned:"rgba(46, 204, 113, 0.3)",assignedBorder:"rgba(46, 204, 113, 0.5)",warning:"rgba(241, 196, 15, 0.3)",warningBorder:"rgba(241, 196, 15, 0.5)",excluded:"rgba(155, 89, 182, 0.2)",excludedBorder:"rgba(155, 89, 182, 0.4)",accent:"#3498db"}},i=window.devicePixelRatio||1;a.width=n.width*i,a.height=n.height*i,a.style.width=n.width+"px",a.style.height=n.height+"px",t.scale(i,i),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",yield pt(t,n),yield Ot(t,n),yield tt(t,n),yield bt(t,n),yield eo(a),B("Rotación exportada con diseño moderno",!0)}catch(a){console.error("❌ Error exportando imagen:",a),B("Error al generar imagen: "+a.message,!1)}finally{setTimeout(()=>{v(N,!1)},1e3)}})}function pt(a,t){return L(this,null,function*(){a.fillStyle=t.colors.background,a.fillRect(0,0,t.width,t.height);const n=a.createRadialGradient(t.width*.8,t.height*.3,0,t.width*.8,t.height*.3,t.width*.7);n.addColorStop(0,"rgba(52, 152, 219, 0.08)"),n.addColorStop(1,"rgba(52, 152, 219, 0)"),a.fillStyle=n,a.fillRect(0,0,t.width,t.height)})}function Ot(a,t){return L(this,null,function*(){const i=t.padding;ka(a,t.padding,i,t.width-t.padding*2,140,20),a.fillStyle=t.colors.headerCard,a.fill(),a.strokeStyle=t.colors.border,a.lineWidth=1,a.stroke(),a.fillStyle=t.colors.text,a.font='bold 36px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="center",a.textBaseline="middle",a.shadowColor="rgba(0, 0, 0, 0.3)",a.shadowBlur=6,a.shadowOffsetY=2;const d=Ka();a.fillText(d,t.width/2,i+45),a.shadowColor="transparent",a.shadowBlur=0,a.shadowOffsetY=0,a.font='18px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.fillStyle=t.colors.textSecondary;const E=`${Ke().statusText} • ${Pe()} asignaciones totales`;a.fillText(E,t.width/2,i+85),a.font='14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.fillStyle=t.colors.textMuted;const S=`Generado el ${new Date().toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`;a.fillText(S,t.width/2,i+110)})}function tt(a,t){return L(this,null,function*(){const n=t.padding+180,i=t.width-t.padding*2,d=300,b=(i-d)/5,E=80,S=60,x=S+e(l).length*E;ka(a,t.padding,n,i,x,16),a.fillStyle=t.colors.cardBackground,a.fill(),a.strokeStyle=t.colors.border,a.lineWidth=1,a.stroke(),yield ot(a,t,n,d,b,S);for(let D=0;D<e(l).length;D++){const te=e(l)[D],fe=n+S+D*E;yield st(a,t,te,fe,d,b,E,D)}})}function ot(a,t,n,i,d,b){return L(this,null,function*(){["Roles y Requisitos","Lunes","Martes","Miércoles","Jueves","Viernes"].forEach((S,x)=>{const D=t.padding+(x===0?0:i+(x-1)*d),te=x===0?i:d;ka(a,D+5,n+5,te-10,b-10,12),a.fillStyle=x===0?"rgba(52, 152, 219, 0.1)":"rgba(255, 255, 255, 0.03)",a.fill(),a.strokeStyle=t.colors.border,a.lineWidth=1,a.stroke(),a.fillStyle=t.colors.text,a.font=x===0?'bold 16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif':'bold 15px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="center",a.textBaseline="middle",a.fillText(S,D+te/2,n+b/2)})})}function st(a,t,n,i,d,b,E,S){return L(this,null,function*(){const x=t.padding;S%2===1&&(ka(a,x,i,t.width-t.padding*2,E,0),a.fillStyle="rgba(255, 255, 255, 0.01)",a.fill()),yield Zt(a,t,n,x,i,d);for(let D=0;D<F.length;D++){const te=F[D].id,fe=x+d+D*b;yield ht(a,t,n,te,fe,i,b,E)}})}function Zt(a,t,n,i,d,b,E){return L(this,null,function*(){const x=i+15,D=d+15;a.fillStyle=t.colors.text,a.font='bold 18px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="left",a.textBaseline="top";const te=zt(a,n.name,b-40);a.fillText(te,x,D);const fe=D+30;let P=x;const re=`Mín: ${n.min||1}`;P+=yt(a,P,fe,re,t.colors.accent,"#ffffff")+10;const Fe=`Máx: ${n.max||5}`;yt(a,P,fe,Fe,"#2ecc71","#ffffff")})}function ht(a,t,n,i,d,b,E,S){return L(this,null,function*(){const D=d+8,te=b+8,fe=E-8*2,P=S-8*2;let re="empty",Fe=[],Oe=0,_a=n.min||1;if(ue(n,i))re="excluded";else if(e(m)&&e(m)[i]&&e(m)[i][n.name]){const Ha=e(m)[i][n.name];if(Array.isArray(Ha)&&Ha.length>0){const dt=Ha.filter(Et=>typeof Et=="string"&&!Et.includes("Faltan")&&!Et.includes("Sin"));dt.length>0?(Fe=dt,Oe=dt.length,re=Oe>=_a?"assigned":"warning"):re="warning"}}let Ea,ea,Be;switch(re){case"assigned":Ea=t.colors.assigned,ea=t.colors.assignedBorder,Be=t.colors.text;break;case"warning":Ea=t.colors.warning,ea=t.colors.warningBorder,Be=t.colors.text;break;case"excluded":Ea=t.colors.excluded,ea=t.colors.excludedBorder,Be=t.colors.textMuted;break;default:Ea="rgba(0, 0, 0, 0.1)",ea="rgba(255, 255, 255, 0.05)",Be=t.colors.textMuted}ka(a,D,te,fe,P,12),a.fillStyle=Ea,a.fill(),re!=="empty"?(a.strokeStyle=ea,a.lineWidth=2,a.stroke()):(a.strokeStyle=ea,a.lineWidth=1,a.setLineDash([3,3]),a.stroke(),a.setLineDash([])),re==="excluded"?(a.fillStyle=Be,a.font="24px serif",a.textAlign="center",a.textBaseline="middle",a.fillText("🚫",D+fe/2,te+P/2-8),a.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.fillText("No requerido",D+fe/2,te+P/2+12)):Fe.length>0?(yield rt(a,t,Fe,D,te,fe,P,Be),Oe>0&&_t(a,t,Oe,_a,D+fe-25,te+5)):re==="warning"?(a.fillStyle=Be,a.font="20px serif",a.textAlign="center",a.textBaseline="middle",a.fillText("⚠️",D+fe/2,te+P/2-8),a.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.fillText("Sin asignar",D+fe/2,te+P/2+12)):(a.fillStyle=Be,a.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="center",a.textBaseline="middle",a.fillText("Disponible",D+fe/2,te+P/2))})}function rt(a,t,n,i,d,b,E,S){return L(this,null,function*(){const te=Math.floor((E-16)/16);a.fillStyle=S,a.font='13px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="left",a.textBaseline="top";let fe=d+8,P=0;for(let re=0;re<n.length&&P<te;re++){let Fe=n[re];Fe.length>15&&(Fe=Fe.substring(0,13)+".."),a.fillStyle="rgba(255, 255, 255, 0.6)",a.fillText("•",i+8,fe),a.fillStyle=S,a.fillText(Fe,i+8+15,fe),fe+=16,P++}n.length>te&&(a.fillStyle="rgba(255, 255, 255, 0.7)",a.font='11px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="center",a.fillText(`+${n.length-te} más`,i+b/2,d+E-12))})}function bt(a,t){return L(this,null,function*(){const n=t.height-80;ka(a,t.padding,n,t.width-t.padding*2,60,16),a.fillStyle=t.colors.cardBackground,a.fill(),a.strokeStyle=t.colors.border,a.lineWidth=1,a.stroke(),a.fillStyle=t.colors.textSecondary,a.font='14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="center",a.textBaseline="middle",a.fillText("Sistema de Gestión de Rotaciones • Edwards CR",t.width/2,n+25),a.fillStyle=t.colors.textMuted,a.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.fillText("Creado por José Ismael Morales Uriarte",t.width/2,n+45)})}function ka(a,t,n,i,d,b){a.beginPath(),a.roundRect(t,n,i,d,b)}function yt(a,t,n,i,d,b){a.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';const D=a.measureText(i).width+10*2;return ka(a,t,n,D,22,11),a.fillStyle=d,a.fill(),a.fillStyle=b,a.textAlign="center",a.textBaseline="middle",a.fillText(i,t+D/2,n+22/2),D}function _t(a,t,n,i,d,b){const S=n>=i;ka(a,d,b,24,24,12),a.fillStyle=S?"rgba(46, 204, 113, 0.9)":"rgba(241, 196, 15, 0.9)",a.fill(),a.fillStyle="#ffffff",a.font='bold 12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="center",a.textBaseline="middle",a.fillText(n.toString(),d+24/2,b+24/2)}function zt(a,t,n){if(a.measureText(t).width<=n)return t;const i="...";let d=t;for(;a.measureText(d+i).width>n&&d.length>0;)d=d.slice(0,-1);return d+i}function eo(a){return L(this,null,function*(){return new Promise(t=>{a.toBlob(n=>{const i=URL.createObjectURL(n),d=document.createElement("a");d.download=`rotacion_${e(C)}_${Ft(e(y).monday)}.png`,d.href=i,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(i),t()},"image/png",.9)})})}function Ft(a){if(!a||!(a instanceof Date))return"fecha_invalida";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0");return`${t}-${n}-${i}`}function wt(a,t){if(v(Z,e(l).find(n=>n.name===a)),v($,F.find(n=>n.id===t)),e(Z)&&e($)){v(R,[]),e(m)[t]&&e(m)[t][a]&&Array.isArray(e(m)[t][a])&&v(R,[...e(m)[t][a]]);const i=e(u).filter(d=>{var S,x;const b=(S=d.certifications)==null?void 0:S.includes(e(Z).name),E=!((x=d.unavailableDays)!=null&&x[e($).id]);return b&&E}).sort((d,b)=>{const E=e(R).includes(d.name),S=e(R).includes(b.name);return E!==S?E?1:-1:d.name.localeCompare(b.name)});v(G,i),v(Q,!0)}}function g(){v(Q,!1),v(Z,null),v($,null),v(G,[]),v(R,[])}function T(a){if(!(!e(Z)||!e($)))try{let t=ve({},e(m));if(t[e($).id]||(t[e($).id]={}),(!t[e($).id][e(Z).name]||!Array.isArray(t[e($).id][e(Z).name]))&&(t[e($).id][e(Z).name]=[]),t[e($).id][e(Z).name].includes(a))B("El colaborador ya está asignado",!1);else{const n=De(e(Z),e($).id);if(t[e($).id][e(Z).name].filter(d=>typeof d=="string"&&!d.includes("Faltan")).length>=n){B(`No se puede asignar más de ${n} colaboradores a este rol`,!1);return}t[e($).id][e(Z).name].push(a),v(m,t),v(R,[...t[e($).id][e(Z).name]]),Je(),B("Colaborador asignado correctamente",!0)}}catch(t){B("Error al asignar colaborador: "+t.message,!1)}}function W(a){var t,n;if(!(!e(Z)||!e($)))try{let i=ve({},e(m));(n=(t=i[e($).id])==null?void 0:t[e(Z).name])!=null&&n.includes(a)&&(i[e($).id][e(Z).name]=i[e($).id][e(Z).name].filter(d=>d!==a),v(m,i),v(R,[...i[e($).id][e(Z).name]]),Je(),B("Colaborador eliminado correctamente",!0))}catch(i){B("Error al quitar colaborador: "+i.message,!1)}}function B(a,t=!0){v(j,a),v(oe,t),v(se,!0),setTimeout(()=>{v(se,!1)},5e3)}function J(a){return a?typeof a=="string"?a:Array.isArray(a)?a.join(", "):String(a):""}function ue(a,t){var n;try{return!a||!t?!1:((n=a==null?void 0:a.excludedDays)==null?void 0:n[t])===!0}catch(i){return!1}}function De(a,t){try{return a?a.dailyMaxCollabs&&typeof a.dailyMaxCollabs=="object"&&a.dailyMaxCollabs[t]!==void 0?Math.max(1,a.dailyMaxCollabs[t]):Math.max(1,a.max||5):5}catch(n){return 5}}function $e(){if(confirm(`¿Estás seguro de que deseas limpiar la Rotación #${e(C)}? Esta acción no se puede deshacer.`)){const a={};F.forEach(t=>{a[t.id]={}}),v(m,a),Je(),B(`Rotación #${e(C)} limpiada correctamente`,!0)}}function Re(){try{return F.some(a=>{const t=e(m)[a.id];return t&&Object.keys(t).length>0&&Object.values(t).some(n=>Array.isArray(n)&&n.length>0)})}catch(a){return!1}}function Pe(){try{let a=0;return F.forEach(t=>{const n=e(m)[t.id];n&&Object.values(n).forEach(i=>{Array.isArray(i)&&(a+=i.filter(d=>typeof d=="string"&&!d.includes("Faltan")).length)})}),a}catch(a){return console.error("Error calculando asignaciones totales:",a),0}}function Xe(){return L(this,null,function*(){try{v(N,!0),yield O(),B("Datos actualizados correctamente",!0)}catch(a){console.error("❌ Error recargando datos:",a),B("Error al actualizar datos",!1)}finally{v(N,!1)}})}function ba(){if(!Re()){B("No hay asignaciones para analizar",!1);return}const a=Sa();a.totalConsecutives===0?B("¡Excelente! No hay días consecutivos detectados",!0):B(`Se detectaron ${a.totalConsecutives} días consecutivos.`,!1)}function Sa(){const a={consecutivesByCollaborator:new Map,totalConsecutives:0},t=["monday","tuesday","wednesday","thursday","friday"],n=new Map;return t.forEach((i,d)=>{const b=e(m)[i]||{};Object.entries(b).forEach(([E,S])=>{Array.isArray(S)&&S.forEach(x=>{n.has(x)||n.set(x,new Array(5).fill(null));const D=n.get(x);D[d]===null&&(D[d]=[]),D[d].push(E)})})}),n.forEach((i,d)=>{const b=[];for(let E=0;E<i.length-1;E++){const S=i[E]||[],x=i[E+1]||[];S.forEach(D=>{x.includes(D)&&(b.push({role:D,days:[t[E],t[E+1]]}),a.totalConsecutives++)})}a.consecutivesByCollaborator.set(d,{count:b.length,details:b})}),a}function fa(){if(!Re()){B("No hay asignaciones para analizar",!1);return}const a=ya();w(a)}function ya(){const a={totalAssignments:0,collaboratorStats:new Map,consecutiveIssues:[],roleRepetitionIssues:[],recommendations:[]},t=new ha;return t.initializeFromExistingAssignments(e(m)),e(u).forEach(n=>{const i=ma(n.name,t);a.collaboratorStats.set(n.name,i),a.totalAssignments+=i.totalAssignments}),a.consecutiveIssues=Ge(),a.roleRepetitionIssues=Qe(t),a.recommendations=p(a),a}function ma(a,t){const n={totalAssignments:0,rolesAssigned:new Set,consecutiveDays:0,roleRepetitions:0,diversityScore:0},i=t.getWeeklyRoles(a),d=Ba(a,e(m));return n.totalAssignments=d.flat().length,n.rolesAssigned=i,n.totalAssignments>i.size&&(n.roleRepetitions=n.totalAssignments-i.size),n.totalAssignments>0&&(n.diversityScore=i.size/n.totalAssignments*100),n}function Qe(a){const t=[];return e(u).forEach(n=>{const i=a.getWeeklyRoles(n.name),b=Ba(n.name,e(m)).flat().length;if(b>i.size){const E=b-i.size;t.push({collaborator:n.name,repetitions:E,totalAssignments:b,uniqueRoles:i.size,severity:E>2?"high":E>1?"medium":"low"})}}),t}function Ge(){const a=[];return e(u).forEach(t=>{const n=Ba(t.name,e(m));for(let i=0;i<n.length-1;i++){const d=n[i],b=n[i+1],E=d.filter(S=>b.includes(S));E.length>0&&a.push({collaborator:t.name,days:[F[i].name,F[i+1].name],roles:E,severity:E.length>1?"high":"medium"})}}),a}function p(a){const t=[];if(a.consecutiveIssues.length>0){const i=a.consecutiveIssues.filter(d=>d.severity==="high");i.length>0&&t.push({type:"consecutive",priority:"high",message:`${i.length} colaboradores con múltiples días consecutivos.`,action:"Revisar asignaciones manualmente"})}if(a.roleRepetitionIssues.length>0){const i=a.roleRepetitionIssues.reduce((b,E)=>b+E.repetitions,0),d=a.roleRepetitionIssues.filter(b=>b.severity==="high");d.length>0&&t.push({type:"roleRepetition",priority:"medium",message:`${d.length} colaboradores repiten roles múltiples veces (${i} repeticiones totales).`,action:"Regenerar rotación para mejor distribución"})}const n=[];for(const[i,d]of a.collaboratorStats)d.diversityScore<50&&d.totalAssignments>2&&n.push({collaborator:i,score:d.diversityScore});return n.length>0&&t.push({type:"diversity",priority:"low",message:`${n.length} colaboradores con baja diversidad de roles.`,action:"Considerar redistribuir para mayor variedad"}),t}function w(a){let t=`Análisis de Rotación #${e(C)}:

`;if(t+=`📊 Resumen:
`,t+=`• Total asignaciones: ${a.totalAssignments}
`,t+=`• Días consecutivos: ${a.consecutiveIssues.length} problemas
`,a.roleRepetitionIssues&&a.roleRepetitionIssues.length>0){const n=a.roleRepetitionIssues.reduce((d,b)=>d+b.repetitions,0);t+=`• Repeticiones de roles: ${n} casos
`;const i=a.collaboratorStats.size-a.roleRepetitionIssues.length;t+=`• Colaboradores sin repetir: ${i}/${a.collaboratorStats.size}
`}t+=`
`,a.recommendations.length>0?(t+=`💡 Recomendaciones:
`,a.recommendations.forEach(n=>{const i=n.priority==="high"?"🔴":n.priority==="medium"?"🟡":"🟢";t+=`${i} ${n.message}
`})):t+="✅ ¡Rotación bien optimizada!",B(t,a.recommendations.length===0)}function H(){if(typeof window!="undefined"&&window.location.hostname==="localhost"){if(console.group("🔍 Estado Actual de la Rotación"),console.log("📅 Información de la Rotación:",{number:e(C),dates:e(y),firstRotation:e(z)}),console.log("👥 Colaboradores:",e(u).length),console.log("🎭 Roles:",e(l).length),console.log("🔗 Roles agrupados:",k),console.log("📋 Asignaciones actuales:",e(m)),Re()){const a=new ha;a.initializeFromExistingAssignments(e(m));const t=a.getWeeklyDiversityStats();console.log("📊 Estadísticas de diversidad:",t);const n=Qa(e(m));console.log("🎯 Evaluación de calidad:",n)}console.groupEnd()}}Pa(()=>(e(_),e(m)),()=>{e(_)&&e(m)&&Je()}),Pa(()=>(e(_),e(l)),()=>{e(_)&&e(l).length>0&&O()}),No(),so();var X=di(),ee=c(r(X),2),me=r(ee),Ce=r(me),Ie=r(Ce),ie=c(Ie,2),ge=r(ie),he=r(ge,!0);o(ge);var ke=c(ge,2),Te=r(ke,!0);o(ke);var be=c(ke,2),ce=r(be),le=r(ce),Ee=r(le);o(le);var _e=c(le,2),ne=r(_e,!0);o(_e),o(ce);var ae=c(ce,2);{var ye=a=>{var t=Mn(),n=r(t);o(t),Y((i,d)=>I(n,`${i!=null?i:""} - ${d!=null?d:""}`),[()=>Me(e(y).monday),()=>Me(e(y).friday)],je),A(a,t)};U(ae,a=>{e(y)&&e(y).monday&&e(y).friday&&a(ye)})}var de=c(ae,2);{var we=a=>{var t=$n();A(a,t)};U(de,a=>{e(C)===1&&!e(z)&&a(we)})}var pe=c(de,2);{var Ae=a=>{var t=Tn(),n=c(r(t),2),i=r(n);o(n),o(t),Y(d=>I(i,`Iniciado el ${d!=null?d:""}`),[()=>Me(e(z))],je),A(a,t)};U(pe,a=>{e(z)&&a(Ae)})}o(be),o(ie);var la=c(ie,2);o(Ce);var Ze=c(Ce,2),Ca=r(Ze);{var nt=a=>{var t=In(),n=At(t),i=r(n);o(n),Da(2),Y(d=>Ya(i,`width: ${d!=null?d:""}%`),[()=>(new Date().getDay()||7)/7*100],je),A(a,t)},it=(a,t)=>{{var n=d=>{var b=qn();Da(2),A(d,b)},i=d=>{var b=On();Da(2),A(d,b)};U(a,d=>{Ke().isFutureWeek?d(n):d(i,!1)},t)}};U(Ca,a=>{Ke().isCurrentWeek?a(nt):a(it,!1)})}o(Ze);var Na=c(Ze,2),St=r(Na);{var Ct=a=>{var t=zn();A(a,t)};U(St,a=>{e(z)||a(Ct)})}var lt=c(St,2);{var La=a=>{var t=Fn(),n=c(r(t),2),i=r(n);o(n),o(t),Y(d=>I(i,`${d!=null?d:""} asignaciones realizadas`),[Pe],je),A(a,t)},He=a=>{var t=Bn();A(a,t)};U(lt,a=>{Re()?a(La):a(He,!1)})}o(Na),o(me);var Ma=c(me,2);{var xt=a=>{var t=Nn(),n=r(t),i=c(n);o(t),Y(()=>{var d,b;ua(t,1,`status-message ${(d=e(oe)?"success":"error")!=null?d:""}`),I(n,`${(b=e(j))!=null?b:""} `)}),q("click",i,()=>v(se,!1)),A(a,t)};U(Ma,a=>{e(se)&&a(xt)})}var ao=c(Ma,2),$a=r(ao);{var Rt=a=>{var t=Pn(),n=c(r(t),2),i=c(r(n),2);{var d=S=>{var x=Ln();x.textContent=generationStep,A(S,x)};U(i,S=>{generationStep&&S(d)})}var b=c(i,2);{var E=S=>{var P;var x=jn(),D=At(x),te=r(D);Ya(te,`width: ${generationProgress!=null?generationProgress:""}%`),o(D);var fe=c(D,2);fe.textContent=`${(P=Math.round(generationProgress))!=null?P:""}%`,A(S,x)};U(b,S=>{generationProgress>0&&S(E)})}o(n),o(t),A(a,t)};U($a,a=>{e(N)&&a(Rt)})}var lo=c($a,2),ct=r(lo),kt=r(ct),po=c(r(kt));oa(po,1,()=>F,wa,(a,t)=>{var n=Gn(),i=r(n,!0);o(n),Y(()=>I(i,e(t).name)),A(a,n)}),o(kt),o(ct);var co=c(ct),hs=r(co);{var bs=a=>{var t=rs(),n=At(t);oa(n,1,()=>e(l),i=>i.id||i.name,(i,d)=>{var b=Vn(),E=r(b),S=r(E),x=r(S),D=r(x,!0);o(x);var te=c(x,2);{var fe=ea=>{var Be=Hn();A(ea,Be)};U(te,ea=>{e(d).priority===2&&ea(fe)})}var P=c(te,2),re=r(P),Fe=r(re);o(re);var Oe=c(re,2),_a=r(Oe);o(Oe),o(P),o(S),o(E);var Ea=c(E);oa(Ea,1,()=>F,ea=>ea.id,(ea,Be)=>{var Ha=Yn(),dt=r(Ha);{var Et=qe=>{var Ue=Wn();A(qe,Ue)},ze=(qe,Ue)=>{{var xa=aa=>{var Le=Jn(),ga=r(Le),Ta=r(ga),Wa=r(Ta,!0);o(Ta),o(ga),o(Le),Y((ja,qa,Ja,to)=>{ua(Le,1,`assignment-button assigned ${ja!=null?ja:""} 
                        ${qa!=null?qa:""}
                        ${Ja!=null?Ja:""}`),I(Wa,to)},[()=>typeof e(m)[e(Be).id][e(d).name]=="string"&&e(m)[e(Be).id][e(d).name].includes("Sin")?"warning":"",()=>typeof e(m)[e(Be).id][e(d).name]=="string"&&e(m)[e(Be).id][e(d).name].includes("Faltan")?"incomplete":"",()=>typeof e(m)[e(Be).id][e(d).name]=="string"&&e(m)[e(Be).id][e(d).name].includes("Omitido")?"omitted":"",()=>J(e(m)[e(Be).id][e(d).name])],je),q("click",Le,()=>wt(e(d).name,e(Be).id)),A(aa,Le)},ca=aa=>{var Le=Un();q("click",Le,()=>wt(e(d).name,e(Be).id)),A(aa,Le)};U(qe,aa=>{e(m)&&e(m)[e(Be).id]&&e(m)[e(Be).id][e(d).name]?aa(xa):aa(ca,!1)},Ue)}};U(dt,qe=>{ue(e(d),e(Be).id)?qe(Et):qe(ze,!1)})}o(Ha),A(ea,Ha)}),o(b),Y(()=>{I(D,e(d).name),I(Fe,`Mín: ${e(d).min||1}`),I(_a,`Máx: ${e(d).max||5}`)}),A(i,b)}),A(a,t)},ys=a=>{var t=Kn();A(a,t)};U(hs,a=>{e(l)&&e(l).length>0?a(bs):a(ys,!1)})}o(co),o(lo),o(ao);var ho=c(ao,2),Lo=r(ho),bo=r(Lo),jo=c(r(bo),2),_s=r(jo,!0);o(jo),o(bo);var yo=c(bo,2),Po=c(r(yo),2),ws=r(Po,!0);o(Po),o(yo);var _o=c(yo,2),Go=c(r(_o),2),Ss=r(Go,!0);o(Go),o(_o);var wo=c(_o,2),Ho=c(r(wo),2),Cs=r(Ho,!0);o(Ho),o(wo);var xs=c(wo,2);{var Rs=a=>{var t=Xn(),n=c(r(t),2),i=r(n,!0);o(n),o(t),Y(d=>I(i,d),[()=>Me(e(z))],je),A(a,t)};U(xs,a=>{e(z)&&a(Rs)})}o(Lo),o(ho);var Wo=c(ho,2),So=r(Wo),Bt=c(So,2),Co=r(Bt),ks=r(Co,!0);o(Co);var Jo=c(Co,2),Es=r(Jo,!0);o(Jo),o(Bt);var xo=c(Bt,2),Ro=c(xo,2),Uo=c(Ro,2);{var As=a=>{var t=Qn(),n=At(t),i=c(n,2);Y(()=>{n.disabled=e(N),i.disabled=e(N)}),q("click",n,ba),q("click",i,fa),A(a,t)};U(Uo,a=>{Re()&&a(As)})}var Ds=c(Uo,2);{var Ms=a=>{var t=Zn();q("click",t,H),A(a,t)};U(Ds,a=>{typeof window!="undefined"&&window.location.hostname==="localhost"&&a(Ms)})}o(Wo),o(ee);var $s=c(ee,2);{var Ts=a=>{var t=ci(),n=r(t),i=r(n),d=r(i),b=c(r(d),2);{var E=ze=>{var qe=ei(),Ue=r(qe);o(qe),Y(()=>{var xa,ca;return I(Ue,`para ${(xa=e(Z).name)!=null?xa:""} el ${(ca=e($).name)!=null?ca:""}`)}),A(ze,qe)};U(b,ze=>{e(Z)&&e($)&&ze(E)})}o(d);var S=c(d,2);o(i);var x=c(i,2),D=r(x);{var te=ze=>{var qe=ai(),Ue=r(qe),xa=c(r(Ue),2),ca=r(xa),aa=c(r(ca),2),Le=r(aa);o(aa),o(ca);var ga=c(ca,2),Ta=c(r(ga),2),Wa=r(Ta,!0);o(Ta),o(ga),o(xa),o(Ue);var ja=c(Ue,2),qa=r(ja),Ja=c(r(qa),2),to=r(Ja,!0);o(Ja),o(qa);var Nt=c(qa,2),uo=c(r(Nt),2),ko=r(uo,!0);o(uo),o(Nt);var oo=c(Nt,2),Ra=c(r(oo),2),Ua=r(Ra,!0);o(Ra),o(oo);var Yo=c(oo,2),Vo=c(r(Yo),2),Is=r(Vo,!0);o(Vo),o(Yo),o(ja),o(qe),Y((vo,qs,Os)=>{var Ko;I(Le,`#${(Ko=e(C))!=null?Ko:""}`),I(Wa,vo),I(to,e(Z).min||1),I(ko,qs),I(Ua,e(R)?e(R).length:0),I(Is,Os)},[()=>Ke().statusText,()=>{var vo;return De(e(Z),(vo=e($))==null?void 0:vo.id)},()=>Math.max(0,(e(Z).min||1)-(e(R)?e(R).length:0))],je),A(ze,qe)};U(D,ze=>{e(Z)&&ze(te)})}var fe=c(D,2);{var P=ze=>{var qe=oi(),Ue=r(qe),xa=c(r(Ue));o(Ue);var ca=c(Ue,2);oa(ca,5,()=>e(R),wa,(aa,Le)=>{var ga=ti(),Ta=r(ga),Wa=r(Ta,!0);o(Ta);var ja=c(Ta,2);o(ga),Y(()=>I(Wa,e(Le))),q("click",ja,()=>W(e(Le))),A(aa,ga)}),o(ca),o(qe),Y(()=>{var aa;return I(xa,` Colaboradores asignados (${(aa=e(R).length)!=null?aa:""}):`)}),A(ze,qe)};U(fe,ze=>{e(R)&&e(R).length>0&&ze(P)})}var re=c(fe,2);{var Fe=ze=>{var qe=ii(),Ue=r(qe),xa=c(r(Ue));o(Ue);var ca=c(Ue,2);oa(ca,5,()=>e(G),wa,(aa,Le)=>{var ga=ni(),Ta=r(ga),Wa=r(Ta),ja=r(Wa,!0);o(Wa);var qa=c(Wa,2),Ja=r(qa),to=r(Ja,!0);o(Ja),Da(2),o(qa);var Nt=c(qa,2);{var uo=Ra=>{var Ua=si();A(Ra,Ua)};U(Nt,Ra=>{e(Le).unavailableDays&&Object.values(e(Le).unavailableDays).some(Ua=>Ua)&&Ra(uo)})}var ko=c(Nt,2);{var oo=Ra=>{var Ua=ri();A(Ra,Ua)};U(ko,Ra=>{e(R)&&e(R).includes(e(Le).name)&&Ra(oo)})}o(Ta),o(ga),Y((Ra,Ua)=>{ua(ga,1,`collaborator-item ${Ra!=null?Ra:""}`),Oa(ga,"title",Ua),I(ja,e(Le).name),I(to,e(Le).certifications?e(Le).certifications.length:0)},[()=>e(R)&&e(R).includes(e(Le).name)?"already-assigned":"available",()=>e(R)&&e(R).includes(e(Le).name)?"Ya asignado":"Clic para asignar"],je),q("click",ga,()=>T(e(Le).name)),A(aa,ga)}),o(ca),o(qe),Y(()=>{var aa;return I(xa,` Colaboradores disponibles (${(aa=e(G).length)!=null?aa:""}):`)}),A(ze,qe)},Oe=ze=>{var qe=li();A(ze,qe)};U(re,ze=>{e(G)&&e(G).length>0?ze(Fe):ze(Oe,!1)})}o(x);var _a=c(x,2),Ea=r(_a),ea=r(Ea),Be=r(ea);{var Ha=ze=>{var qe=js();Y(()=>{var Ue,xa,ca;return I(qe,`Rotación #${(Ue=e(C))!=null?Ue:""} • ${(xa=e(Z).name)!=null?xa:""} • ${(ca=e($).name)!=null?ca:""}`)}),A(ze,qe)};U(Be,ze=>{e(Z)&&e($)&&ze(Ha)})}o(ea),o(Ea);var dt=c(Ea,2),Et=r(dt);o(dt),o(_a),o(n),o(t),q("click",S,g),q("click",Et,g),q("click",n,jt(function(ze){Pt.call(this,s,ze)})),q("click",t,g),A(a,t)};U($s,a=>{e(Q)&&a(Ts)})}o(X),Y((a,t,n,i,d,b,E,S)=>{var x;ua(me,1,`rotation-header ${a!=null?a:""}`),Ie.disabled=e(C)<=1,I(he,t),I(Te,n),I(Ee,`Rotación #${(x=e(C))!=null?x:""}`),ua(_e,1,`week-status ${i!=null?i:""}`),I(ne,d),I(_s,e(l)?e(l).length:0),I(ws,e(u)?e(u).length:0),I(Ss,e(h)?e(h).length:0),I(Cs,b),So.disabled=e(N),Bt.disabled=e(N)||!e(l).length||!e(u).length,Oa(Bt,"title",e(z)?"Generar nueva rotación automáticamente":"Generar primera rotación y establecer calendario"),I(ks,e(z)?"✨":"🎯"),I(Es,e(z)?"Generar Rotación":"Iniciar Sistema"),xo.disabled=E,Ro.disabled=S},[()=>Ke().isCurrentWeek?"current-week":Ke().isFutureWeek?"future-week":"past-week",Ka,Dt,()=>Ke().isCurrentWeek?"current":Ke().isFutureWeek?"future":"past",()=>Ke().statusText,Pe,()=>e(N)||!Re(),()=>e(N)||!Re()],je),q("click",Ie,ia),q("click",la,sa),q("click",So,Xe),q("click",Bt,Vt),q("click",xo,at),q("click",Ro,$e),A(f,X),no()}var vi=M('<div class="loading-overlay svelte-1jgu8eq"><div class="spinner svelte-1jgu8eq"></div> <p class="svelte-1jgu8eq">Cambiando de equipo...</p></div>'),fi=M('<div class="dashboard-grid svelte-1jgu8eq"><div class="grid-item roles-section svelte-1jgu8eq"><!></div> <div class="grid-item collaborators-section svelte-1jgu8eq"><!></div> <div class="grid-item rotation-section svelte-1jgu8eq"><!></div></div>'),mi=M('<main class="svelte-1jgu8eq"><!> <div class="background-gradient svelte-1jgu8eq"></div> <div class="content-wrapper svelte-1jgu8eq"><header class="svelte-1jgu8eq"><h1 class="svelte-1jgu8eq">Área de Soporte QA</h1> <p class="svelte-1jgu8eq"> </p></header> <!> <div class="actions svelte-1jgu8eq"><button class="back-button svelte-1jgu8eq"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="back-icon svelte-1jgu8eq"><path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path><path d="M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg> Volver al inicio</button></div></div> <div class="copyright svelte-1jgu8eq"><p class="svelte-1jgu8eq">Creado por José Ismael Morales Uriarte para Edwards Lifescienses CR</p></div></main>');function xi(f,s){ro(s,!1);let l=K(0),u=K(!1),h=!1;const _=mo.subscribe($=>L(this,null,function*(){if($!==e(l)&&!h){h=!0,v(u,!0);try{yield xe.switchTeam($),v(l,$)}catch(G){console.error("Error cambiando de equipo:",G)}finally{v(u,!1),h=!1}}}));function k(){mr("/")}io(()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"));const $=document.querySelector("main");if($){const G=document.createElement("div");G.className="custom-scrollbar-track",G.style.position="fixed",G.style.top="0",G.style.right="0",G.style.width="10px",G.style.height="100%",G.style.background="rgba(0, 0, 0, 0.1)",G.style.zIndex="9999";const R=document.createElement("div");R.className="custom-scrollbar-thumb",R.style.position="absolute",R.style.top="0",R.style.right="0",R.style.width="6px",R.style.borderRadius="3px",R.style.background="rgba(52, 152, 219, 0.5)",R.style.cursor="pointer",R.style.transition="all 0.2s",R.style.zIndex="10000",R.style.minHeight="50px",R.style.opacity="0.5",R.style.boxShadow="0 0 3px rgba(0, 0, 0, 0.2)",R.addEventListener("mouseenter",()=>{R.style.width="8px",R.style.background="rgba(52, 152, 219, 0.8)",R.style.opacity="0.9"}),R.addEventListener("mouseleave",()=>{Se||(R.style.width="6px",R.style.background="rgba(52, 152, 219, 0.5)",R.style.opacity="0.5")}),G.appendChild(R),document.body.appendChild(G);const V=()=>{const na=$.scrollHeight/$.clientHeight,sa=Math.max(50,$.clientHeight/na);R.style.height=`${sa}px`;const Ve=$.scrollTop/($.scrollHeight-$.clientHeight)*($.clientHeight-sa);R.style.top=`${Ve}px`};V(),$.addEventListener("scroll",V),G.addEventListener("click",na=>{if(na.target===G){const sa=na.clientY,ia=G.getBoundingClientRect(),Ve=parseFloat(R.style.height),va=ia.height;let Me;sa<ia.top+Ve/2?Me=0:sa>ia.bottom-Ve/2?Me=$.scrollHeight-$.clientHeight:Me=(sa-ia.top-Ve/2)/(va-Ve)*($.scrollHeight-$.clientHeight),$.scrollTo({top:Me,behavior:"smooth"})}});let Se=!1,Ne=0,O=0;R.addEventListener("mousedown",na=>{Se=!0,Ne=na.clientY,O=$.scrollTop,R.style.width="8px",R.style.background="rgba(52, 152, 219, 1)",R.style.opacity="1",R.style.boxShadow="0 0 8px rgba(52, 152, 219, 0.5)",document.body.style.userSelect="none",na.preventDefault()}),document.addEventListener("mousemove",na=>{if(!Se)return;const sa=na.clientY-Ne,ia=G.clientHeight,Ve=parseFloat(R.style.height),Me=sa/(ia-Ve)*($.scrollHeight-$.clientHeight);$.scrollTop=Math.max(0,Math.min(O+Me,$.scrollHeight-$.clientHeight))}),document.addEventListener("mouseup",()=>{Se&&(Se=!1,R.style.width="6px",R.style.background="rgba(52, 152, 219, 0.5)",R.style.opacity="0.5",R.style.boxShadow="0 0 3px rgba(0, 0, 0, 0.2)",document.body.style.userSelect="")}),window.addEventListener("resize",V);const We=()=>{$.scrollHeight>$.clientHeight?(G.style.display="block",V()):G.style.display="none"};We(),new ResizeObserver(()=>{We()}).observe($);let Ye;const ra=()=>{R.style.opacity="0.5",G.style.opacity="1",clearTimeout(Ye),Ye=setTimeout(()=>{!Se&&!R.matches(":hover")&&(R.style.opacity="0.2",G.style.opacity="0.5")},1500)};$.addEventListener("mousemove",ra),$.addEventListener("scroll",ra),ra()}},100)}),go(()=>{_()}),so();var m=mi(),j=r(m);Mr(j,{});var oe=c(j,4),se=r(oe),N=c(r(se),2),C=r(N);o(N),o(se);var y=c(se,2);{var z=$=>{var G=vi();A($,G)},F=$=>{var G=rs(),R=At(G);gr(R,()=>e(l),V=>{var Se=fi(),Ne=r(Se),O=r(Ne);Zr(O,{}),o(Ne);var We=c(Ne,2),Je=r(We);Dn(Je,{}),o(We);var Ye=c(We,2),ra=r(Ye);ui(ra,{}),o(Ye),o(Se),A(V,Se)}),A($,G)};U(y,$=>{e(u)?$(z):$(F,!1)})}var Q=c(y,2),Z=r(Q);o(Q),o(oe),Da(2),o(m),Y(()=>I(C,`Control inteligente de turnos y horarios - Equipo ${e(l)+1}`)),q("click",Z,k),A(f,m),no()}export{xi as component};
