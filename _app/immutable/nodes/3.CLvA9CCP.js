var Fs=Object.defineProperty,Bs=Object.defineProperties;var Ns=Object.getOwnPropertyDescriptors;var Qo=Object.getOwnPropertySymbols;var Ls=Object.prototype.hasOwnProperty,js=Object.prototype.propertyIsEnumerable;var Eo=(u,o,l)=>o in u?Fs(u,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[o]=l,fe=(u,o)=>{for(var l in o||(o={}))Ls.call(o,l)&&Eo(u,l,o[l]);if(Qo)for(var l of Qo(o))js.call(o,l)&&Eo(u,l,o[l]);return u},Da=(u,o)=>Bs(u,Ns(o));var fo=(u,o,l)=>Eo(u,typeof o!="symbol"?o+"":o,l);var L=(u,o,l)=>new Promise((v,h)=>{var _=P=>{try{g(l.next(P))}catch(ne){h(ne)}},R=P=>{try{g(l.throw(P))}catch(ne){h(ne)}},g=P=>P.done?v(P.value):Promise.resolve(P.value).then(_,R);g((l=l.apply(u,o)).next())});import{t as D,a as E,c as ns,d as Ps}from"../chunks/BNmcetHy.js";import{i as so}from"../chunks/BDr50rkW.js";import{h as ga,a as is,as as ls,at as Gs,au as Hs,b as cs,p as ds,f as Fo,g as Lt,U as Ws,B as Js,s as Ao,q as Us,K as e,ag as He,c as Ys,r as Zo,d as Do,v as Vs,e as us,av as Mo,z as vs,D as es,aw as as,aj as Ks,a6 as ts,ax as Bo,ay as Xs,y as Qs,az as Zs,R as er,aA as No,aB as ar,t as tr,$ as fs,aC as gs,Z as or,aD as sr,aE as rr,ab as nr,aF as ir,aG as lr,aH as cr,J as dr,ad as ur,a9 as vr,Y as fr,i as ro,a8 as f,T as Y,j as no,aI as K,l as r,m as s,k as c,n as Ma,aJ as Wa,aK as Lo,S as Dt,aL as la,aM as os}from"../chunks/DaE5MSfA.js";import{s as T}from"../chunks/BV8iJQ_a.js";import{i as U}from"../chunks/BoIzsM2c.js";import{b as gr,l as mr,e as I}from"../chunks/DSVRfPyN.js";import{o as io,a as mo}from"../chunks/Yy9SlnIH.js";import{w as pr,g as hr}from"../chunks/DTNazjUA.js";function br(u,o,l){ga&&is();var v=u,h=Ws,_,R=ls()?Gs:Hs;cs(()=>{R(h,h=o())&&(_&&ds(_),_=Fo(()=>l(v)))}),ga&&(v=Lt)}function wa(u,o){return o}function yr(u,o,l,v){for(var h=[],_=o.length,R=0;R<_;R++)Xs(o[R].e,h,!0);var g=_>0&&h.length===0&&l!==null;if(g){var P=l.parentNode;Qs(P),P.append(l),v.clear(),vt(u,o[0].prev,o[_-1].next)}Zs(h,()=>{for(var ne=0;ne<_;ne++){var se=o[ne];g||(v.delete(se.k),vt(u,se.prev,se.next)),er(se.e,!g)}})}function oa(u,o,l,v,h,_=null){var R=u,g={flags:o,items:new Map,first:null},P=(o&gs)!==0;if(P){var ne=u;R=ga?Ao(Us(ne)):ne.appendChild(Js())}ga&&is();var se=null,B=!1,C=He(()=>{var y=l();return fs(y)?y:y==null?[]:vs(y)});cs(()=>{var y=e(C),O=y.length;if(B&&O===0)return;B=O===0;let z=!1;if(ga){var Q=R.data===Ys;Q!==(O===0)&&(R=Zo(),Ao(R),Do(!1),z=!0)}if(ga){for(var Z=null,V,me=0;me<O;me++){if(Lt.nodeType===8&&Lt.data===Vs){R=Lt,z=!0,Do(!1);break}var N=y[me],M=v(N,me);V=ms(Lt,g,Z,null,N,M,me,h,o,l),g.items.set(M,V),Z=V}O>0&&Ao(Zo())}ga||_r(y,g,R,h,o,v,l),_!==null&&(O===0?se?us(se):se=Fo(()=>_(R)):se!==null&&ds(se,()=>{se=null})),z&&Do(!0),e(C)}),ga&&(R=Lt)}function _r(u,o,l,v,h,_,R){var ma,pa,Ye,Ge;var g=(h&sr)!==0,P=(h&(No|Bo))!==0,ne=u.length,se=o.items,B=o.first,C=B,y,O=null,z,Q=[],Z=[],V,me,N,M;if(g)for(M=0;M<ne;M+=1)V=u[M],me=_(V,M),N=se.get(me),N!==void 0&&((ma=N.a)==null||ma.measure(),(z!=null?z:z=new Set).add(N));for(M=0;M<ne;M+=1){if(V=u[M],me=_(V,M),N=se.get(me),N===void 0){var ee=C?C.e.nodes_start:l;O=ms(ee,o,O,O===null?o.first:O.next,V,me,M,v,h,R),se.set(me,O),Q=[],Z=[],C=O.next;continue}if(P&&wr(N,V,M,h),(N.e.f&Mo)!==0&&(us(N.e),g&&((pa=N.a)==null||pa.unfix(),(z!=null?z:z=new Set).delete(N))),N!==C){if(y!==void 0&&y.has(N)){if(Q.length<Z.length){var H=Z[0],q;O=H.prev;var Le=Q[0],je=Q[Q.length-1];for(q=0;q<Q.length;q+=1)ss(Q[q],H,l);for(q=0;q<Z.length;q+=1)y.delete(Z[q]);vt(o,Le.prev,je.next),vt(o,O,Le),vt(o,je,H),C=H,O=je,M-=1,Q=[],Z=[]}else y.delete(N),ss(N,C,l),vt(o,N.prev,N.next),vt(o,N,O===null?o.first:O.next),vt(o,O,N),O=N;continue}for(Q=[],Z=[];C!==null&&C.k!==me;)(C.e.f&Mo)===0&&(y!=null?y:y=new Set).add(C),Z.push(C),C=C.next;if(C===null)continue;N=C}Q.push(N),O=N,C=N.next}if(C!==null||y!==void 0){for(var sa=y===void 0?[]:vs(y);C!==null;)(C.e.f&Mo)===0&&sa.push(C),C=C.next;var ra=sa.length;if(ra>0){var Ba=(h&gs)!==0&&ne===0?l:null;if(g){for(M=0;M<ra;M+=1)(Ye=sa[M].a)==null||Ye.measure();for(M=0;M<ra;M+=1)(Ge=sa[M].a)==null||Ge.fix()}yr(o,sa,Ba,se)}}g&&or(()=>{var Me;if(z!==void 0)for(N of z)(Me=N.a)==null||Me.apply()}),es.first=o.first&&o.first.e,es.last=O&&O.e}function wr(u,o,l,v){(v&No)!==0&&as(u.v,o),(v&Bo)!==0?as(u.i,l):u.i=l}function ms(u,o,l,v,h,_,R,g,P,ne){var se=(P&No)!==0,B=(P&ar)===0,C=se?B?Ks(h):ts(h):h,y=(P&Bo)===0?R:ts(R),O={i:y,v:C,k:_,a:null,e:null,prev:l,next:v};try{return O.e=Fo(()=>g(u,C,y,ne),ga),O.e.prev=l&&l.e,O.e.next=v&&v.e,l===null?o.first=O:(l.next=O,l.e.next=O.e),v!==null&&(v.prev=O,v.e.prev=O.e),O}finally{}}function ss(u,o,l){for(var v=u.next?u.next.e.nodes_start:l,h=o?o.e.nodes_start:l,_=u.e.nodes_start;_!==v;){var R=tr(_);h.before(_),_=R}}function vt(u,o,l){o===null?u.first=l:(o.next=l,o.e.next=l&&l.e),l!==null&&(l.prev=o,l.e.prev=o&&o.e)}function ps(u){var o,l,v="";if(typeof u=="string"||typeof u=="number")v+=u;else if(typeof u=="object")if(Array.isArray(u)){var h=u.length;for(o=0;o<h;o++)u[o]&&(l=ps(u[o]))&&(v&&(v+=" "),v+=l)}else for(l in u)u[l]&&(v&&(v+=" "),v+=l);return v}function Sr(){for(var u,o,l=0,v="",h=arguments.length;l<h;l++)(u=arguments[l])&&(o=ps(u))&&(v&&(v+=" "),v+=o);return v}function Cr(u){return typeof u=="object"?Sr(u):u!=null?u:""}function xr(u,o,l){var v=u==null?"":""+u;return o&&(v=v?v+" "+o:o),v===""?null:v}function Rr(u,o){return u==null?null:String(u)}function ca(u,o,l,v,h,_){var R=u.__className;if(ga||R!==l){var g=xr(l,v);(!ga||g!==u.getAttribute("class"))&&(g==null?u.removeAttribute("class"):u.className=g),u.__className=l}return _}function Xa(u,o,l,v){var h=u.__style;if(ga||h!==o){var _=Rr(o);(!ga||_!==u.getAttribute("style"))&&(_==null?u.removeAttribute("style"):u.style.cssText=_),u.__style=o}return v}const kr=Symbol("is custom element"),Er=Symbol("is html");function qo(u){if(ga){var o=!1,l=()=>{if(!o){if(o=!0,u.hasAttribute("value")){var v=u.value;Fa(u,"value",null),u.value=v}if(u.hasAttribute("checked")){var h=u.checked;Fa(u,"checked",null),u.checked=h}}};u.__on_r=l,lr(l),gr()}}function Fa(u,o,l,v){var h=Ar(u);ga&&(h[o]=u.getAttribute(o),o==="src"||o==="srcset"||o==="href"&&u.nodeName==="LINK")||h[o]!==(h[o]=l)&&(o==="loading"&&(u[cr]=l),l==null?u.removeAttribute(o):typeof l!="string"&&Dr(u).includes(o)?u[o]=l:u.setAttribute(o,l))}function Ar(u){var o;return(o=u.__attributes)!=null?o:u.__attributes={[kr]:u.nodeName.includes("-"),[Er]:u.namespaceURI===rr}}var rs=new Map;function Dr(u){var o=rs.get(u.nodeName);if(o)return o;rs.set(u.nodeName,o=[]);for(var l,v=u,h=Element.prototype;h!==v;){l=ir(v);for(var _ in l)l[_].set&&o.push(_);v=nr(v)}return o}function Oo(u,o,l=o){var v=ls();mr(u,"input",h=>{var _=h?u.defaultValue:u.value;if(_=$o(u)?To(_):_,l(_),v&&_!==(_=o())){var R=u.selectionStart,g=u.selectionEnd;u.value=_!=null?_:"",g!==null&&(u.selectionStart=R,u.selectionEnd=Math.min(g,u.value.length))}}),(ga&&u.defaultValue!==u.value||dr(o)==null&&u.value)&&l($o(u)?To(u.value):u.value),ur(()=>{var h=o();$o(u)&&h===To(u.value)||u.type==="date"&&!h&&!u.value||h!==u.value&&(u.value=h!=null?h:"")})}function $o(u){var o=u.type;return o==="number"||o==="range"}function To(u){return u===""?null:+u}function Io(u,o,l){var v=vr(u,o);v&&v.set&&(u[o]=l,fr(()=>{u[o]=null}))}function jt(u){return function(...o){var l=o[0];return l.stopPropagation(),u==null?void 0:u.apply(this,o)}}function hs(u){return function(...o){var l=o[0];return l.preventDefault(),u==null?void 0:u.apply(this,o)}}function Pt(u,o){var _;var l=(_=u.$$events)==null?void 0:_[o.type],v=fs(l)?l.slice():l==null?[]:[l];for(var h of v)h.call(this,o)}const go=pr(0);var Mr=D('<span class="active-indicator svelte-f1u16a"></span>'),$r=D('<button><span class="team-icon svelte-f1u16a"> </span> <span class="team-name svelte-f1u16a"> </span> <!></button>'),Tr=D('<div class="team-switcher svelte-f1u16a"><div class="team-tabs svelte-f1u16a"></div> <div class="team-info svelte-f1u16a"><span class="current-team svelte-f1u16a"> </span> <span class="shortcut-hint svelte-f1u16a">Ctrl+Tab para cambiar</span></div></div>');function Ir(u,o){ro(o,!1);const l=[{id:0,name:"Equipo 1",icon:"1️⃣",color:"#3498db"},{id:1,name:"Equipo 2",icon:"2️⃣",color:"#e74c3c"},{id:2,name:"Equipo 3",icon:"3️⃣",color:"#2ecc71"}];let v=K(0);go.subscribe(B=>{f(v,B)});function h(B){go.set(B),localStorage.setItem("gestionRotaciones_activeTeam",B.toString())}function _(B){if((B.ctrlKey||B.metaKey)&&B.key>="1"&&B.key<="3"){B.preventDefault();const C=parseInt(B.key)-1;C<l.length&&h(C)}if((B.ctrlKey||B.metaKey)&&B.key==="Tab"){B.preventDefault();const C=(e(v)+1)%l.length;h(C)}}io(()=>{const B=localStorage.getItem("gestionRotaciones_activeTeam");return B&&go.set(parseInt(B)),window.addEventListener("keydown",_),()=>{window.removeEventListener("keydown",_)}}),so();var R=Tr(),g=r(R);oa(g,5,()=>l,wa,(B,C)=>{var y=$r(),O=r(y),z=r(O,!0);s(O);var Q=c(O,2),Z=r(Q,!0);s(Q);var V=c(Q,2);{var me=N=>{var M=Mr();E(N,M)};U(V,N=>{e(v)===e(C).id&&N(me)})}s(y),Y(()=>{var N,M,ee;ca(y,1,`team-tab ${(N=e(v)===e(C).id?"active":"")!=null?N:""}`,"svelte-f1u16a"),Xa(y,`--team-color: ${(M=e(C).color)!=null?M:""}`),Fa(y,"title",`${(ee=e(C).name)!=null?ee:""} (Ctrl+${e(C).id+1})`),T(z,e(C).icon),T(Z,e(C).name)}),I("click",y,()=>h(e(C).id)),E(B,y)}),s(g);var P=c(g,2),ne=r(P),se=r(ne);s(ne),Ma(2),s(P),s(R),Y(()=>{var B;return T(se,`Trabajando en: ${(B=l[e(v)].name)!=null?B:""}`)}),E(u,R),no()}const qa=class qa{constructor(){if(qa.instance)return qa.instance;this.db=null,this.isInitialized=!1,this.subscribers=new Map,this.initPromise=null,this.currentTeamId=0,qa.instance=this}static getDBName(o=0){return`${qa.DB_NAME_PREFIX}_Team${o}`}switchTeam(o){return L(this,null,function*(){return this.currentTeamId===o&&this.isInitialized?(console.log(`✅ Ya estás en el equipo ${o}`),this.db):(console.log(`🔄 Cambiando del equipo ${this.currentTeamId} al equipo ${o}...`),this.db&&(this.db.close(),console.log(`🔒 Conexión cerrada para equipo ${this.currentTeamId}`)),this.db=null,this.isInitialized=!1,this.initPromise=null,this.currentTeamId=o,this._notifyTeamChange(o),this.init(o))})}getCurrentTeamId(){return this.currentTeamId}_notifyTeamChange(o){this.subscribers.forEach((l,v)=>{l.forEach(h=>{try{h({storeName:v,action:"teamChange",data:{oldTeamId:this.currentTeamId,newTeamId:o}})}catch(_){console.error("❌ Error en callback de cambio de equipo:",_)}})})}init(o=null){return L(this,null,function*(){if(o!==null&&o!==this.currentTeamId)return this.switchTeam(o);if(this.isInitialized&&this.db&&this.currentTeamId===(o!=null?o:this.currentTeamId))return this.db;if(this.initPromise)return this.initPromise;this.initPromise=this._initDatabase(o!=null?o:this.currentTeamId);try{const l=yield this.initPromise;return this.isInitialized=!0,l}catch(l){throw this.initPromise=null,l}})}_initDatabase(o){return new Promise((l,v)=>{const h=qa.getDBName(o);console.log(`🚀 Inicializando base de datos para equipo ${o}: ${h}...`);const _=indexedDB.open(h,qa.DB_VERSION);_.onerror=R=>{console.error(`❌ Error abriendo base de datos del equipo ${o}:`,R),v(new Error("Failed to open database"))},_.onsuccess=R=>{this.db=R.target.result,this.currentTeamId=o,console.log(`✅ Base de datos abierta correctamente para equipo ${o}`),this.db.onerror=g=>{console.error(`❌ Error en base de datos del equipo ${o}:`,g)},l(this.db)},_.onupgradeneeded=R=>{const g=R.target.result;console.log(`🔄 Actualizando estructura de base de datos del equipo ${o} de v${R.oldVersion} a v${R.newVersion}...`),this._createObjectStores(g,R.oldVersion),this._migrateData(R.oldVersion,R.newVersion,o)}})}_createObjectStores(o,l){[{name:"roles",keyPath:"id",autoIncrement:!0,description:"Almacén de roles y certificaciones"},{name:"collaborators",keyPath:"id",autoIncrement:!0,description:"Almacén de colaboradores"},{name:"coverage",keyPath:"id",description:"Configuración de roles compartidos (legacy)"},{name:"colorGroups",keyPath:"id",description:"Configuración de grupos por colores"},{name:"rotations",keyPath:"id",autoIncrement:!0,description:"Rotaciones por mes/año"},{name:"rotationConfig",keyPath:"id",description:"Configuración general del sistema de rotaciones"},{name:"teamConfig",keyPath:"id",description:"Configuración específica del equipo"}].forEach(h=>{if(o.objectStoreNames.contains(h.name))console.log(`✓ Almacén ya existe: ${h.name}`);else{console.log(`📦 Creando almacén: ${h.name}`);const _=o.createObjectStore(h.name,{keyPath:h.keyPath,autoIncrement:h.autoIncrement||!1});h.name==="rotations"&&(_.createIndex("monthYear",["year","month"],{unique:!1}),_.createIndex("rotationNumber","rotationNumber",{unique:!1})),console.log(`✅ ${h.description} creado`)}})}_migrateData(o,l,v){console.log(`🔄 Migrando datos de versión ${o} a ${l} para equipo ${v}`),o<2&&this._migrateFromLocalStorage(v),o<3&&(console.log("🔄 Inicializando datos para grupos por colores..."),setTimeout(()=>{this._initializeColorGroups()},100))}_initializeColorGroups(){return L(this,null,function*(){try{if(!(yield this.getById("colorGroups",1).catch(()=>null))){const l={id:1,groups:{blue:[],orange:[],green:[]},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};yield this.save("colorGroups",l),console.log("✅ Grupos por colores inicializados")}}catch(o){console.error("❌ Error inicializando grupos por colores:",o)}})}_migrateFromLocalStorage(o){return L(this,null,function*(){try{console.log(`📦 Migrando datos desde localStorage para equipo ${o}...`);const l=o>0?`gestionRotaciones_team${o}_`:"gestionRotaciones_",v=localStorage.getItem(`${l}roles`);if(v){const g=JSON.parse(v);yield this.saveAll("roles",g),console.log("✅ Roles migrados")}const h=localStorage.getItem(`${l}collaborators`);if(h){const g=JSON.parse(h);yield this.saveAll("collaborators",g),console.log("✅ Colaboradores migrados")}const _=localStorage.getItem(`${l}coverage`);_&&(yield this.save("coverage",{id:1,roleNames:JSON.parse(_)}),console.log("✅ Cobertura migrada"));const R=localStorage.getItem(`${l}colorGroups`);R&&(yield this.save("colorGroups",{id:1,groups:JSON.parse(R)}),console.log("✅ Grupos por colores migrados desde localStorage")),console.log("🎉 Migración completada exitosamente")}catch(l){console.error("❌ Error en migración:",l)}})}save(o,l){return L(this,null,function*(){return this.db||(yield this.init()),new Promise((v,h)=>{try{const _=this.db.transaction([o],"readwrite"),R=_.objectStore(o);_.oncomplete=()=>{console.log(`✅ Datos guardados en ${o} (Equipo ${this.currentTeamId})`),this.notify(o,"save",l),v()},_.onerror=()=>{console.error(`❌ Error guardando en ${o}:`,_.error),h(_.error)},l.id?R.put(l):R.add(l)}catch(_){console.error(`❌ Error en transacción ${o}:`,_),h(_)}})})}saveAll(o,l){return L(this,null,function*(){return this.db||(yield this.init()),new Promise((v,h)=>{try{const _=this.db.transaction([o],"readwrite"),R=_.objectStore(o);_.oncomplete=()=>{console.log(`✅ ${l.length} elementos guardados en ${o} (Equipo ${this.currentTeamId})`),this.notify(o,"saveAll",l),v()},_.onerror=()=>{console.error(`❌ Error guardando múltiples en ${o}:`,_.error),h(_.error)};const g=R.clear();g.onsuccess=()=>{l.forEach((P,ne)=>{const se=Da(fe({},P),{id:P.id||ne+1});R.add(se)})},g.onerror=()=>{h(g.error)}}catch(_){console.error(`❌ Error en transacción saveAll ${o}:`,_),h(_)}})})}getAll(o){return L(this,null,function*(){return this.db||(yield this.init()),new Promise((l,v)=>{try{const R=this.db.transaction([o],"readonly").objectStore(o).getAll();R.onsuccess=()=>{console.log(`📖 ${R.result.length} elementos cargados de ${o} (Equipo ${this.currentTeamId})`),l(R.result)},R.onerror=()=>{console.error(`❌ Error cargando de ${o}:`,R.error),v(R.error)}}catch(h){console.error(`❌ Error en transacción getAll ${o}:`,h),v(h)}})})}getById(o,l){return L(this,null,function*(){return this.db||(yield this.init()),new Promise((v,h)=>{try{const g=this.db.transaction([o],"readonly").objectStore(o).get(l);g.onsuccess=()=>{v(g.result)},g.onerror=()=>{h(g.error)}}catch(_){console.error(`❌ Error en transacción getById ${o}:`,_),h(_)}})})}delete(o,l){return L(this,null,function*(){return this.db||(yield this.init()),new Promise((v,h)=>{try{const g=this.db.transaction([o],"readwrite").objectStore(o).delete(l);g.onsuccess=()=>{console.log(`🗑️ Elemento ${l} eliminado de ${o} (Equipo ${this.currentTeamId})`),this.notify(o,"delete",{id:l}),v()},g.onerror=()=>{console.error(`❌ Error eliminando de ${o}:`,g.error),h(g.error)}}catch(_){console.error(`❌ Error en transacción delete ${o}:`,_),h(_)}})})}clear(o){return L(this,null,function*(){return this.db||(yield this.init()),new Promise((l,v)=>{try{const R=this.db.transaction([o],"readwrite").objectStore(o).clear();R.onsuccess=()=>{console.log(`🧹 Almacén ${o} limpiado (Equipo ${this.currentTeamId})`),this.notify(o,"clear"),l()},R.onerror=()=>{console.error(`❌ Error limpiando ${o}:`,R.error),v(R.error)}}catch(h){console.error(`❌ Error en transacción clear ${o}:`,h),v(h)}})})}subscribe(o,l){return this.subscribers.has(o)||this.subscribers.set(o,new Set),this.subscribers.get(o).add(l),console.log(`🔔 Suscripción agregada para ${o} (Equipo ${this.currentTeamId})`),()=>this.unsubscribe(o,l)}unsubscribe(o,l){this.subscribers.has(o)&&(this.subscribers.get(o).delete(l),console.log(`🔕 Suscripción removida para ${o}`))}notify(o,l,v=null){this.subscribers.has(o)&&this.subscribers.get(o).forEach(_=>{try{_({storeName:o,action:l,data:v,teamId:this.currentTeamId})}catch(R){console.error("❌ Error en callback de notificación:",R)}})}isStoreEmpty(o){return L(this,null,function*(){try{return(yield this.getAll(o)).length===0}catch(l){return console.error(`❌ Error verificando si ${o} está vacío:`,l),!0}})}getStorageStats(){return L(this,null,function*(){if(!this.db)return null;try{const o={},l=["roles","collaborators","coverage","colorGroups","rotations","rotationConfig","teamConfig"];for(const v of l)try{const h=yield this.getAll(v);o[v]={count:h.length,size:JSON.stringify(h).length}}catch(h){console.warn(`⚠️ No se pudo obtener stats para ${v}:`,h),o[v]={count:0,size:0,error:h.message}}return{teamId:this.currentTeamId,stores:o,totalSize:Object.values(o).reduce((v,h)=>v+(h.size||0),0),lastAccessed:new Date().toISOString()}}catch(o){return console.error("❌ Error obteniendo estadísticas:",o),null}})}getTeamConfig(){return L(this,null,function*(){try{return(yield this.getById("teamConfig",1))||{id:1,teamId:this.currentTeamId,name:`Equipo ${this.currentTeamId+1}`,color:this.currentTeamId===0?"#3498db":this.currentTeamId===1?"#e74c3c":"#2ecc71",createdAt:new Date().toISOString()}}catch(o){return console.error("❌ Error obteniendo configuración del equipo:",o),null}})}saveTeamConfig(o){return L(this,null,function*(){try{yield this.save("teamConfig",Da(fe({id:1},o),{teamId:this.currentTeamId,updatedAt:new Date().toISOString()})),console.log("✅ Configuración del equipo guardada")}catch(l){console.error("❌ Error guardando configuración del equipo:",l)}})}saveToLocalStorage(o,l){return L(this,null,function*(){try{const v=this.currentTeamId>0?`team${this.currentTeamId}_${o}`:o;localStorage.setItem(v,JSON.stringify(l)),console.log(`💾 Respaldo guardado en localStorage: ${v}`)}catch(v){console.error("❌ Error guardando en localStorage:",v)}})}getFromLocalStorage(o,l=null){try{const v=this.currentTeamId>0?`team${this.currentTeamId}_${o}`:o,h=localStorage.getItem(v);return h?JSON.parse(h):l}catch(v){return console.error("❌ Error cargando de localStorage:",v),l}}getRotationByMonthYear(o,l){return L(this,null,function*(){try{return(yield this.getAll("rotations")).find(h=>h.year===o&&h.month===l)}catch(v){return console.error("❌ Error obteniendo rotación:",v),null}})}saveRotation(o,l,v){return L(this,null,function*(){try{const _=(yield this.getAll("rotations")).find(g=>g.year===o&&g.month===l),R={year:o,month:l,assignments:v,teamId:this.currentTeamId,updatedAt:new Date().toISOString()};return _&&(R.id=_.id),yield this.save("rotations",R),yield this.saveToLocalStorage("gestionRotaciones_currentRotation",R),R}catch(h){throw console.error("❌ Error guardando rotación:",h),h}})}reinitializeDatabase(){return L(this,null,function*(){try{console.log(`🔄 Reinicializando base de datos del equipo ${this.currentTeamId}...`),this.db&&this.db.close(),this.db=null,this.isInitialized=!1,this.initPromise=null;const o=qa.getDBName(this.currentTeamId);return yield new Promise((l,v)=>{const h=indexedDB.deleteDatabase(o);h.onsuccess=()=>{console.log(`✅ Base de datos ${o} eliminada`),l()},h.onerror=()=>{console.error("❌ Error eliminando base de datos:",h.error),v(h.error)}}),yield this.init(this.currentTeamId),console.log("✅ Base de datos reinicializada correctamente"),!0}catch(o){return console.error("❌ Error reinicializando base de datos:",o),!1}})}copyDataBetweenTeams(h,_){return L(this,arguments,function*(o,l,v=["roles","collaborators"]){try{console.log(`📋 Copiando datos del equipo ${o} al equipo ${l}...`);const R=this.currentTeamId;yield this.switchTeam(o);const g={};for(const P of v)g[P]=yield this.getAll(P);yield this.switchTeam(l);for(const P of v)g[P]&&g[P].length>0&&(yield this.saveAll(P,g[P]));return yield this.switchTeam(R),console.log("✅ Datos copiados exitosamente"),!0}catch(R){return console.error("❌ Error copiando datos entre equipos:",R),!1}})}};fo(qa,"instance",null),fo(qa,"DB_NAME_PREFIX","GestionRotacionesDB"),fo(qa,"DB_VERSION",3);let zo=qa;const ta=new zo,Re={init:u=>ta.init(u),save:(u,o)=>ta.save(u,o),saveAll:(u,o)=>ta.saveAll(u,o),getAll:u=>ta.getAll(u),getById:(u,o)=>ta.getById(u,o),delete:(u,o)=>ta.delete(u,o),clear:u=>ta.clear(u),subscribe:(u,o)=>ta.subscribe(u,o),notify:(u,o,l)=>ta.notify(u,o,l),getRotation:(u,o)=>ta.getRotationByMonthYear(u,o),saveRotation:(u,o,l)=>ta.saveRotation(u,o,l),stats:()=>ta.getStorageStats(),isEmpty:u=>ta.isStoreEmpty(u),reinitialize:()=>ta.reinitializeDatabase(),switchTeam:u=>ta.switchTeam(u),getCurrentTeamId:()=>ta.getCurrentTeamId(),getTeamConfig:()=>ta.getTeamConfig(),saveTeamConfig:u=>ta.saveTeamConfig(u),copyDataBetweenTeams:(u,o,l)=>ta.copyDataBetweenTeams(u,o,l)};var qr=D('<div class="input-hint error"> </div>'),Or=D('<div class="error-message"> </div>'),zr=D('<tr><td> </td><td> </td><td><span> </span></td><td><span> </span></td><td><button class="icon-button edit">✏️</button> <button class="icon-button calendar">📅</button> <button class="icon-button daily-max" title="Configurar máximos por día">👥</button> <button class="icon-button delete">🗑️</button></td></tr>'),Fr=D('<div class="roles-list"><h3>Roles Configurados</h3> <div class="table-container"><table><thead><tr><th>Nombre del Rol</th><th>Mín</th><th>Máx</th><th>Días</th><th>Acción</th></tr></thead><tbody></tbody></table></div></div>'),Br=D('<p class="no-data">No hay roles configurados</p>'),Nr=D('<span class="role-count"> </span>'),Lr=D('<button><span class="color-dot"></span> <!></button>'),jr=D('<p class="color-instruction selected"><span class="instruction-icon">👆</span> Seleccionando roles para: <strong> </strong></p>'),Pr=D('<p class="color-instruction"><span class="instruction-icon">💡</span> Selecciona un color para empezar a agrupar roles</p>'),Gr=D('<span class="role-color-indicator"></span>'),Hr=D('<div><span class="role-name"> </span> <!></div>'),Wr=D(`<div class="roles-coverage-list"><h3>Roles a cubrir por el mismo colaborador</h3> <div class="color-selector"><h4>Selecciona un grupo de color:</h4> <div class="color-buttons"></div> <!></div> <div class="coverage-items"></div> <div class="coverage-info"><div class="coverage-summary"><h4><span class="summary-icon">🔄</span> Resumen de Roles Compartidos</h4> <p class="help-text">Los siguientes roles serán considerados para asignación compartida: <br> <strong> <br> <br> Selecciona un color y luego los roles que serán cubiertos por el mismo colaborador.
                  Cada color representa un grupo diferente.</strong></p></div></div></div>`),Jr=D('<span class="modal-subtitle"> </span>'),Ur=D('<div class="error-message"> </div>'),Yr=D('<div class="modal-backdrop"><div class="modal-content"><div class="modal-header"><h3>Actualizar Rol <!></h3> <button class="modal-close">×</button></div> <div class="modal-body"><div class="form-group"><label for="modalRoleName">Nombre del Rol:</label> <input id="modalRoleName" type="text" placeholder="Nombre del Rol" required></div> <div class="form-row"><div class="form-group"><label for="modalMinCollaborators">Mínimo Colaboradores:</label> <div class="number-input-container"><button type="button" class="number-button">-</button> <span class="number-display"> </span> <button type="button" class="number-button">+</button></div></div> <div class="form-group"><label for="modalMaxCollaborators">Máximo Colaboradores:</label> <div class="number-input-container"><button type="button" class="number-button">-</button> <span class="number-display"> </span> <button type="button" class="number-button">+</button></div></div></div> <div class="form-group"><label for="modalPriority">Prioridad:</label> <div class="number-input-container"><button type="button" class="number-button">-</button> <span class="number-display"> </span> <button type="button" class="number-button">+</button></div> <div class="input-hint">1 = Mayor prioridad, 2 = Menor prioridad</div></div> <!></div> <div class="modal-footer"><button class="cancel-button">Cancelar</button> <button class="action-button roles-button">Guardar Cambios</button></div></div></div>'),Vr=D('<span class="modal-subtitle"> </span>'),Kr=D('<div><div class="day-name"> </div> <div class="day-status"> </div></div>'),Xr=D('<div class="modal-backdrop"><div class="modal-content"><div class="modal-header"><h3>Configurar días excluidos <!></h3> <button class="modal-close">×</button></div> <div class="modal-body"><div class="days-section"><div class="days-header"><h4>Días en que NO se requiere este rol</h4> <div class="days-actions"><button class="days-action-button select-all">Excluir todos</button> <button class="days-action-button clear-all">Incluir todos</button></div></div> <p class="modal-description">Nota: Por defecto, los roles se requieren todos los días (lunes a viernes). Selecciona los días en los que excepcionalmente NO se requiere este rol.</p> <div class="days-grid"></div></div></div> <div class="modal-footer"><button class="cancel-button">Cancelar</button> <button class="action-button roles-button">Guardar Cambios</button></div></div></div>'),Qr=D('<span class="modal-subtitle"> </span>'),Zr=D('<div class="day-item daily-max-item"><div class="day-name"> </div> <div class="day-max-control"><div class="number-input-container compact"><button type="button" class="number-button">-</button> <span class="number-display"> </span> <button type="button" class="number-button">+</button></div></div></div>'),en=D('<div class="modal-backdrop"><div class="modal-content"><div class="modal-header"><h3>Configurar Máximos por Día <!></h3> <button class="modal-close">×</button></div> <div class="modal-body"><div class="days-section"><div class="days-header"><h4>Máximo de colaboradores por día</h4></div> <p class="modal-description">Configure el número máximo de colaboradores permitidos para cada día de la semana.</p> <div class="days-grid"></div> <div class="modal-note"><p> </p></div></div></div> <div class="modal-footer"><button class="cancel-button">Cancelar</button> <button class="action-button roles-button">Guardar Cambios</button></div></div></div>'),an=D('<section class="section-container roles-section"><h2>Gestión de Roles</h2> <div class="content"><form class="role-form"><div class="form-group"><label for="roleName">Nombre del Rol:</label> <input id="roleName" type="text" placeholder="Nombre del Rol" required> <!></div> <div class="form-row"><div class="form-group"><label for="minCollaborators">Mínimo Colaboradores:</label> <div class="number-input-container"><button type="button" class="number-button">-</button> <span class="number-display"> </span> <button type="button" class="number-button">+</button></div></div> <div class="form-group"><label for="maxCollaborators">Máximo Colaboradores:</label> <div class="number-input-container"><button type="button" class="number-button">-</button> <span class="number-display"> </span> <button type="button" class="number-button">+</button></div> <div class="input-hint">Máximo de colaboradores que pueden ser asignados a este rol por día</div></div></div> <!> <div class="form-actions"><button type="submit" class="action-button roles-button">Agregar Rol</button></div></form> <div class="role-management-container"><!> <!></div></div></section> <!> <!> <!>',1);function tn(u,o){ro(o,!1);const l=K();let v=K(""),h=K(1),_=K(1),R=1,g=K([]),P=K(-1),ne=K(""),se=K(!1),B=K([]),C=K("blue"),y=K({blue:[],orange:[],green:[]});const O=[{id:"blue",name:"Grupo Azul",color:"#3498db",bgColor:"rgba(52, 152, 219, 0.2)"},{id:"orange",name:"Grupo Naranja",color:"#f39c12",bgColor:"rgba(243, 156, 18, 0.2)"},{id:"green",name:"Grupo Verde",color:"#2ecc71",bgColor:"rgba(46, 204, 113, 0.2)"}];let z={monday:!1,tuesday:!1,wednesday:!1,thursday:!1,friday:!1},Q={monday:1,tuesday:1,wednesday:1,thursday:1,friday:1},Z=K(!1),V=K(-1),me=K(fe({},z)),N=K(!1),M=K(-1),ee=K(fe({},Q)),H=K(!1),q=K({name:"",min:1,max:1,priority:1,dailyMaxCollabs:fe({},Q)});const Le={monday:"Lunes",tuesday:"Martes",wednesday:"Miércoles",thursday:"Jueves",friday:"Viernes"};let je=null,sa=null;io(()=>L(this,null,function*(){try{console.log("🚀 Inicializando RolesManagement..."),yield Re.init(),console.log("✅ Servicio de base de datos inicializado"),yield ra(),je=Re.subscribe("roles",Me),sa=Re.subscribe("coverage",da),console.log("✅ Suscripciones configuradas"),f(se,!0),console.log("✅ RolesManagement inicializado correctamente")}catch(p){console.error("❌ Error inicializando RolesManagement:",p),yield ma(),f(se,!0)}})),mo(()=>{je&&je(),sa&&sa()});function ra(){return L(this,null,function*(){try{console.log("📖 Cargando datos desde servicio...");const p=yield Re.getAll("roles");f(g,(p||[]).map(pa)),console.log(`✅ ${e(g).length} roles cargados`);const w=yield Re.getById("coverage",1);f(B,(w==null?void 0:w.roleNames)||[]),yield Ba(),console.log(`✅ ${e(B).length} roles compartidos cargados (legacy)`)}catch(p){console.error("❌ Error cargando datos desde servicio:",p),yield ma()}})}function Ba(){return L(this,null,function*(){try{const p=yield Re.getById("colorGroups",1);f(y,(p==null?void 0:p.groups)||{blue:[],orange:[],green:[]}),console.log("✅ Grupos por colores cargados:",e(y))}catch(p){console.error("❌ Error cargando grupos por colores:",p);const w=localStorage.getItem("gestionRotaciones_colorGroups");w&&f(y,JSON.parse(w))}})}function ma(){return L(this,null,function*(){console.log("📁 Usando fallback a localStorage...");try{const p=localStorage.getItem("gestionRotaciones_roles");f(g,p?JSON.parse(p).map(pa):[]);const w=localStorage.getItem("gestionRotaciones_coverage");f(B,w?JSON.parse(w):[]);const G=localStorage.getItem("gestionRotaciones_colorGroups");G&&f(y,JSON.parse(G)),console.log("📁 Datos cargados desde localStorage")}catch(p){console.error("❌ Error en fallback localStorage:",p)}})}function pa(p){return Da(fe({},p),{excludedDays:p.excludedDays||fe({},z),dailyMaxCollabs:p.dailyMaxCollabs||{monday:p.max||1,tuesday:p.max||1,wednesday:p.max||1,thursday:p.max||1,friday:p.max||1},priority:p.priority||1})}function Ye(){return L(this,null,function*(){if(e(se))try{yield Re.saveAll("roles",e(g)),console.log("✅ Roles guardados correctamente"),yield Re.save("coverage",{id:1,roleNames:e(B)}),yield Re.save("colorGroups",{id:1,groups:e(y)}),console.log("✅ Cobertura guardada correctamente"),console.log("✅ Grupos por colores guardados correctamente")}catch(p){console.error("❌ Error guardando datos:",p),Ge()}})}function Ge(){try{localStorage.setItem("gestionRotaciones_roles",JSON.stringify(e(g))),localStorage.setItem("gestionRotaciones_coverage",JSON.stringify(e(B))),localStorage.setItem("gestionRotaciones_colorGroups",JSON.stringify(e(y))),console.log("💾 Datos guardados en localStorage (fallback)")}catch(p){console.error("❌ Error guardando en localStorage:",p)}}function Me(p){p.action==="saveAll"&&p.data&&e(se)&&console.log("🔄 Roles actualizados externamente")}function da(p){p.action==="save"&&p.data&&e(se)&&console.log("🔄 Cobertura actualizada externamente")}function Oa(p){const w=p.trimEnd();return w.length<3?"El nombre del rol debe tener al menos 3 caracteres":/^(\w)\1{2,}$/.test(w)?"El nombre no puede ser tres letras iguales consecutivas":/^[a-zA-ZáéíóúüÁÉÍÓÚÜñÑ0-9\s\(\)\-\/_]+$/.test(w)?p!==w?"El nombre no puede terminar con espacios":w.trim().length===0?"El nombre no puede estar vacío o contener solo espacios":null:"Solo se permiten letras, números, espacios, paréntesis (), guiones -, barras / y guiones bajos _"}function ka(p){return p.trimEnd()}function Ve(){e(h)<1&&f(h,1),e(_)<1&&f(_,1),e(_)<e(h)&&f(_,e(h)),Object.keys(Q).forEach(p=>{Q[p]=e(_)})}function Gt(){f(h,e(h)+1),Ve()}function Ht(){e(h)>1&&f(h,e(h)-1),Ve()}function Wt(){f(_,e(_)+1),Ve()}function Jt(){e(_)>1&&f(_,e(_)-1),Ve()}function Ut(){f(ne,"");const p=Oa(e(v));if(p){f(ne,p);return}const w=ka(e(v));if(Ve(),e(h)>e(_)){f(ne,"El mínimo no puede ser mayor que el máximo");return}if(e(g).find((ae,pe)=>ae.name.toLowerCase()===w.toLowerCase()&&pe!==e(P))){f(ne,"Ya existe un rol con este nombre");return}const X={name:w,min:e(h),max:e(_),priority:R,excludedDays:fe({},z),dailyMaxCollabs:fe({},Q)};f(g,[...e(g),X]),Mt()}function Mt(){f(v,""),f(h,1),f(_,1),R=1,Q={monday:1,tuesday:1,wednesday:1,thursday:1,friday:1}}function Na(p){const w=e(g)[p].name;f(g,e(g).filter((G,X)=>X!==p)),e(P)===p&&(Mt(),f(P,-1)),e(B).includes(w)&&f(B,e(B).filter(G=>G!==w)),Object.keys(e(y)).forEach(G=>{la(y,e(y)[G]=e(y)[G].filter(X=>X!==w))}),f(y,fe({},e(y))),Re.notify("roles","delete",{roleName:w})}function $t(p){e(C)===p?(la(y,e(y)[p]=[]),f(y,fe({},e(y))),f(C,null)):f(C,p)}function Yt(p){e(C)&&(e(y)[e(C)].includes(p)?la(y,e(y)[e(C)]=e(y)[e(C)].filter(w=>w!==p)):(Object.keys(e(y)).forEach(w=>{la(y,e(y)[w]=e(y)[w].filter(G=>G!==p))}),la(y,e(y)[e(C)]=[...e(y)[e(C)],p])),f(y,fe({},e(y))))}function Tt(p){for(const[w,G]of Object.entries(e(y)))if(G.includes(p))return O.find(X=>X.id===w);return null}function Qa(){const p=[];return Object.values(e(y)).forEach(w=>{p.push(...w)}),p}function ft(p){const w=e(g)[p];f(q,{name:w.name,min:w.min,max:w.max,priority:w.priority||1,dailyMaxCollabs:w.dailyMaxCollabs?fe({},w.dailyMaxCollabs):{monday:w.max||1,tuesday:w.max||1,wednesday:w.max||1,thursday:w.max||1,friday:w.max||1}}),f(P,p),f(H,!0),f(ne,"")}function ha(){f(H,!1),f(P,-1),f(ne,"")}function Vt(){const p=Oa(e(q).name);if(p){f(ne,p);return}const w=ka(e(q).name);if(e(g).find((ae,pe)=>ae.name.toLowerCase()===w.toLowerCase()&&pe!==e(P))){f(ne,"Ya existe un rol con este nombre");return}const X=e(g)[e(P)];if(e(q).max!==X.max&&Object.keys(e(q).dailyMaxCollabs).forEach(ae=>{la(q,e(q).dailyMaxCollabs[ae]=e(q).max)}),e(P)>=0&&e(P)<e(g).length){const ae=e(g)[e(P)].name,pe=w,xe=Da(fe({},e(g)[e(P)]),{name:pe,min:e(q).min,max:e(q).max,priority:e(q).priority,dailyMaxCollabs:fe({},e(q).dailyMaxCollabs)}),qe=[...e(g)];qe[e(P)]=xe,f(g,qe),ae!==pe&&(Object.keys(e(y)).forEach(le=>{la(y,e(y)[le]=e(y)[le].map(he=>he===ae?pe:he))}),f(y,fe({},e(y))),Re.notify("roles","rename",{oldName:ae,newName:pe})),ha()}}function gt(p){const w=e(g)[p];f(me,fe({},w.excludedDays||z)),f(V,p),f(Z,!0)}function Ja(){f(Z,!1),f(V,-1),f(me,fe({},z))}function It(p){f(me,Da(fe({},e(me)),{[p]:!e(me)[p]}))}function Kt(){if(e(V)>=0&&e(V)<e(g).length){const p=[...e(g)];p[e(V)].excludedDays=fe({},e(me)),f(g,p),Ja()}}function Xt(p){const w=e(g)[p];f(ee,fe({},w.dailyMaxCollabs||{monday:w.max||1,tuesday:w.max||1,wednesday:w.max||1,thursday:w.max||1,friday:w.max||1})),f(M,p),f(N,!0)}function La(){f(N,!1),f(M,-1),f(ee,fe({},Q))}function Za(p){f(ee,Da(fe({},e(ee)),{[p]:e(ee)[p]+1}))}function mt(p){const G=e(g)[e(M)].min||1;e(ee)[p]>G&&f(ee,Da(fe({},e(ee)),{[p]:e(ee)[p]-1}))}function et(){if(e(M)>=0&&e(M)<e(g).length){const p=[...e(g)];p[e(M)].dailyMaxCollabs=fe({},e(ee)),f(g,p),La()}}function at(p=!0){const w={};Object.keys(e(me)).forEach(G=>{w[G]=p}),f(me,w)}function ja(p){if(!p)return"Requerido todos los días";const w=Object.entries(p).filter(([G,X])=>X).map(([G,X])=>Le[G]);return w.length>0?`No requerido: ${w.join(", ")}`:"Requerido todos los días"}function pt(p){return p.excludedDays?Object.values(p.excludedDays).some(w=>w):!1}function Qt(p){if(!p.dailyMaxCollabs)return`Máx: ${p.max||1}`;const w=Object.values(p.dailyMaxCollabs);return w.every(X=>X===w[0])&&w[0]===p.max?`Máx: ${p.max}`:"Máx. por día: Varía"}function qt(p){if(!p.dailyMaxCollabs)return!1;const w=Object.values(p.dailyMaxCollabs);return!w.every(X=>X===w[0])||w[0]!==p.max}Wa(()=>(e(se),e(g)),()=>{e(se)&&e(g)&&Ye()}),Wa(()=>(e(se),e(y)),()=>{e(se)&&e(y)&&Ye()}),Wa(()=>(e(H),e(q),e(g),e(P)),()=>{if(e(H)&&e(q).max){const p=e(g)[e(P)];p&&e(q).max!==p.max&&la(q,e(q).dailyMaxCollabs={monday:e(q).max,tuesday:e(q).max,wednesday:e(q).max,thursday:e(q).max,friday:e(q).max})}}),Wa(()=>e(v),()=>{f(l,e(v).trim()?Oa(e(v)):null)}),Wa(()=>e(se),()=>{e(se)&&f(B,Qa())}),Lo(),so();var tt=an(),ht=Dt(tt),Ot=c(r(ht),2),ot=r(Ot),st=r(ot),rt=c(r(st),2);qo(rt);var Zt=c(rt,2);{var bt=p=>{var w=qr(),G=r(w,!0);s(w),Y(()=>T(G,e(l))),E(p,w)};U(Zt,p=>{e(l)&&e(v).trim()&&p(bt)})}s(st);var nt=c(st,2),yt=r(nt),Ea=c(r(yt),2),_t=r(Ea),wt=c(_t,2),zt=r(wt,!0);s(wt);var eo=c(wt,2);s(Ea),s(yt);var Ft=c(yt,2),St=c(r(Ft),2),m=r(St),$=c(m,2),W=r($,!0);s($);var F=c($,2);s(St),Ma(2),s(Ft),s(nt);var J=c(nt,2);{var ve=p=>{var w=Or(),G=r(w,!0);s(w),Y(()=>T(G,e(ne))),E(p,w)};U(J,p=>{e(ne)&&p(ve)})}Ma(2),s(ot);var $e=c(ot,2),Te=r($e);{var ke=p=>{var w=Fr(),G=c(r(w),2),X=r(G),ae=c(r(X));oa(ae,5,()=>[...e(g)].sort((pe,xe)=>pe.name.localeCompare(xe.name)),pe=>pe.id||pe.name,(pe,xe)=>{var qe=zr(),le=r(qe),he=r(le,!0);s(le);var ye=c(le),Ee=r(ye,!0);s(ye);var Ie=c(ye),_e=r(Ie),de=r(_e,!0);s(_e),s(Ie);var ce=c(Ie),Ae=r(ce),Se=r(Ae,!0);s(Ae),s(ce);var ie=c(ce),te=r(ie),we=c(te,2),ue=c(we,2),Ce=c(ue,2);s(ie),s(qe),Y((be,De,na,Ze)=>{T(he,e(xe).name),T(Ee,e(xe).min),ca(_e,1,`max-value ${be!=null?be:""}`),T(de,De),ca(Ae,1,`days-info ${na!=null?na:""}`),T(Se,Ze)},[()=>qt(e(xe))?"has-variable-maxs":"",()=>Qt(e(xe)),()=>pt(e(xe))?"has-excluded":"",()=>ja(e(xe).excludedDays)],He),I("click",te,()=>{const be=e(g).findIndex(De=>De.name===e(xe).name);ft(be)}),I("click",we,()=>{const be=e(g).findIndex(De=>De.name===e(xe).name);gt(be)}),I("click",ue,()=>{const be=e(g).findIndex(De=>De.name===e(xe).name);Xt(be)}),I("click",Ce,()=>{const be=e(g).findIndex(De=>De.name===e(xe).name);Na(be)}),E(pe,qe)}),s(ae),s(X),s(G),s(w),E(p,w)},We=p=>{var w=Br();E(p,w)};U(Te,p=>{e(g).length>0?p(ke):p(We,!1)})}var Xe=c(Te,2);{var ba=p=>{var w=Wr(),G=c(r(w),2),X=c(r(G),2);oa(X,5,()=>O,wa,(_e,de)=>{var ce=Lr(),Ae=c(r(ce),2);{var Se=ie=>{var te=Nr(),we=r(te,!0);s(te),Y(()=>T(we,e(y)[e(de).id].length)),E(ie,te)};U(Ae,ie=>{e(y)[e(de).id].length>0&&ie(Se)})}s(ce),Y(()=>{var ie,te,we,ue,Ce;ca(ce,1,`color-button ${(ie=e(C)===e(de).id?"active":"")!=null?ie:""}`),Xa(ce,`background-color: ${(te=e(de).color)!=null?te:""}`),Fa(ce,"title",`${(we=e(de).name)!=null?we:""} (${(ue=e(y)[e(de).id].length)!=null?ue:""} roles) - Clic para ${(Ce=e(C)===e(de).id?"desmarcar":"seleccionar")!=null?Ce:""}`)}),I("click",ce,()=>$t(e(de).id)),E(_e,ce)}),s(X);var ae=c(X,2);{var pe=_e=>{var de=jr(),ce=c(r(de),2),Ae=r(ce,!0);s(ce),s(de),Y(Se=>T(Ae,Se),[()=>{var Se;return(Se=O.find(ie=>ie.id===e(C)))==null?void 0:Se.name}],He),E(_e,de)},xe=_e=>{var de=Pr();E(_e,de)};U(ae,_e=>{e(C)!==null?_e(pe):_e(xe,!1)})}s(G);var qe=c(G,2);oa(qe,5,()=>[...e(g)].sort((_e,de)=>_e.name.localeCompare(de.name)),_e=>_e.id||_e.name,(_e,de)=>{var ce=Hr();const Ae=He(()=>Tt(e(de).name));var Se=r(ce),ie=r(Se,!0);s(Se);var te=c(Se,2);{var we=ue=>{var Ce=Gr();Y(()=>{var be;return Xa(Ce,`background-color: ${(be=e(Ae).color)!=null?be:""}`)}),E(ue,Ce)};U(te,ue=>{e(Ae)&&ue(we)})}s(ce),Y((ue,Ce)=>{var be,De;ca(ce,1,`coverage-item ${ue!=null?ue:""} ${(be=!e(C)&&e(Ae)?"has-color":"")!=null?be:""} ${(De=e(C)?"":"disabled")!=null?De:""}`),Xa(ce,e(Ae)?`border-color: ${e(Ae).color}; background-color: ${e(Ae).bgColor}`:""),Fa(ce,"title",Ce),T(ie,e(de).name)},[()=>e(C)&&e(y)[e(C)].includes(e(de).name)?"selected":"",()=>{var ue;return e(C)?"Clic para agregar/quitar del grupo "+((ue=O.find(Ce=>Ce.id===e(C)))==null?void 0:ue.name):e(Ae)?`Este rol está en ${e(Ae).name}`:"Selecciona un color primero"}],He),I("click",ce,()=>{e(C)&&Yt(e(de).name)}),E(_e,ce)}),s(qe);var le=c(qe,2),he=r(le),ye=c(r(he),2),Ee=c(r(ye),3),Ie=r(Ee);Ma(4),s(Ee),s(ye),s(he),s(le),s(w),Y(_e=>T(Ie,`${_e!=null?_e:""} `),[()=>e(B).length>0?`${e(B).length} roles: ${e(B).join(", ")}`:"Ningún rol seleccionado"],He),E(p,w)};U(Xe,p=>{e(g).length>0&&p(ba)})}s($e),s(Ot),s(ht);var Sa=c(ht,2);{var ua=p=>{var w=Yr(),G=r(w),X=r(G),ae=r(X),pe=c(r(ae));{var xe=Ue=>{var $a=Jr(),Rt=r($a,!0);s($a),Y(()=>T(Rt,e(g)[e(P)].name)),E(Ue,$a)};U(pe,Ue=>{e(P)>=0&&e(P)<e(g).length&&Ue(xe)})}s(ae);var qe=c(ae,2);s(X);var le=c(X,2),he=r(le),ye=c(r(he),2);qo(ye),s(he);var Ee=c(he,2),Ie=r(Ee),_e=c(r(Ie),2),de=r(_e),ce=c(de,2),Ae=r(ce,!0);s(ce);var Se=c(ce,2);s(_e),s(Ie);var ie=c(Ie,2),te=c(r(ie),2),we=r(te),ue=c(we,2),Ce=r(ue,!0);s(ue);var be=c(ue,2);s(te),s(ie),s(Ee);var De=c(Ee,2),na=c(r(De),2),Ze=r(na),Ca=c(Ze,2),it=r(Ca,!0);s(Ca);var lt=c(Ca,2);s(na),Ma(2),s(De);var Pa=c(De,2);{var Ct=Ue=>{var $a=Ur(),Rt=r($a,!0);s($a),Y(()=>T(Rt,e(ne))),E(Ue,$a)};U(Pa,Ue=>{e(ne)&&Ue(Ct)})}s(le);var xt=c(le,2),ct=r(xt),Ga=c(ct,2);s(xt),s(G),s(w),Y(()=>{T(Ae,e(q).min),T(Ce,e(q).max),Ze.disabled=e(q).priority<=1,T(it,e(q).priority),lt.disabled=e(q).priority>=2}),I("click",qe,ha),Oo(ye,()=>e(q).name,Ue=>la(q,e(q).name=Ue)),I("click",de,()=>{e(q).min>1&&la(q,e(q).min--),e(q).min>e(q).max&&la(q,e(q).max=e(q).min)}),I("click",Se,()=>{la(q,e(q).min++),e(q).min>e(q).max&&la(q,e(q).max=e(q).min)}),I("click",we,()=>{e(q).max>e(q).min&&la(q,e(q).max--)}),I("click",be,()=>{la(q,e(q).max++)}),I("click",Ze,()=>{e(q).priority>1&&la(q,e(q).priority--)}),I("click",lt,()=>{e(q).priority<2&&la(q,e(q).priority++)}),I("click",ct,ha),I("click",Ga,Vt),I("click",G,jt(function(Ue){Pt.call(this,o,Ue)})),I("click",w,ha),E(p,w)};U(Sa,p=>{e(H)&&p(ua)})}var ya=c(Sa,2);{var va=p=>{var w=Xr(),G=r(w),X=r(G),ae=r(X),pe=c(r(ae));{var xe=ie=>{var te=Vr(),we=r(te);s(te),Y(()=>{var ue;return T(we,`para ${(ue=e(g)[e(V)].name)!=null?ue:""}`)}),E(ie,te)};U(pe,ie=>{e(V)>=0&&e(V)<e(g).length&&ie(xe)})}s(ae);var qe=c(ae,2);s(X);var le=c(X,2),he=r(le),ye=r(he),Ee=c(r(ye),2),Ie=r(Ee),_e=c(Ie,2);s(Ee),s(ye);var de=c(ye,4);oa(de,5,()=>Object.entries(e(me)),wa,(ie,te)=>{let we=()=>e(te)[0],ue=()=>e(te)[1];var Ce=Kr(),be=r(Ce),De=r(be,!0);s(be);var na=c(be,2),Ze=r(na,!0);s(na),s(Ce),Y(()=>{var Ca;ca(Ce,1,`day-item ${(Ca=ue()?"day-excluded":"")!=null?Ca:""}`),T(De,Le[we()]),T(Ze,ue()?"No requerido":"Requerido")}),I("click",Ce,()=>It(we())),E(ie,Ce)}),s(de),s(he),s(le);var ce=c(le,2),Ae=r(ce),Se=c(Ae,2);s(ce),s(G),s(w),I("click",qe,Ja),I("click",Ie,()=>at(!0)),I("click",_e,()=>at(!1)),I("click",Ae,Ja),I("click",Se,Kt),I("click",G,jt(function(ie){Pt.call(this,o,ie)})),I("click",w,Ja),E(p,w)};U(ya,p=>{e(Z)&&p(va)})}var Qe=c(ya,2);{var Je=p=>{var w=en(),G=r(w),X=r(G),ae=r(X),pe=c(r(ae));{var xe=Se=>{var ie=Qr(),te=r(ie);s(ie),Y(()=>{var we;return T(te,`para ${(we=e(g)[e(M)].name)!=null?we:""}`)}),E(Se,ie)};U(pe,Se=>{e(M)>=0&&e(M)<e(g).length&&Se(xe)})}s(ae);var qe=c(ae,2);s(X);var le=c(X,2),he=r(le),ye=c(r(he),4);oa(ye,5,()=>Object.entries(e(ee)),wa,(Se,ie)=>{let te=()=>e(ie)[0],we=()=>e(ie)[1];var ue=Zr(),Ce=r(ue),be=r(Ce,!0);s(Ce);var De=c(Ce,2),na=r(De),Ze=r(na),Ca=c(Ze,2),it=r(Ca,!0);s(Ca);var lt=c(Ca,2);s(na),s(De),s(ue),Y(()=>{var Pa;T(be,Le[te()]),Ze.disabled=we()<=(((Pa=e(g)[e(M)])==null?void 0:Pa.min)||1),T(it,we())}),I("click",Ze,()=>mt(te())),I("click",lt,()=>Za(te())),E(Se,ue)}),s(ye);var Ee=c(ye,2),Ie=r(Ee),_e=r(Ie);s(Ie),s(Ee),s(he),s(le);var de=c(le,2),ce=r(de),Ae=c(ce,2);s(de),s(G),s(w),Y(()=>{var Se;return T(_e,`Nota: El máximo global para este rol es ${((Se=e(g)[e(M)])==null?void 0:Se.max)||1}, 
              pero puede configurar un máximo diferente para cada día de la semana.`)}),I("click",qe,La),I("click",ce,La),I("click",Ae,et),I("click",G,jt(function(Se){Pt.call(this,o,Se)})),I("click",w,La),E(p,w)};U(Qe,p=>{e(N)&&p(Je)})}Y(()=>{ca(rt,1,e(l)?"input-error":""),T(zt,e(h)),T(W,e(_))}),Oo(rt,()=>e(v),p=>f(v,p)),I("click",_t,Ht),I("click",eo,Gt),I("click",m,Jt),I("click",F,Wt),I("submit",ot,hs(Ut)),E(u,tt),no()}var on=D('<div class="error-message"> </div>'),sn=D('<button type="button" class="cancel-button">Cancelar</button>'),rn=D('<span class="availability-status limited">Disponibilidad limitada</span>'),nn=D('<span class="availability-status full">Disponible todos los días</span>'),ln=D('<tr><td><div class="collaborator-name-cell"> </div></td><td><div class="certifications-cell-simple"><span class="certifications-count-simple"> </span></div></td><td><div class="availability-cell"><!></div></td><td><div class="action-buttons"><button class="icon-button edit" title="Editar colaborador">✏️</button> <button class="icon-button calendar" title="Configurar disponibilidad">📅</button> <button class="icon-button stats" title="Ver estadísticas">📊</button> <button class="icon-button delete" title="Eliminar colaborador">🗑️</button></div></td></tr>'),cn=D('<div class="collaborators-header"><h3>Colaboradores Registrados</h3></div> <div class="collaborators-list"><div class="table-container"><table><thead><tr><th>Nombre</th><th>Certificaciones</th><th>Disponibilidad</th><th>Acciones</th></tr></thead><tbody></tbody></table></div></div>',1),dn=D('<p class="no-data">No hay colaboradores registrados</p>'),un=D('<span class="selected-indicator">✓</span>'),vn=D('<div><span class="certification-name"> </span> <!></div>'),fn=D('<div class="certifications-list"><div class="certifications-controls"><button type="button" class="control-button select-all-btn" title="Seleccionar todas las certificaciones"><span class="control-icon">✅</span> <span class="control-text">Seleccionar Todas</span></button> <button type="button" class="control-button clear-all-btn" title="Deseleccionar todas las certificaciones"><span class="control-icon">❌</span> <span class="control-text">Deseleccionar Todas</span></button> <div class="selection-counter"><span class="counter-text"> </span> <div class="progress-bar-mini"><div class="progress-fill-mini"></div></div></div></div> <div class="certification-items"></div> <div class="certification-info"><p class="help-text">Selecciona las certificaciones que posee el colaborador <br> Certificaciones seleccionadas: <strong> </strong></p></div></div>'),gn=D('<p class="no-data">No hay certificaciones disponibles. Agregue roles primero en la sección de Gestión de Roles</p>'),mn=D('<span class="modal-subtitle"> </span>'),pn=D('<div><div class="day-name"> </div> <div class="day-status"> </div></div>'),hn=D('<div class="modal-backdrop"><div class="modal-content"><div class="modal-header"><h3>Configurar disponibilidad <!></h3> <button class="modal-close">×</button></div> <div class="modal-body"><div class="days-section"><div class="days-header"><h4>Días en que NO está disponible</h4> <div class="days-actions"><button class="days-action-button select-all">Inhabilitar todos</button> <button class="days-action-button clear-all">Habilitar todos</button></div></div> <p class="modal-description">Selecciona los días en que este colaborador NO está disponible:</p> <div class="days-grid"></div></div></div> <div class="modal-footer"><button class="cancel-button">Cancelar</button> <button class="action-button collaborators-button">Guardar Cambios</button></div></div></div>'),bn=D('<div class="frequency-item"><span class="role-name"> </span> <div class="frequency-bar"><div class="frequency-fill"></div> <span class="frequency-count"> </span></div></div>'),yn=D('<div class="stats-section"><h4>Frecuencia por Rol</h4> <div class="roles-frequency"></div></div>'),_n=D('<div class="carousel-controls"><button class="carousel-btn prev-btn" title="Rotación anterior"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button> <span class="carousel-indicator"> </span> <button class="carousel-btn next-btn" title="Siguiente rotación"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div>'),wn=D('<div class="assignment-badge"> </div>'),Sn=D('<div class="day-assignments"></div>'),Cn=D('<div class="no-assignment">-</div>'),xn=D("<div><!></div>"),Rn=D('<div class="carousel-item"><div class="rotation-card"><div class="rotation-header"><h5> </h5> <div class="rotation-summary"><span class="total-assignments"> </span> <span class="days-worked"> </span></div></div> <div class="rotation-calendar-container"><div class="rotation-calendar"><div class="calendar-header"><div class="calendar-day-header">Lun</div> <div class="calendar-day-header">Mar</div> <div class="calendar-day-header">Mié</div> <div class="calendar-day-header">Jue</div> <div class="calendar-day-header">Vie</div></div> <div class="calendar-body"></div></div></div></div></div>'),kn=D("<button></button>"),En=D('<div class="carousel-dots"></div>'),An=D('<div class="stats-section"><div class="rotations-header"><h4>Historial de Rotaciones</h4> <!></div> <div class="rotations-carousel"><div class="carousel-container"><div class="carousel-track"></div></div> <!></div></div>'),Dn=D('<div class="no-data">Este colaborador no tiene asignaciones en ninguna rotación registrada.</div>'),Mn=D('<div class="modal-backdrop"><div class="modal-content stats-modal"><div class="modal-header"><h3> </h3> <button class="modal-close">×</button></div> <div class="modal-body"><div class="stats-summary"><div class="summary-cards"><div class="summary-card"><div class="card-value"> </div> <div class="card-label">Total Asignaciones</div></div> <div class="summary-card"><div class="card-value"> </div> <div class="card-label">Rotaciones</div></div> <div class="summary-card"><div class="card-value"> </div> <div class="card-label">Roles Diferentes</div></div></div></div> <!> <!></div> <div class="modal-footer"><button class="cancel-button">Cerrar</button></div></div></div>'),$n=D('<section class="section-container collaborators-section"><h2>Gestión de Colaboradores</h2> <div class="content"><form class="collaborator-form"><div class="form-group"><label for="collaboratorName">Nombre del Colaborador:</label> <input id="collaboratorName" type="text" placeholder="Nombre del Colaborador" required></div> <!> <div class="form-actions"><button type="submit" class="action-button collaborators-button"> </button> <!></div></form> <!> <div class="certifications-header"><h3> </h3></div> <!></div> <!> <!></section>');function Tn(u,o){ro(o,!1);let l=K(""),v=K([]),h=K(-1),_=K(""),R=K([]),g=K([]),P=K(!1),ne={monday:!1,tuesday:!1,wednesday:!1,thursday:!1,friday:!1},se=K(!1),B=K(-1),C=K(fe({},ne)),y=K(!1),O=K(null),z=K({rotations:[],totalAssignments:0,rolesFrequency:{},monthlyBreakdown:{}}),Q=K(0);const Z={monday:"Lunes",tuesday:"Martes",wednesday:"Miércoles",thursday:"Jueves",friday:"Viernes"};let V=null,me=null,N=null;io(()=>L(this,null,function*(){try{console.log("🚀 Inicializando CollaboratorsManagement..."),yield Re.init(),console.log("✅ Servicio de base de datos inicializado"),yield M(),V=Re.subscribe("roles",sa),me=Re.subscribe("collaborators",ra),N=Re.subscribe("rotations",Ba),console.log("✅ Suscripciones configuradas"),f(P,!0),console.log("✅ CollaboratorsManagement inicializado correctamente")}catch(m){console.error("❌ Error inicializando CollaboratorsManagement:",m),yield H(),f(P,!0)}})),mo(()=>{V&&V(),me&&me(),N&&N(),document.removeEventListener("keydown",ha)});function M(){return L(this,null,function*(){try{const m=yield Re.getAll("collaborators");f(v,m.map(da)),console.log(`✅ ${e(v).length} colaboradores cargados`),yield ee()}catch(m){console.error("❌ Error cargando datos desde servicio:",m),yield H()}})}function ee(){return L(this,null,function*(){try{const m=yield Re.getAll("roles");f(R,m.map($=>$.name)),console.log(`✅ ${e(R).length} certificaciones cargadas`)}catch(m){console.error("❌ Error cargando certificaciones:",m),q()}})}function H(){return L(this,null,function*(){console.log("📁 Usando fallback a localStorage...");try{const m=localStorage.getItem("gestionRotaciones_collaborators");if(m){const $=JSON.parse(m);f(v,$.map(da)),console.log(`📁 ${e(v).length} colaboradores cargados desde localStorage`)}q()}catch(m){console.error("❌ Error en fallback localStorage:",m),f(v,[]),f(R,[])}})}function q(){try{const m=localStorage.getItem("gestionRotaciones_roles");if(m){const $=JSON.parse(m);Array.isArray($)&&$.length>0?f(R,$.map(W=>W&&typeof W=="object"&&W.name?W.name:String(W))):f(R,[])}else f(R,[]);console.log(`📁 ${e(R).length} certificaciones cargadas desde localStorage`)}catch(m){console.error("❌ Error cargando certificaciones desde localStorage:",m),f(R,[])}}function Le(){return L(this,null,function*(){if(e(P))try{yield Re.saveAll("collaborators",e(v)),console.log("✅ Colaboradores guardados correctamente")}catch(m){console.error("❌ Error guardando colaboradores:",m),je()}})}function je(){try{localStorage.setItem("gestionRotaciones_collaborators",JSON.stringify(e(v))),console.log("💾 Colaboradores guardados en localStorage (fallback)")}catch(m){console.error("❌ Error guardando en localStorage:",m)}}function sa(m){(m.action==="save"||m.action==="saveAll")&&(console.log("🔄 Roles actualizados, recargando certificaciones..."),ee()),m.action==="rename"&&m.data&&m.data.oldName&&m.data.newName&&(console.log(`🔄 Rol renombrado de "${m.data.oldName}" a "${m.data.newName}"`),ma(m.data.oldName,m.data.newName)),m.action==="delete"&&m.data&&m.data.roleName&&(console.log(`🔄 Rol eliminado: "${m.data.roleName}"`),pa(m.data.roleName))}function ra(m){m.action==="saveAll"&&m.data&&e(P)&&console.log("🔄 Colaboradores actualizados externamente")}function Ba(m){e(y)&&e(O)&&(console.log("🔄 Rotaciones actualizadas, recargando estadísticas..."),Ja(e(O)))}function ma(m,$){return L(this,null,function*(){try{console.log(`🔄 Actualizando certificaciones: ${m} → ${$}`);let W=!1,F=0;const J=e(v).map(ve=>{if(ve.certifications&&ve.certifications.includes(m)){const $e=ve.certifications.map(Te=>Te===m?$:Te);return W=!0,F++,console.log(`✅ Actualizada certificación para ${ve.name}`),Da(fe({},ve),{certifications:$e})}return ve});W&&(f(v,J),yield Le(),Me(`Certificaciones actualizadas: ${m} → ${$} (${F} colaboradores)`,!0))}catch(W){console.error("❌ Error actualizando certificaciones:",W),Me("Error al actualizar certificaciones",!1)}})}function pa(m){return L(this,null,function*(){try{console.log(`🔄 Eliminando certificación: ${m}`);let $=!1,W=0;const F=e(v).map(J=>{if(J.certifications&&J.certifications.includes(m)){const ve=J.certifications.filter($e=>$e!==m);return $=!0,W++,console.log(`✅ Eliminada certificación "${m}" de ${J.name}`),Da(fe({},J),{certifications:ve})}return J});$&&(f(v,F),yield Le(),Me(`Certificación "${m}" eliminada de ${W} colaboradores`,!0))}catch($){console.error("❌ Error eliminando certificación:",$),Me("Error al eliminar certificación",!1)}})}let Ye="",Ge=null;function Me(m,$=!0){Ye=m,Ge&&clearTimeout(Ge),Ge=setTimeout(()=>{},5e3)}function da(m){return Da(fe({},m),{certifications:Array.isArray(m.certifications)?m.certifications:m.certifications?[m.certifications]:[],unavailableDays:m.unavailableDays||fe({},ne)})}function Oa(m){return m.trim().length<3?"El nombre debe tener al menos 3 caracteres":null}function ka(){f(_,"");const m=Oa(e(l));if(m){f(_,m);return}const $=e(l).trim();if(e(v).find((J,ve)=>J.name.toLowerCase()===$.toLowerCase()&&ve!==e(h))){f(_,"Ya existe un colaborador con este nombre");return}let F={name:$,certifications:[...e(g)],unavailableDays:fe({},ne)};if(e(h)===-1)f(v,[...e(v),F]),Me(`Colaborador "${$}" agregado exitosamente`,!0);else{const J=[...e(v)],ve=J[e(h)];F.unavailableDays=ve.unavailableDays||fe({},ne),J[e(h)]=F,f(v,J),f(h,-1),Me(`Colaborador "${$}" actualizado exitosamente`,!0)}Ve()}function Ve(){f(l,""),f(g,[])}function Gt(m){const $=e(v)[m];f(l,$.name),f(g,Array.isArray($.certifications)?[...$.certifications]:[]),f(h,m)}function Ht(m){const $=e(v)[m].name;f(v,e(v).filter((W,F)=>F!==m)),e(h)===m&&(Ve(),f(h,-1)),Me(`Colaborador "${$}" eliminado`,!0)}function Wt(m){e(g).includes(m)?f(g,e(g).filter($=>$!==m)):f(g,[...e(g),m])}function Jt(){f(g,[...e(R)]),console.log(`✅ ${e(g).length} certificaciones seleccionadas`)}function Ut(){f(g,[]),console.log("❌ Todas las certificaciones deseleccionadas")}function Mt(m){const $=e(v)[m];f(C,fe({},$.unavailableDays||ne)),f(B,m),f(se,!0)}function Na(){f(se,!1),f(B,-1),f(C,fe({},ne))}function $t(m){f(C,Da(fe({},e(C)),{[m]:!e(C)[m]}))}function Yt(){if(e(B)>=0&&e(B)<e(v).length){const m=[...e(v)];m[e(B)].unavailableDays=fe({},e(C)),f(v,m),Na(),Me(`Disponibilidad actualizada para ${e(v)[e(B)].name}`,!0)}}function Tt(m=!0){const $={};Object.keys(e(C)).forEach(W=>{$[W]=m}),f(C,$)}function Qa(m){m==="next"&&e(Q)<e(z).rotations.length-1?os(Q):m==="prev"&&e(Q)>0&&os(Q,-1),console.log(`🎠 Navegando a rotación ${e(Q)+1} de ${e(z).rotations.length}`)}function ft(m){m>=0&&m<e(z).rotations.length&&(f(Q,m),console.log(`🎯 Saltando a rotación ${m+1}`))}function ha(m){if(!(!e(y)||e(z).rotations.length<=1))switch(m.key){case"ArrowLeft":m.preventDefault(),Qa("prev");break;case"ArrowRight":m.preventDefault(),Qa("next");break;case"Home":m.preventDefault(),ft(0);break;case"End":m.preventDefault(),ft(e(z).rotations.length-1);break}}function Vt(m){return L(this,null,function*(){f(O,m),f(y,!0),f(Q,0),yield Ja(m),document.addEventListener("keydown",ha)})}function gt(){f(y,!1),f(O,null),f(Q,0),f(z,{rotations:[],totalAssignments:0,rolesFrequency:{},monthlyBreakdown:{}}),document.removeEventListener("keydown",ha)}function Ja(m){return L(this,null,function*(){try{const $=yield Re.getAll("rotations"),W={rotations:[],totalAssignments:0,rolesFrequency:{},monthlyBreakdown:{}};$.forEach(F=>{const J=It(F,m.name);if(J.totalAssignments>0){W.rotations.push(J),W.totalAssignments+=J.totalAssignments,Object.entries(J.rolesFrequency).forEach(([$e,Te])=>{W.rolesFrequency[$e]=(W.rolesFrequency[$e]||0)+Te});const ve=`${F.year}-${F.month.toString().padStart(2,"0")}`;W.monthlyBreakdown[ve]=J.totalAssignments}}),W.rotations.sort((F,J)=>{const ve=new Date(F.year,F.month-1);return new Date(J.year,J.month-1)-ve}),f(z,W),console.log(`📊 Estadísticas cargadas para ${m.name}:`,W)}catch($){console.error("❌ Error cargando estadísticas:",$);const W=localStorage.getItem("gestionRotaciones_currentRotation");if(W)try{const F=JSON.parse(W),J=It(F,m.name);J.totalAssignments>0&&f(z,{rotations:[J],totalAssignments:J.totalAssignments,rolesFrequency:J.rolesFrequency,monthlyBreakdown:{[`${F.year}-${F.month.toString().padStart(2,"0")}`]:J.totalAssignments}})}catch(F){console.error("❌ Error procesando rotación de localStorage:",F)}}})}function It(m,$){const W=["monday","tuesday","wednesday","thursday","friday"],F=["Lunes","Martes","Miércoles","Jueves","Viernes"],J={year:m.year,month:m.month,monthName:new Date(m.year,m.month-1).toLocaleString("es-ES",{month:"long"}),assignments:{},totalAssignments:0,rolesFrequency:{},daysWorked:0};return W.forEach((ve,$e)=>{J.assignments[ve]={dayName:F[$e],roles:[]}}),m.assignments&&W.forEach(ve=>{const $e=m.assignments[ve]||{};let Te=!1;Object.entries($e).forEach(([ke,We])=>{Array.isArray(We)&&We.includes($)&&(J.assignments[ve].roles.push(ke),J.totalAssignments++,J.rolesFrequency[ke]=(J.rolesFrequency[ke]||0)+1,Te=!0)}),Te&&J.daysWorked++}),J}function Kt(m,$){return`${new Date(m,$-1).toLocaleString("es-ES",{month:"long"})} ${m}`}function Xt(m){if(!m)return"Disponible todos los días";const $=Object.entries(m).filter(([W,F])=>F).map(([W,F])=>Z[W]);return $.length>0?`No disponible: ${$.join(", ")}`:"Disponible todos los días"}function La(m){return m.unavailableDays?Object.values(m.unavailableDays).some($=>$):!1}Wa(()=>(e(P),e(v)),()=>{e(P)&&e(v)&&Le()}),Wa(()=>(e(Q),e(z)),()=>{e(Q)>=e(z).rotations.length&&e(z).rotations.length>0&&f(Q,e(z).rotations.length-1)}),Wa(()=>(e(y),e(z),e(Q)),()=>{e(y)&&e(z).rotations.length>0&&console.log(`📊 Mostrando rotación ${e(Q)+1} de ${e(z).rotations.length}`)}),Lo(),so();var Za=$n(),mt=c(r(Za),2),et=r(mt),at=r(et),ja=c(r(at),2);qo(ja),s(at);var pt=c(at,2);{var Qt=m=>{var $=on(),W=r($,!0);s($),Y(()=>T(W,e(_))),E(m,$)};U(pt,m=>{e(_)&&m(Qt)})}var qt=c(pt,2),tt=r(qt),ht=r(tt,!0);s(tt);var Ot=c(tt,2);{var ot=m=>{var $=sn();I("click",$,()=>{Ve(),f(h,-1)}),E(m,$)};U(Ot,m=>{e(h)!==-1&&m(ot)})}s(qt),s(et);var st=c(et,2);{var rt=m=>{var $=cn(),W=c(Dt($),2),F=r(W),J=r(F),ve=c(r(J));oa(ve,5,()=>e(v),wa,($e,Te,ke)=>{var We=ln(),Xe=r(We),ba=r(Xe),Sa=r(ba,!0);s(ba),s(Xe);var ua=c(Xe),ya=r(ua),va=r(ya),Qe=r(va);s(va),s(ya),s(ua);var Je=c(ua),p=r(Je),w=r(p);{var G=ye=>{var Ee=rn();Y(Ie=>Fa(Ee,"title",Ie),[()=>Xt(e(Te).unavailableDays)],He),E(ye,Ee)},X=ye=>{var Ee=nn();E(ye,Ee)};U(w,ye=>{La(e(Te))?ye(G):ye(X,!1)})}s(p),s(Je);var ae=c(Je),pe=r(ae),xe=r(pe),qe=c(xe,2),le=c(qe,2),he=c(le,2);s(pe),s(ae),s(We),Y((ye,Ee)=>{var Ie;ca(We,1,ye),T(Sa,e(Te).name),Fa(va,"title",Ee),T(Qe,`${((Ie=e(Te).certifications)==null?void 0:Ie.length)||0} certificaciones`)},[()=>Cr(La(e(Te))?"partially-unavailable-row":""),()=>{var ye;return((ye=e(Te).certifications)==null?void 0:ye.length)>0?e(Te).certifications.join(", "):"Sin certificaciones"}],He),I("click",xe,()=>Gt(ke)),I("click",qe,()=>Mt(ke)),I("click",le,()=>Vt(e(Te))),I("click",he,()=>Ht(ke)),E($e,We)}),s(ve),s(J),s(F),s(W),E(m,$)},Zt=m=>{var $=dn();E(m,$)};U(st,m=>{e(v).length>0?m(rt):m(Zt,!1)})}var bt=c(st,2),nt=r(bt),yt=r(nt);s(nt),s(bt);var Ea=c(bt,2);{var _t=m=>{var $=fn(),W=r($),F=r(W),J=c(F,2),ve=c(J,2),$e=r(ve),Te=r($e);s($e);var ke=c($e,2),We=r(ke);s(ke),s(ve),s(W);var Xe=c(W,2);oa(Xe,5,()=>e(R),wa,(va,Qe)=>{var Je=vn(),p=r(Je),w=r(p,!0);s(p);var G=c(p,2);{var X=ae=>{var pe=un();E(ae,pe)};U(G,ae=>{e(g).includes(e(Qe))&&ae(X)})}s(Je),Y(ae=>{ca(Je,1,`certification-item ${ae!=null?ae:""}`),T(w,e(Qe))},[()=>e(g).includes(e(Qe))?"selected":""],He),I("click",Je,()=>Wt(e(Qe))),E(va,Je)}),s(Xe);var ba=c(Xe,2),Sa=r(ba),ua=c(r(Sa),3),ya=r(ua,!0);s(ua),s(Sa),s(ba),s($),Y(va=>{var Qe,Je,p;F.disabled=e(g).length===e(R).length,J.disabled=e(g).length===0,T(Te,`${(Qe=e(g).length)!=null?Qe:""} de ${(Je=e(R).length)!=null?Je:""} seleccionadas`),Xa(We,`width: ${(p=e(R).length>0?e(g).length/e(R).length*100:0)!=null?p:""}%`),T(ya,va)},[()=>e(g).length>0?e(g).join(", "):"Ninguna"],He),I("click",F,Jt),I("click",J,Ut),E(m,$)},wt=m=>{var $=gn();E(m,$)};U(Ea,m=>{e(R).length>0?m(_t):m(wt,!1)})}s(mt);var zt=c(mt,2);{var eo=m=>{var $=hn(),W=r($),F=r(W),J=r(F),ve=c(r(J));{var $e=p=>{var w=mn(),G=r(w);s(w),Y(()=>{var X;return T(G,`para ${(X=e(v)[e(B)].name)!=null?X:""}`)}),E(p,w)};U(ve,p=>{e(B)>=0&&e(B)<e(v).length&&p($e)})}s(J);var Te=c(J,2);s(F);var ke=c(F,2),We=r(ke),Xe=r(We),ba=c(r(Xe),2),Sa=r(ba),ua=c(Sa,2);s(ba),s(Xe);var ya=c(Xe,4);oa(ya,5,()=>Object.entries(e(C)),wa,(p,w)=>{let G=()=>e(w)[0],X=()=>e(w)[1];var ae=pn(),pe=r(ae),xe=r(pe,!0);s(pe);var qe=c(pe,2),le=r(qe,!0);s(qe),s(ae),Y(()=>{var he;ca(ae,1,`day-item ${(he=X()?"day-unavailable":"")!=null?he:""}`),T(xe,Z[G()]),T(le,X()?"No disponible":"Disponible")}),I("click",ae,()=>$t(G())),E(p,ae)}),s(ya),s(We),s(ke);var va=c(ke,2),Qe=r(va),Je=c(Qe,2);s(va),s(W),s($),I("click",Te,Na),I("click",Sa,()=>Tt(!0)),I("click",ua,()=>Tt(!1)),I("click",Qe,Na),I("click",Je,Yt),I("click",W,jt(function(p){Pt.call(this,o,p)})),I("click",$,Na),E(m,$)};U(zt,m=>{e(se)&&m(eo)})}var Ft=c(zt,2);{var St=m=>{var $=Mn(),W=r($),F=r(W),J=r(F),ve=r(J);s(J);var $e=c(J,2);s(F);var Te=c(F,2),ke=r(Te),We=r(ke),Xe=r(We),ba=r(Xe),Sa=r(ba,!0);s(ba),Ma(2),s(Xe);var ua=c(Xe,2),ya=r(ua),va=r(ya,!0);s(ya),Ma(2),s(ua);var Qe=c(ua,2),Je=r(Qe),p=r(Je,!0);s(Je),Ma(2),s(Qe),s(We),s(ke);var w=c(ke,2);{var G=le=>{var he=yn(),ye=c(r(he),2);oa(ye,5,()=>Object.entries(e(z).rolesFrequency).sort((Ee,Ie)=>Ie[1]-Ee[1]),wa,(Ee,Ie)=>{let _e=()=>e(Ie)[0],de=()=>e(Ie)[1];var ce=bn(),Ae=r(ce),Se=r(Ae,!0);s(Ae);var ie=c(Ae,2),te=r(ie),we=c(te,2),ue=r(we,!0);s(we),s(ie),s(ce),Y(()=>{T(Se,_e()),Xa(te,`width: ${de()/e(z).totalAssignments*100}%`),T(ue,de())}),E(Ee,ce)}),s(ye),s(he),E(le,he)};U(w,le=>{Object.keys(e(z).rolesFrequency).length>0&&le(G)})}var X=c(w,2);{var ae=le=>{var he=An(),ye=r(he),Ee=c(r(ye),2);{var Ie=ie=>{var te=_n(),we=r(te),ue=c(we,2),Ce=r(ue);s(ue);var be=c(ue,2);s(te),Y(()=>{var De;we.disabled=e(Q)===0,T(Ce,`${e(Q)+1} de ${(De=e(z).rotations.length)!=null?De:""}`),be.disabled=e(Q)===e(z).rotations.length-1}),I("click",we,()=>Qa("prev")),I("click",be,()=>Qa("next")),E(ie,te)};U(Ee,ie=>{e(z).rotations.length>1&&ie(Ie)})}s(ye);var _e=c(ye,2),de=r(_e),ce=r(de);oa(ce,5,()=>e(z).rotations,wa,(ie,te)=>{var we=Rn(),ue=r(we),Ce=r(ue),be=r(Ce),De=r(be,!0);s(be);var na=c(be,2),Ze=r(na),Ca=r(Ze);s(Ze);var it=c(Ze,2),lt=r(it);s(it),s(na),s(Ce);var Pa=c(Ce,2),Ct=r(Pa),xt=c(r(Ct),2);oa(xt,4,()=>["monday","tuesday","wednesday","thursday","friday"],wa,(ct,Ga)=>{var Ue=xn(),$a=r(Ue);{var Rt=Ta=>{var kt=Sn();oa(kt,5,()=>e(te).assignments[Ga].roles,wa,(lo,dt)=>{var Et=wn(),po=r(Et,!0);s(Et),Y(co=>{Fa(Et,"title",e(dt)),T(po,co)},[()=>e(dt).length>8?e(dt).substring(0,8)+"...":e(dt)],He),E(lo,Et)}),s(kt),E(Ta,kt)},ao=Ta=>{var kt=Cn();E(Ta,kt)};U($a,Ta=>{e(te).assignments[Ga].roles.length>0?Ta(Rt):Ta(ao,!1)})}s(Ue),Y(()=>{var Ta;return ca(Ue,1,`calendar-day ${(Ta=e(te).assignments[Ga].roles.length>0?"has-assignments":"")!=null?Ta:""}`)}),E(ct,Ue)}),s(xt),s(Ct),s(Pa),s(ue),s(we),Y(ct=>{var Ga,Ue;T(De,ct),T(Ca,`${(Ga=e(te).totalAssignments)!=null?Ga:""} asignaciones`),T(lt,`${(Ue=e(te).daysWorked)!=null?Ue:""} días trabajados`)},[()=>Kt(e(te).year,e(te).month)],He),E(ie,we)}),s(ce),s(de);var Ae=c(de,2);{var Se=ie=>{var te=En();oa(te,5,()=>e(z).rotations,wa,(we,ue,Ce)=>{var be=kn();Fa(be,"title",`Ir a rotación ${Ce+1}`),Y(()=>{var De;return ca(be,1,`dot ${(De=Ce===e(Q)?"active":"")!=null?De:""}`)}),I("click",be,()=>ft(Ce)),E(we,be)}),s(te),E(ie,te)};U(Ae,ie=>{e(z).rotations.length>1&&ie(Se)})}s(_e),s(he),Y(()=>Xa(ce,`transform: translateX(-${e(Q)*100}%)`)),E(le,he)},pe=le=>{var he=Dn();E(le,he)};U(X,le=>{e(z).rotations.length>0?le(ae):le(pe,!1)})}s(Te);var xe=c(Te,2),qe=r(xe);s(xe),s(W),s($),Y(le=>{var he;T(ve,`Estadísticas de ${(he=e(O).name)!=null?he:""}`),T(Sa,e(z).totalAssignments),T(va,e(z).rotations.length),T(p,le)},[()=>Object.keys(e(z).rolesFrequency).length],He),I("click",$e,gt),I("click",qe,gt),I("click",W,jt(function(le){Pt.call(this,o,le)})),I("click",$,gt),E(m,$)};U(Ft,m=>{e(y)&&e(O)&&m(St)})}s(Za),Y(()=>{var m;T(ht,e(h)===-1?"Agregar Colaborador":"Actualizar Colaborador"),T(yt,`Certificaciones Disponibles (${(m=e(R).length)!=null?m:""})`)}),Oo(ja,()=>e(l),m=>f(l,m)),I("submit",et,hs(ka)),E(u,Za),no()}var In=D('<span class="date-range"> </span>'),qn=D('<div class="first-rotation-notice"><span class="notice-icon">🆕</span> <span class="notice-text">Primera rotación - Genere para establecer el calendario</span></div>'),On=D('<div class="rotation-history-info"><span class="history-icon">📅</span> <span class="history-text"> </span></div>'),zn=D('<div class="progress-bar"><div class="progress-fill current-week-progress"></div></div> <span class="progress-text">Progreso de la semana actual</span>',1),Fn=D('<div class="progress-bar"><div class="progress-fill future-week-progress" style="width: 0%"></div></div> <span class="progress-text">Semana futura - Aún no iniciada</span>',1),Bn=D('<div class="progress-bar"><div class="progress-fill past-week-progress" style="width: 100%"></div></div> <span class="progress-text">Semana completada</span>',1),Nn=D('<div class="indicator setup"><span class="indicator-icon">⚙️</span> <span class="indicator-text">Configuración inicial</span></div>'),Ln=D('<div class="indicator has-assignments"><span class="indicator-icon">✅</span> <span class="indicator-text"> </span></div>'),jn=D('<div class="indicator no-assignments"><span class="indicator-icon">⚪</span> <span class="indicator-text">Sin asignaciones</span></div>'),Pn=D('<div> <button class="close-message">×</button></div>'),Gn=D('<span class="loading-step"></span>'),Hn=D('<div class="progress-bar-loading"><div class="progress-fill-loading"></div></div> <span class="progress-percentage"></span>',1),Wn=D('<div class="loading-overlay"><div class="spinner"></div> <div class="loading-info"><p>Generando rotación...</p> <!> <!></div></div>'),Jn=D("<th> </th>"),Un=D('<span class="priority-badge">Prioridad Baja</span>'),Yn=D('<div class="role-excluded"><span class="excluded-icon">🚫</span> <span class="excluded-text">No requerido</span></div>'),Vn=D('<div title="Clic para editar asignaciones"><div class="assignment-content"><span class="assignment-text"> </span></div></div>'),Kn=D('<button class="assignment-button empty" title="Clic para asignar colaboradores"><span class="button-placeholder"><span class="plus-icon">+</span> Asignar</span></button>'),Xn=D('<td class="assignment-cell"><!></td>'),Qn=D('<tr><td class="role-cell"><div class="role-info"><span class="role-name"> </span> <!> <div class="role-requirements"><span class="req-min"> </span> <span class="req-max"> </span></div></div></td><!></tr>'),Zn=D('<tr><td colspan="6" class="no-data"><div class="no-data-content"><span class="no-data-icon">📋</span> <span class="no-data-text">No hay roles configurados</span> <span class="no-data-hint">Por favor, agregue roles primero en la sección de Gestión de Roles</span></div></td></tr>'),ei=D('<div class="status-item"><span class="status-label">Desde:</span> <span class="status-value"> </span></div>'),ai=D('<button class="action-button stats-button" title="Mostrar análisis de días consecutivos"><span class="button-icon">📊</span> <span class="button-text">Análisis</span></button> <button class="action-button analysis-button" title="Análisis completo de calidad de la rotación"><span class="button-icon">🔬</span> <span class="button-text">Análisis Avanzado</span></button>',1),ti=D('<button class="action-button debug-button" title="Mostrar información de depuración en consola"><span class="button-icon">🔍</span> <span class="button-text">Debug</span></button>'),oi=D('<span class="modal-subtitle"> </span>'),si=D('<div class="role-requirements-info"><div class="role-context"><h4>Información del Rol</h4> <div class="context-details"><span class="context-item"><span class="context-label">Rotación:</span> <span class="context-value"> </span></span> <span class="context-item"><span class="context-label">Estado:</span> <span class="context-value"> </span></span></div></div> <div class="requirements-grid"><div class="req-item"><span class="req-label">Mínimo:</span> <span class="req-value"> </span></div> <div class="req-item"><span class="req-label">Máximo:</span> <span class="req-value"> </span></div> <div class="req-item"><span class="req-label">Actual:</span> <span class="req-value current"> </span></div> <div class="req-item"><span class="req-label">Faltantes:</span> <span class="req-value needed"> </span></div></div></div>'),ri=D('<div class="assigned-collaborator"><span class="collaborator-name"> </span> <button class="remove-button" title="Quitar de la asignación"><span class="remove-icon">×</span></button></div>'),ni=D('<div class="currently-assigned"><h4><span class="section-icon">✅</span> </h4> <div class="assigned-list"></div></div>'),ii=D('<div class="availability-warning"><span class="warning-icon">⚠️</span> <span class="warning-text">Disponibilidad limitada</span></div>'),li=D('<div class="assigned-indicator"><span class="assigned-icon">✓</span> <span class="assigned-text">Asignado</span></div>'),ci=D('<div><div class="collaborator-info"><div class="collaborator-name"> </div> <div class="collaborator-certifications"><span class="cert-count"> </span> <span class="cert-label">certificaciones</span></div> <!> <!></div></div>'),di=D('<div class="collaborators-list"><h4><span class="section-icon">👤</span> </h4> <div class="collaborators-grid"></div></div>'),ui=D(`<div class="no-data"><div class="no-data-content"><span class="no-data-icon">😔</span> <span class="no-data-text">No hay colaboradores disponibles</span> <span class="no-data-hint">No hay colaboradores que puedan cubrir este rol en este día.
                  Verifique las certificaciones y disponibilidad.</span></div></div>`),vi=D('<div class="modal-backdrop"><div class="modal-content"><div class="modal-header"><h3><span class="modal-icon">👥</span> Asignar Colaborador <!></h3> <button class="modal-close">×</button></div> <div class="modal-body"><!> <!> <!></div> <div class="modal-footer"><div class="modal-info"><span class="info-text"><!></span></div> <div class="modal-actions"><button class="cancel-button"><span class="button-icon">❌</span> <span class="button-text">Cerrar</span></button></div></div></div></div>'),fi=D('<section class="section-container rotation-section"><h2>Gestión de Rotación</h2> <div class="content"><div><div class="rotation-navigation"><button class="nav-button" title="Rotación anterior"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button> <div class="rotation-title-container"><h3 class="rotation-title desktop-title"> </h3> <h3 class="rotation-title mobile-title"> </h3> <div class="rotation-info"><div class="week-status-container"><span class="week-indicator"> </span> <span> </span></div> <!> <!> <!></div></div> <button class="nav-button" title="Siguiente rotación"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div> <div class="week-progress"><!></div> <div class="rotation-indicators"><!> <!></div></div> <!> <div class="rotation-table-container"><!> <table class="rotation-table"><thead><tr><th class="role-header">Roles</th><!></tr></thead><tbody><!></tbody></table></div> <div class="data-status"><div class="status-grid"><div class="status-item"><span class="status-label">Roles disponibles:</span> <span class="status-value"> </span></div> <div class="status-item"><span class="status-label">Colaboradores:</span> <span class="status-value"> </span></div> <div class="status-item"><span class="status-label">Roles compartidos:</span> <span class="status-value"> </span></div> <div class="status-item"><span class="status-label">Total asignaciones:</span> <span class="status-value"> </span></div> <!></div></div> <div class="rotation-actions"><button class="action-button refresh-button" title="Actualizar datos desde la base de datos"><span class="button-icon">🔄</span> <span class="button-text">Actualizar</span></button> <button class="action-button generate-button"><span class="button-icon"> </span> <span class="button-text"> </span></button> <button class="action-button export-button" title="Descargar calendario de rotación como imagen PNG compacta"><span class="button-icon">📸</span> <span class="button-text">Exportar Imagen</span></button> <button class="action-button clear-button" title="Limpiar todas las asignaciones de esta rotación"><span class="button-icon">🧹</span> <span class="button-text">Limpiar</span></button> <!> <!></div></div> <!></section>');function gi(u,o){ro(o,!1);let l=K([]),v=K([]),h=K([]),_=K(!1),R={blue:[],orange:[],green:[]},g=K({}),P=K(""),ne=K(!0),se=K(!1),B=K(!1),C=K(1),y=K({monday:new Date,friday:new Date}),O=K(null);const z=[{id:"monday",name:"Lunes"},{id:"tuesday",name:"Martes"},{id:"wednesday",name:"Miércoles"},{id:"thursday",name:"Jueves"},{id:"friday",name:"Viernes"}];let Q=K(!1),Z=K(null),V=K(null),me=K([]),N=K([]),M=null,ee=null,H=null;io(()=>L(this,null,function*(){try{console.log("🚀 Inicializando RotationManagement..."),yield Re.init(),console.log("✅ Servicio de base de datos inicializado"),yield q(),yield Ba(),M=Re.subscribe("roles",Gt),ee=Re.subscribe("collaborators",Ht),H=Re.subscribe("coverage",Wt),console.log("✅ Suscripciones configuradas"),f(_,!0),console.log("✅ RotationManagement inicializado correctamente")}catch(a){console.error("❌ Error en inicialización:",a),yield Yt(),yield Le(),$t(),f(_,!0)}})),mo(()=>{M&&M(),ee&&ee(),H&&H()});function q(){return L(this,null,function*(){try{console.log("📖 Cargando datos desde servicio...");const[a,t,n,i]=yield Promise.all([Re.getAll("roles"),Re.getAll("collaborators"),Re.getById("coverage",1),Re.getById("colorGroups",1)]);f(l,a||[]),f(v,(t||[]).map(Na)),f(h,(n==null?void 0:n.roleNames)||[]),R=(i==null?void 0:i.groups)||{blue:[],orange:[],green:[]},console.log(`✅ Datos cargados: ${e(l).length} roles, ${e(v).length} colaboradores`)}catch(a){console.error("❌ Error cargando datos desde servicio:",a),yield Le()}})}function Le(){return L(this,null,function*(){console.log("🔍 Usando fallback a localStorage...");try{const a=localStorage.getItem("gestionRotaciones_roles"),t=localStorage.getItem("gestionRotaciones_collaborators"),n=localStorage.getItem("gestionRotaciones_coverage"),i=localStorage.getItem("gestionRotaciones_colorGroups");f(l,a?JSON.parse(a):[]),f(v,t?JSON.parse(t).map(Na):[]),f(h,n?JSON.parse(n):[]),R=i?JSON.parse(i):{blue:[],orange:[],green:[]},console.log("💾 Datos cargados desde localStorage")}catch(a){console.error("❌ Error en fallback localStorage:",a)}})}function je(){return L(this,null,function*(){if(e(_))try{yield sa(),console.log("✅ Rotación guardada correctamente")}catch(a){console.error("❌ Error guardando rotación:",a)}})}function sa(){return L(this,null,function*(){try{const a={id:`rotation_${e(C)}`,rotationNumber:e(C),year:e(y).monday?e(y).monday.getFullYear():new Date().getFullYear(),month:e(y).monday?e(y).monday.getMonth()+1:new Date().getMonth()+1,weekStartDate:e(y).monday?e(y).monday.toISOString():new Date().toISOString(),weekEndDate:e(y).friday?e(y).friday.toISOString():new Date().toISOString(),assignments:e(g),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{yield Re.save("rotations",a),console.log(`✅ Rotación #${e(C)} guardada en BD`)}catch(i){console.log("⚠️ Error guardando en BD:",i)}const t=`gestionRotaciones_rotation_${e(C)}`;localStorage.setItem(t,JSON.stringify(a)),localStorage.setItem("gestionRotaciones_currentRotation",JSON.stringify(a));const n={firstRotationDate:e(O)?e(O).toISOString():new Date().toISOString(),currentRotation:e(C),totalRotations:e(C),lastUpdated:new Date().toISOString()};localStorage.setItem("gestionRotaciones_config",JSON.stringify(n))}catch(a){console.error("❌ Error guardando rotación:",a)}})}function ra(a){return L(this,null,function*(){try{console.log(`🔍 Cargando rotación #${a}...`);const t={};z.forEach(i=>{t[i.id]={}}),f(g,t);let n=null;try{n=(yield Re.getAll("rotations")).find(d=>d.rotationNumber===a)}catch(i){console.log("⚠️ BD no disponible, buscando en localStorage...")}if(!n){const i=[`gestionRotaciones_rotation_${a}`,"gestionRotaciones_currentRotation"];for(const d of i){const b=localStorage.getItem(d);if(b)try{const k=JSON.parse(b);if(k.rotationNumber===a||a===1){n=k;break}}catch(k){console.log(`❌ Error parseando ${d}:`,k)}}}n&&n.assignments?(f(g,fe({},n.assignments)),console.log(`✅ Asignaciones de rotación #${a} cargadas correctamente`),f(g,e(g))):console.log(`ℹ️ Rotación #${a} no encontrada - iniciando vacía`)}catch(t){console.error("❌ Error cargando rotación:",t),$t()}})}function Ba(){return L(this,null,function*(){try{console.log("🔄 Inicializando sistema de rotaciones...");let a=null;try{const t=localStorage.getItem("gestionRotaciones_config");t&&(a=JSON.parse(t))}catch(t){console.log("⚠️ Error cargando configuración:",t)}if(a&&a.currentRotation){if(f(C,a.currentRotation),a.firstRotationDate){f(O,new Date(a.firstRotationDate));const t=e(C)-1,n=new Date(e(O));n.setDate(n.getDate()+t*7);const i=new Date(n);i.setDate(i.getDate()+4),f(y,{monday:n,friday:i})}}else f(C,1),f(y,Ge()),f(O,null);yield ra(e(C))}catch(a){console.error("❌ Error inicializando sistema:",a),f(C,1),f(y,Ge()),f(O,null)}})}function ma(){try{if(ke()&&je(),f(C,e(C)+1),e(O))f(y,Ye(e(O),e(C)-1));else{const a=new Date(e(y).monday);a.setDate(a.getDate()+7);const t=new Date(e(y).friday);t.setDate(t.getDate()+7),f(y,{monday:a,friday:t})}ra(e(C)),F(`Avanzado a Rotación #${e(C)}`,!0)}catch(a){console.error("Error avanzando rotación:",a),F("Error avanzando rotación",!1)}}function pa(){try{if(e(C)>1){if(ke()&&je(),f(C,e(C)-1),e(O))f(y,Ye(e(O),e(C)-1));else{const a=new Date(e(y).monday);a.setDate(a.getDate()-7);const t=new Date(e(y).friday);t.setDate(t.getDate()-7),f(y,{monday:a,friday:t})}ra(e(C)),F(`Retrocedido a Rotación #${e(C)}`,!0)}}catch(a){console.error("Error retrocediendo rotación:",a),F("Error retrocediendo rotación",!1)}}function Ye(a,t){try{const n=new Date(a);n.setDate(a.getDate()+t*7);const i=new Date(n);return i.setDate(n.getDate()+4),{monday:n,friday:i}}catch(n){return console.error("Error calculando fechas de semana:",n),Ge()}}function Ge(){const a=new Date,t=a.getDay();let n;t===0?n=1:t===1?n=0:n=-(t-1),t===6&&(n=2);const i=new Date(a);i.setDate(a.getDate()+n);const d=new Date(i);return d.setDate(i.getDate()+4),{monday:i,friday:d}}function Me(a){try{if(!a||!(a instanceof Date))return"Fecha no disponible";const t={day:"numeric",month:"long",timeZone:"America/Costa_Rica"};return a.toLocaleDateString("es-ES",t)}catch(t){return console.error("Error formateando fecha:",t),"Fecha inválida"}}function da(a){try{return!a||!(a instanceof Date)?"??":a.getDate()}catch(t){return"??"}}function Oa(){try{if(!e(y).monday||!e(y).friday)return`Rotación #${e(C)}`;const a=e(y).monday.toLocaleString("es-ES",{month:"long"}),t=e(y).monday.getFullYear(),n=Me(e(y).monday),i=Me(e(y).friday);return`Rotación #${e(C)} / ${a} / ${n} - ${i} / ${t}`}catch(a){return`Rotación #${e(C)}`}}function ka(){try{if(!e(y).monday||!e(y).friday)return`Rot. #${e(C)}`;const a=e(y).monday.toLocaleString("es-ES",{month:"short"}),t=e(y).monday.getFullYear(),n=da(e(y).monday),i=da(e(y).friday);return`Rot. #${e(C)} / ${a} / ${n}-${i} / ${t}`}catch(a){return`Rot. #${e(C)}`}}function Ve(){try{const a=new Date,t=e(y).monday,n=e(y).friday;if(!t||!n)return{isCurrentWeek:!1,isFutureWeek:!0,isPastWeek:!1,statusText:"Calculando..."};const i=t<=a&&a<=n,d=t>a,b=n<a;return{isCurrentWeek:i,isFutureWeek:d,isPastWeek:b,statusText:i?"Semana Actual":d?"Semana Futura":"Semana Pasada"}}catch(a){return{isCurrentWeek:!1,isFutureWeek:!0,isPastWeek:!1,statusText:"Estado desconocido"}}}function Gt(a){(a.action==="save"||a.action==="saveAll")&&Jt()}function Ht(a){(a.action==="save"||a.action==="saveAll")&&Ut()}function Wt(a){a.action==="save"&&Mt()}function Jt(){return L(this,null,function*(){try{const a=yield Re.getAll("roles");f(l,a||[])}catch(a){console.error("❌ Error recargando roles:",a)}})}function Ut(){return L(this,null,function*(){try{const a=yield Re.getAll("collaborators");f(v,(a||[]).map(Na))}catch(a){console.error("❌ Error recargando colaboradores:",a)}})}function Mt(){return L(this,null,function*(){try{const a=yield Re.getById("coverage",1);f(h,(a==null?void 0:a.roleNames)||[])}catch(a){console.error("❌ Error recargando cobertura:",a)}})}function Na(a){return Da(fe({},a),{certifications:Array.isArray(a.certifications)?a.certifications:a.certifications?[a.certifications]:[],unavailableDays:a.unavailableDays||{monday:!1,tuesday:!1,wednesday:!1,thursday:!1,friday:!1}})}function $t(){const a={};z.forEach(t=>{a[t.id]={}}),f(g,a),console.log("📋 Asignaciones inicializadas como vacías")}function Yt(){return L(this,null,function*(){try{f(y,Ge()),f(C,1),f(O,null),console.log("📅 Primera rotación preparada para:",Me(e(y).monday))}catch(a){console.error("Error configurando primera rotación:",a),f(C,1),f(y,{monday:new Date,friday:new Date})}})}function Tt(){const a={};return Object.entries(R).forEach(([t,n])=>{n.length>0&&(a[t]=n.filter(i=>e(l).some(d=>d.name===i)))}),a}function Qa(a){for(const[t,n]of Object.entries(R))if(n.includes(a))return t;return null}function ft(){const a=Object.values(R).flat();return e(l).filter(t=>!a.includes(t.name))}class ha{constructor(){this.collaboratorRoleHistory=new Map,this.weeklyRoleAssignments=new Map,this.weekdays=["monday","tuesday","wednesday","thursday","friday"]}initializeFromExistingAssignments(t){this.weekdays.forEach((n,i)=>{const d=t[n]||{};Object.entries(d).forEach(([b,k])=>{Array.isArray(k)&&k.forEach(S=>{this.recordAssignment(S,b,i)})})})}recordAssignment(t,n,i){this.collaboratorRoleHistory.has(t)||this.collaboratorRoleHistory.set(t,new Map),this.collaboratorRoleHistory.get(t).set(n,i),this.weeklyRoleAssignments.has(t)||this.weeklyRoleAssignments.set(t,new Set),this.weeklyRoleAssignments.get(t).add(n)}wouldCreateConsecutiveDays(t,n,i){const d=this.collaboratorRoleHistory.get(t);if(!d||!d.has(n))return!1;const b=d.get(n);return Math.abs(i-b)===1}hasRoleThisWeek(t,n){const i=this.weeklyRoleAssignments.get(t);return i?i.has(n):!1}getWeeklyRoles(t){return this.weeklyRoleAssignments.get(t)||new Set}getWeeklyDiversityStats(){const t={totalCollaborators:this.weeklyRoleAssignments.size,averageRolesPerCollaborator:0,collaboratorDiversity:new Map,perfectDiversityCount:0};let n=0;for(const[i,d]of this.weeklyRoleAssignments){const b=d.size;n+=b,t.collaboratorDiversity.set(i,{rolesCount:b,roles:Array.from(d)})}return t.averageRolesPerCollaborator=t.totalCollaborators>0?n/t.totalCollaborators:0,t}}function Vt(){return L(this,null,function*(){if(!e(l).length||!e(v).length){F("No hay suficientes datos para generar rotación",!1);return}try{e(O)||(f(O,new Date(e(y).monday)),console.log("✅ Primera rotación establecida:",Me(e(O)))),f(B,!0);const a={};z.forEach(i=>{a[i.id]={},e(l).forEach(b=>{ve(b,i.id)||(a[i.id][b.name]=[])});const d=e(g)[i.id]||{};Object.entries(d).forEach(([b,k])=>{if(Array.isArray(k)&&k.length>0){const S=k.filter(x=>typeof x=="string"&&!x.includes("Faltan")&&!x.includes("Sin")&&!x.includes("Omitido"));S.length>0&&a[i.id][b]&&(a[i.id][b]=[...S])}})});const t=new ha;if(t.initializeFromExistingAssignments(a),yield gt(a,t)){yield at(a),f(g,a),yield je();const i=new ha;i.initializeFromExistingAssignments(a);const d=i.getWeeklyDiversityStats(),b=Qt(a);F(`Rotación #${e(C)} generada exitosamente. Colaboradores sin repetir roles: ${d.perfectDiversityCount}/${d.totalCollaborators}. Colaboradores adicionales: ${b}`,!0)}else F("No se pudo generar una rotación óptima. Intente ajustar la configuración.",!1)}catch(a){console.error("❌ Error generando rotación:",a),F("Error al generar rotación: "+a.message,!1)}finally{setTimeout(()=>{f(B,!1)},500)}})}function gt(a,t){return L(this,null,function*(){let i=null,d={score:1/0};for(let b=1;b<=8;b++){const k=JSON.parse(JSON.stringify(a)),S=new ha;if(S.initializeFromExistingAssignments(k),yield Ja(k,S)){const A=Za(k);if(console.log(`🔄 Intento ${b}: Score=${A.score}, Consecutivos=${A.consecutiveCount}, Repeticiones=${A.roleRepetitionCount}`),A.score<d.score&&(d=A,i=JSON.parse(JSON.stringify(k))),A.consecutiveCount===0&&A.roleRepetitionCount===0){console.log(`🎯 ¡Solución perfecta encontrada en intento ${b}!`);break}}}return i?(Object.assign(a,i),console.log("📊 Resultado final:",d),!0):!1})}function Ja(a,t){return L(this,null,function*(){const n=new Map;z.forEach(i=>{const d=new Set,b=a[i.id]||{};Object.values(b).forEach(k=>{Array.isArray(k)&&k.forEach(S=>d.add(S))}),n.set(i.id,d)});for(let i=0;i<z.length;i++){const d=z[i];if(!(yield It(d.id,i,a,t,n.get(d.id))))return!1}for(let i=0;i<z.length;i++){const d=z[i];if(!(yield Kt(d.id,i,a,t,n.get(d.id))))return!1}return!0})}function It(a,t,n,i,d){return L(this,null,function*(){const b=Tt(),k=e(v).filter(S=>{var x;return!((x=S.unavailableDays)!=null&&x[a])&&!d.has(S.name)});for(const[S,x]of Object.entries(b)){if(x.length===0)continue;const A=x.map(j=>e(l).find(re=>re.name===j)).filter(j=>j&&!ve(j,a));if(A.length===0)continue;const oe=k.filter(j=>d.has(j.name)||!A.every(ze=>{var _a;return(_a=j.certifications)==null?void 0:_a.includes(ze.name)})?!1:!A.some(ze=>i.hasRoleThisWeek(j.name,ze.name))),ge=Math.max(...A.map(j=>{const re=n[a][j.name].length,Be=j.min||1;return Math.max(0,Be-re)}));for(let j=0;j<ge;j++){let re;if(oe.length>0&&(re=La(oe.filter(ze=>!d.has(ze.name)),A[0],i,t)),re||(re=mt(A,k.filter(ze=>!d.has(ze.name)),i,t)),!re)continue;let Be=!1;for(const ze of A){const _a=n[a][ze.name].length,Aa=ze.min||1,ea=$e(ze,a);_a<Aa&&_a<ea&&(n[a][ze.name].push(re.name),i.recordAssignment(re.name,ze.name,t),Be=!0)}if(Be){d.add(re.name);const ze=oe.findIndex(_a=>_a.name===re.name);ze!==-1&&oe.splice(ze,1)}}}return!0})}function Kt(a,t,n,i,d){return L(this,null,function*(){var S;const b=ft().filter(x=>!ve(x,a)),k=e(v).filter(x=>{var A;return!((A=x.unavailableDays)!=null&&A[a])&&!d.has(x.name)});for(const x of b){const A=((S=n[a][x.name])==null?void 0:S.length)||0,oe=x.min||1,ge=Math.max(0,oe-A);for(let j=0;j<ge;j++){const re=yield Xt(x,k.filter(Be=>!d.has(Be.name)),i,t);if(!re)break;n[a][x.name]||(n[a][x.name]=[]),n[a][x.name].push(re.name),d.add(re.name),i.recordAssignment(re.name,x.name,t)}}return!0})}function Xt(a,t,n,i){return L(this,null,function*(){const d=t.filter(b=>{var k;return!(!((k=b.certifications)!=null&&k.includes(a.name))||n.hasRoleThisWeek(b.name,a.name)||n.wouldCreateConsecutiveDays(b.name,a.name,i))});return d.length>0?La(d,a,n,i):(console.log(`⚠️ No hay colaboradores disponibles para ${a.name} sin repetir rol - usando asignación tradicional`),et(a,t,n,i))})}function La(a,t,n,i){if(a.length===0)return null;const d=a.map(b=>{let k=0;const S=n.getWeeklyRoles(b.name);k+=(10-S.size)*50;const x=n.wouldCreateConsecutiveDays(b.name,t.name,i)?1e3:0;k-=x;const A=Math.random()*5;return k+=A,{collaborator:b,score:k,weeklyRolesCount:S.size,wouldBeConsecutive:x>0}});return d.sort((b,k)=>k.score-b.score),d[0].collaborator}function Za(a){let t=0,n=0,i=0;const d=new ha;d.initializeFromExistingAssignments(a),e(v).forEach(S=>{const x=ja(S.name,a);for(let A=0;A<x.length-1;A++){const oe=x[A],ge=x[A+1],j=oe.filter(re=>ge.includes(re));j.length>0&&(n+=j.length,t+=j.length*100)}}),e(v).forEach(S=>{const x=d.getWeeklyRoles(S.name),oe=ja(S.name,a).flat().length,ge=x.size;if(oe>ge){const j=oe-ge;i+=j,t+=j*50}});const b=d.getWeeklyDiversityStats(),k=Math.floor(b.averageRolesPerCollaborator*10);return t-=k,{score:t,consecutiveCount:n,roleRepetitionCount:i,diversityStats:b}}function mt(a,t,n,i){const d=t.filter(S=>a.every(x=>{var A;return(A=S.certifications)==null?void 0:A.includes(x.name)}));if(d.length===0)return null;const b=d.map(S=>{const x=a.reduce((ge,j)=>ge+(n.wouldCreateConsecutiveDays(S.name,j.name,i)?100:0),0)/a.length,A=Math.random()*15,oe=x+A;return{collaborator:S,score:oe,avgConsecutiveCost:x}});b.sort((S,x)=>S.score-x.score);const k=b.filter(S=>S.avgConsecutiveCost===0);if(k.length>0){const S=k.slice(0,Math.min(3,k.length)),x=Math.floor(Math.random()*S.length);return S[x].collaborator}else{const S=b.slice(0,Math.min(2,b.length)),x=Math.floor(Math.random()*S.length);return S[x].collaborator}}function et(a,t,n,i){const d=t.filter(S=>{var x;return(x=S.certifications)==null?void 0:x.includes(a.name)});if(d.length===0)return null;const b=d.map(S=>{const x=n.wouldCreateConsecutiveDays(S.name,a.name,i)?100:0,A=Math.random()*15,oe=x+A;return{collaborator:S,score:oe,consecutiveCost:x}});b.sort((S,x)=>S.score-x.score);const k=b.filter(S=>S.consecutiveCost===0);if(k.length>0){const S=k.slice(0,Math.min(3,k.length)),x=Math.floor(Math.random()*S.length);return S[x].collaborator}else{const S=b.slice(0,Math.min(2,b.length)),x=Math.floor(Math.random()*S.length);return S[x].collaborator}}function at(a){return L(this,null,function*(){for(let t=0;t<z.length;t++){const i=z[t].id,d=e(l).filter(S=>!ve(S,i)),b=new Set;Object.values(a[i]||{}).forEach(S=>{Array.isArray(S)&&S.forEach(x=>b.add(x))});let k=e(v).filter(S=>{var x;return!((x=S.unavailableDays)!=null&&x[i])&&!b.has(S.name)});k=pt(k);for(const S of k){let x=d.filter(A=>{var Be;const oe=(Be=S.certifications)==null?void 0:Be.includes(A.name),ge=(a[i][A.name]||[]).length,j=$e(A,i),re=ge<j;return oe&&re});if(x.length>0){x=pt(x);const A=x[0],oe=Qa(A.name);oe&&!qt(S.name,i,a)?R[oe].map(j=>e(l).find(re=>re.name===j)).filter(j=>{var re;return j&&!ve(j,i)&&((re=S.certifications)==null?void 0:re.includes(j.name))&&(a[i][j.name]||[]).length<$e(j,i)}).forEach(j=>{a[i][j.name]||(a[i][j.name]=[]),a[i][j.name].push(S.name)}):(a[i][A.name]||(a[i][A.name]=[]),a[i][A.name].push(S.name)),b.add(S.name)}}}})}function ja(a,t){const n=new Array(5).fill().map(()=>[]);return z.forEach((i,d)=>{const b=t[i.id]||{};Object.entries(b).forEach(([k,S])=>{Array.isArray(S)&&S.includes(a)&&n[d].push(k)})}),n}function pt(a){const t=[...a];for(let n=t.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[t[n],t[i]]=[t[i],t[n]]}return t}function Qt(a){let t=0;return z.forEach(n=>{const i=a[n.id]||{};e(l).filter(b=>!ve(b,n.id)).forEach(b=>{const k=i[b.name]||[],S=b.min||1,x=Math.max(0,k.length-S);t+=x})}),t}function qt(a,t,n){const i=n[t]||{};for(const[d,b]of Object.entries(i))if(Array.isArray(b)&&b.includes(a))return!0;return!1}function tt(){return L(this,null,function*(){if(!ke()){F("No hay asignaciones para exportar",!1);return}try{f(B,!0);const a=document.createElement("canvas"),t=a.getContext("2d"),n={width:1800,height:Math.max(1e3,e(l).length*90+400),padding:50,colors:{background:"#1a1f35",cardBackground:"rgba(255, 255, 255, 0.05)",headerCard:"rgba(255, 255, 255, 0.08)",text:"#ffffff",textSecondary:"rgba(255, 255, 255, 0.8)",textMuted:"rgba(255, 255, 255, 0.6)",border:"rgba(255, 255, 255, 0.1)",assigned:"rgba(46, 204, 113, 0.3)",assignedBorder:"rgba(46, 204, 113, 0.5)",warning:"rgba(241, 196, 15, 0.3)",warningBorder:"rgba(241, 196, 15, 0.5)",excluded:"rgba(155, 89, 182, 0.2)",excludedBorder:"rgba(155, 89, 182, 0.4)",accent:"#3498db"}},i=window.devicePixelRatio||1;a.width=n.width*i,a.height=n.height*i,a.style.width=n.width+"px",a.style.height=n.height+"px",t.scale(i,i),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",yield ht(t,n),yield Ot(t,n),yield ot(t,n),yield yt(t,n),yield eo(a),F("Rotación exportada con diseño moderno",!0)}catch(a){console.error("❌ Error exportando imagen:",a),F("Error al generar imagen: "+a.message,!1)}finally{setTimeout(()=>{f(B,!1)},1e3)}})}function ht(a,t){return L(this,null,function*(){a.fillStyle=t.colors.background,a.fillRect(0,0,t.width,t.height);const n=a.createRadialGradient(t.width*.8,t.height*.3,0,t.width*.8,t.height*.3,t.width*.7);n.addColorStop(0,"rgba(52, 152, 219, 0.08)"),n.addColorStop(1,"rgba(52, 152, 219, 0)"),a.fillStyle=n,a.fillRect(0,0,t.width,t.height)})}function Ot(a,t){return L(this,null,function*(){const i=t.padding;Ea(a,t.padding,i,t.width-t.padding*2,140,20),a.fillStyle=t.colors.headerCard,a.fill(),a.strokeStyle=t.colors.border,a.lineWidth=1,a.stroke(),a.fillStyle=t.colors.text,a.font='bold 36px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="center",a.textBaseline="middle",a.shadowColor="rgba(0, 0, 0, 0.3)",a.shadowBlur=6,a.shadowOffsetY=2;const d=Oa();a.fillText(d,t.width/2,i+45),a.shadowColor="transparent",a.shadowBlur=0,a.shadowOffsetY=0,a.font='18px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.fillStyle=t.colors.textSecondary;const k=`${Ve().statusText} • ${We()} asignaciones totales`;a.fillText(k,t.width/2,i+85),a.font='14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.fillStyle=t.colors.textMuted;const S=`Generado el ${new Date().toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}`;a.fillText(S,t.width/2,i+110)})}function ot(a,t){return L(this,null,function*(){const n=t.padding+180,i=t.width-t.padding*2,d=300,b=(i-d)/5,k=80,S=60,x=S+e(l).length*k;Ea(a,t.padding,n,i,x,16),a.fillStyle=t.colors.cardBackground,a.fill(),a.strokeStyle=t.colors.border,a.lineWidth=1,a.stroke(),yield st(a,t,n,d,b,S);for(let A=0;A<e(l).length;A++){const oe=e(l)[A],ge=n+S+A*k;yield rt(a,t,oe,ge,d,b,k,A)}})}function st(a,t,n,i,d,b){return L(this,null,function*(){["Roles y Requisitos","Lunes","Martes","Miércoles","Jueves","Viernes"].forEach((S,x)=>{const A=t.padding+(x===0?0:i+(x-1)*d),oe=x===0?i:d;Ea(a,A+5,n+5,oe-10,b-10,12),a.fillStyle=x===0?"rgba(52, 152, 219, 0.1)":"rgba(255, 255, 255, 0.03)",a.fill(),a.strokeStyle=t.colors.border,a.lineWidth=1,a.stroke(),a.fillStyle=t.colors.text,a.font=x===0?'bold 16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif':'bold 15px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="center",a.textBaseline="middle",a.fillText(S,A+oe/2,n+b/2)})})}function rt(a,t,n,i,d,b,k,S){return L(this,null,function*(){const x=t.padding;S%2===1&&(Ea(a,x,i,t.width-t.padding*2,k,0),a.fillStyle="rgba(255, 255, 255, 0.01)",a.fill()),yield Zt(a,t,n,x,i,d);for(let A=0;A<z.length;A++){const oe=z[A].id,ge=x+d+A*b;yield bt(a,t,n,oe,ge,i,b,k)}})}function Zt(a,t,n,i,d,b,k){return L(this,null,function*(){const x=i+15,A=d+15;a.fillStyle=t.colors.text,a.font='bold 18px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="left",a.textBaseline="top";const oe=zt(a,n.name,b-40);a.fillText(oe,x,A);const ge=A+30;let j=x;const re=`Mín: ${n.min||1}`;j+=_t(a,j,ge,re,t.colors.accent,"#ffffff")+10;const Be=`Máx: ${n.max||5}`;_t(a,j,ge,Be,"#2ecc71","#ffffff")})}function bt(a,t,n,i,d,b,k,S){return L(this,null,function*(){const A=d+8,oe=b+8,ge=k-8*2,j=S-8*2;let re="empty",Be=[],ze=0,_a=n.min||1;if(ve(n,i))re="excluded";else if(e(g)&&e(g)[i]&&e(g)[i][n.name]){const Ua=e(g)[i][n.name];if(Array.isArray(Ua)&&Ua.length>0){const ut=Ua.filter(At=>typeof At=="string"&&!At.includes("Faltan")&&!At.includes("Sin"));ut.length>0?(Be=ut,ze=ut.length,re=ze>=_a?"assigned":"warning"):re="warning"}}let Aa,ea,Ne;switch(re){case"assigned":Aa=t.colors.assigned,ea=t.colors.assignedBorder,Ne=t.colors.text;break;case"warning":Aa=t.colors.warning,ea=t.colors.warningBorder,Ne=t.colors.text;break;case"excluded":Aa=t.colors.excluded,ea=t.colors.excludedBorder,Ne=t.colors.textMuted;break;default:Aa="rgba(0, 0, 0, 0.1)",ea="rgba(255, 255, 255, 0.05)",Ne=t.colors.textMuted}Ea(a,A,oe,ge,j,12),a.fillStyle=Aa,a.fill(),re!=="empty"?(a.strokeStyle=ea,a.lineWidth=2,a.stroke()):(a.strokeStyle=ea,a.lineWidth=1,a.setLineDash([3,3]),a.stroke(),a.setLineDash([])),re==="excluded"?(a.fillStyle=Ne,a.font="24px serif",a.textAlign="center",a.textBaseline="middle",a.fillText("🚫",A+ge/2,oe+j/2-8),a.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.fillText("No requerido",A+ge/2,oe+j/2+12)):Be.length>0?(yield nt(a,t,Be,A,oe,ge,j,Ne),ze>0&&wt(a,t,ze,_a,A+ge-25,oe+5)):re==="warning"?(a.fillStyle=Ne,a.font="20px serif",a.textAlign="center",a.textBaseline="middle",a.fillText("⚠️",A+ge/2,oe+j/2-8),a.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.fillText("Sin asignar",A+ge/2,oe+j/2+12)):(a.fillStyle=Ne,a.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="center",a.textBaseline="middle",a.fillText("Disponible",A+ge/2,oe+j/2))})}function nt(a,t,n,i,d,b,k,S){return L(this,null,function*(){const oe=Math.floor((k-16)/16);a.fillStyle=S,a.font='13px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="left",a.textBaseline="top";let ge=d+8,j=0;for(let re=0;re<n.length&&j<oe;re++){let Be=n[re];Be.length>15&&(Be=Be.substring(0,13)+".."),a.fillStyle="rgba(255, 255, 255, 0.6)",a.fillText("•",i+8,ge),a.fillStyle=S,a.fillText(Be,i+8+15,ge),ge+=16,j++}n.length>oe&&(a.fillStyle="rgba(255, 255, 255, 0.7)",a.font='11px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="center",a.fillText(`+${n.length-oe} más`,i+b/2,d+k-12))})}function yt(a,t){return L(this,null,function*(){const n=t.height-80;Ea(a,t.padding,n,t.width-t.padding*2,60,16),a.fillStyle=t.colors.cardBackground,a.fill(),a.strokeStyle=t.colors.border,a.lineWidth=1,a.stroke(),a.fillStyle=t.colors.textSecondary,a.font='14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="center",a.textBaseline="middle",a.fillText("Sistema de Gestión de Rotaciones • Edwards CR",t.width/2,n+25),a.fillStyle=t.colors.textMuted,a.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.fillText("Creado por José Ismael Morales Uriarte",t.width/2,n+45)})}function Ea(a,t,n,i,d,b){a.beginPath(),a.roundRect(t,n,i,d,b)}function _t(a,t,n,i,d,b){a.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif';const A=a.measureText(i).width+10*2;return Ea(a,t,n,A,22,11),a.fillStyle=d,a.fill(),a.fillStyle=b,a.textAlign="center",a.textBaseline="middle",a.fillText(i,t+A/2,n+22/2),A}function wt(a,t,n,i,d,b){const S=n>=i;Ea(a,d,b,24,24,12),a.fillStyle=S?"rgba(46, 204, 113, 0.9)":"rgba(241, 196, 15, 0.9)",a.fill(),a.fillStyle="#ffffff",a.font='bold 12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',a.textAlign="center",a.textBaseline="middle",a.fillText(n.toString(),d+24/2,b+24/2)}function zt(a,t,n){if(a.measureText(t).width<=n)return t;const i="...";let d=t;for(;a.measureText(d+i).width>n&&d.length>0;)d=d.slice(0,-1);return d+i}function eo(a){return L(this,null,function*(){return new Promise(t=>{a.toBlob(n=>{const i=URL.createObjectURL(n),d=document.createElement("a");d.download=`rotacion_${e(C)}_${Ft(e(y).monday)}.png`,d.href=i,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(i),t()},"image/png",.9)})})}function Ft(a){if(!a||!(a instanceof Date))return"fecha_invalida";const t=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0");return`${t}-${n}-${i}`}function St(a,t){if(f(Z,e(l).find(n=>n.name===a)),f(V,z.find(n=>n.id===t)),e(Z)&&e(V)){f(N,[]),e(g)[t]&&e(g)[t][a]&&Array.isArray(e(g)[t][a])&&f(N,[...e(g)[t][a]]);const i=e(v).filter(d=>{var S,x;const b=(S=d.certifications)==null?void 0:S.includes(e(Z).name),k=!((x=d.unavailableDays)!=null&&x[e(V).id]);return b&&k}).sort((d,b)=>{const k=e(N).includes(d.name),S=e(N).includes(b.name);return k!==S?k?1:-1:d.name.localeCompare(b.name)});f(me,i),f(Q,!0)}}function m(){f(Q,!1),f(Z,null),f(V,null),f(me,[]),f(N,[])}function $(a){if(!(!e(Z)||!e(V)))try{let t=fe({},e(g));if(t[e(V).id]||(t[e(V).id]={}),(!t[e(V).id][e(Z).name]||!Array.isArray(t[e(V).id][e(Z).name]))&&(t[e(V).id][e(Z).name]=[]),t[e(V).id][e(Z).name].includes(a))F("El colaborador ya está asignado",!1);else{const n=$e(e(Z),e(V).id);if(t[e(V).id][e(Z).name].filter(d=>typeof d=="string"&&!d.includes("Faltan")).length>=n){F(`No se puede asignar más de ${n} colaboradores a este rol`,!1);return}t[e(V).id][e(Z).name].push(a),f(g,t),f(N,[...t[e(V).id][e(Z).name]]),je(),F("Colaborador asignado correctamente",!0)}}catch(t){F("Error al asignar colaborador: "+t.message,!1)}}function W(a){var t,n;if(!(!e(Z)||!e(V)))try{let i=fe({},e(g));(n=(t=i[e(V).id])==null?void 0:t[e(Z).name])!=null&&n.includes(a)&&(i[e(V).id][e(Z).name]=i[e(V).id][e(Z).name].filter(d=>d!==a),f(g,i),f(N,[...i[e(V).id][e(Z).name]]),je(),F("Colaborador eliminado correctamente",!0))}catch(i){F("Error al quitar colaborador: "+i.message,!1)}}function F(a,t=!0){f(P,a),f(ne,t),f(se,!0),setTimeout(()=>{f(se,!1)},5e3)}function J(a){return a?typeof a=="string"?a:Array.isArray(a)?a.join(", "):String(a):""}function ve(a,t){var n;try{return!a||!t?!1:((n=a==null?void 0:a.excludedDays)==null?void 0:n[t])===!0}catch(i){return!1}}function $e(a,t){try{return a?a.dailyMaxCollabs&&typeof a.dailyMaxCollabs=="object"&&a.dailyMaxCollabs[t]!==void 0?Math.max(1,a.dailyMaxCollabs[t]):Math.max(1,a.max||5):5}catch(n){return 5}}function Te(){if(confirm(`¿Estás seguro de que deseas limpiar la Rotación #${e(C)}? Esta acción no se puede deshacer.`)){const a={};z.forEach(t=>{a[t.id]={}}),f(g,a),je(),F(`Rotación #${e(C)} limpiada correctamente`,!0)}}function ke(){try{return z.some(a=>{const t=e(g)[a.id];return t&&Object.keys(t).length>0&&Object.values(t).some(n=>Array.isArray(n)&&n.length>0)})}catch(a){return!1}}function We(){try{let a=0;return z.forEach(t=>{const n=e(g)[t.id];n&&Object.values(n).forEach(i=>{Array.isArray(i)&&(a+=i.filter(d=>typeof d=="string"&&!d.includes("Faltan")).length)})}),a}catch(a){return console.error("Error calculando asignaciones totales:",a),0}}function Xe(){return L(this,null,function*(){try{f(B,!0),yield q(),F("Datos actualizados correctamente",!0)}catch(a){console.error("❌ Error recargando datos:",a),F("Error al actualizar datos",!1)}finally{f(B,!1)}})}function ba(){if(!ke()){F("No hay asignaciones para analizar",!1);return}const a=Sa();a.totalConsecutives===0?F("¡Excelente! No hay días consecutivos detectados",!0):F(`Se detectaron ${a.totalConsecutives} días consecutivos.`,!1)}function Sa(){const a={consecutivesByCollaborator:new Map,totalConsecutives:0},t=["monday","tuesday","wednesday","thursday","friday"],n=new Map;return t.forEach((i,d)=>{const b=e(g)[i]||{};Object.entries(b).forEach(([k,S])=>{Array.isArray(S)&&S.forEach(x=>{n.has(x)||n.set(x,new Array(5).fill(null));const A=n.get(x);A[d]===null&&(A[d]=[]),A[d].push(k)})})}),n.forEach((i,d)=>{const b=[];for(let k=0;k<i.length-1;k++){const S=i[k]||[],x=i[k+1]||[];S.forEach(A=>{x.includes(A)&&(b.push({role:A,days:[t[k],t[k+1]]}),a.totalConsecutives++)})}a.consecutivesByCollaborator.set(d,{count:b.length,details:b})}),a}function ua(){if(!ke()){F("No hay asignaciones para analizar",!1);return}const a=ya();w(a)}function ya(){const a={totalAssignments:0,collaboratorStats:new Map,consecutiveIssues:[],roleRepetitionIssues:[],recommendations:[]},t=new ha;return t.initializeFromExistingAssignments(e(g)),e(v).forEach(n=>{const i=va(n.name,t);a.collaboratorStats.set(n.name,i),a.totalAssignments+=i.totalAssignments}),a.consecutiveIssues=Je(),a.roleRepetitionIssues=Qe(t),a.recommendations=p(a),a}function va(a,t){const n={totalAssignments:0,rolesAssigned:new Set,consecutiveDays:0,roleRepetitions:0,diversityScore:0},i=t.getWeeklyRoles(a),d=ja(a,e(g));return n.totalAssignments=d.flat().length,n.rolesAssigned=i,n.totalAssignments>i.size&&(n.roleRepetitions=n.totalAssignments-i.size),n.totalAssignments>0&&(n.diversityScore=i.size/n.totalAssignments*100),n}function Qe(a){const t=[];return e(v).forEach(n=>{const i=a.getWeeklyRoles(n.name),b=ja(n.name,e(g)).flat().length;if(b>i.size){const k=b-i.size;t.push({collaborator:n.name,repetitions:k,totalAssignments:b,uniqueRoles:i.size,severity:k>2?"high":k>1?"medium":"low"})}}),t}function Je(){const a=[];return e(v).forEach(t=>{const n=ja(t.name,e(g));for(let i=0;i<n.length-1;i++){const d=n[i],b=n[i+1],k=d.filter(S=>b.includes(S));k.length>0&&a.push({collaborator:t.name,days:[z[i].name,z[i+1].name],roles:k,severity:k.length>1?"high":"medium"})}}),a}function p(a){const t=[];if(a.consecutiveIssues.length>0){const i=a.consecutiveIssues.filter(d=>d.severity==="high");i.length>0&&t.push({type:"consecutive",priority:"high",message:`${i.length} colaboradores con múltiples días consecutivos.`,action:"Revisar asignaciones manualmente"})}if(a.roleRepetitionIssues.length>0){const i=a.roleRepetitionIssues.reduce((b,k)=>b+k.repetitions,0),d=a.roleRepetitionIssues.filter(b=>b.severity==="high");d.length>0&&t.push({type:"roleRepetition",priority:"medium",message:`${d.length} colaboradores repiten roles múltiples veces (${i} repeticiones totales).`,action:"Regenerar rotación para mejor distribución"})}const n=[];for(const[i,d]of a.collaboratorStats)d.diversityScore<50&&d.totalAssignments>2&&n.push({collaborator:i,score:d.diversityScore});return n.length>0&&t.push({type:"diversity",priority:"low",message:`${n.length} colaboradores con baja diversidad de roles.`,action:"Considerar redistribuir para mayor variedad"}),t}function w(a){let t=`Análisis de Rotación #${e(C)}:

`;if(t+=`📊 Resumen:
`,t+=`• Total asignaciones: ${a.totalAssignments}
`,t+=`• Días consecutivos: ${a.consecutiveIssues.length} problemas
`,a.roleRepetitionIssues&&a.roleRepetitionIssues.length>0){const n=a.roleRepetitionIssues.reduce((d,b)=>d+b.repetitions,0);t+=`• Repeticiones de roles: ${n} casos
`;const i=a.collaboratorStats.size-a.roleRepetitionIssues.length;t+=`• Colaboradores sin repetir: ${i}/${a.collaboratorStats.size}
`}t+=`
`,a.recommendations.length>0?(t+=`💡 Recomendaciones:
`,a.recommendations.forEach(n=>{const i=n.priority==="high"?"🔴":n.priority==="medium"?"🟡":"🟢";t+=`${i} ${n.message}
`})):t+="✅ ¡Rotación bien optimizada!",F(t,a.recommendations.length===0)}function G(){if(typeof window!="undefined"&&window.location.hostname==="localhost"){if(console.group("🔍 Estado Actual de la Rotación"),console.log("📅 Información de la Rotación:",{number:e(C),dates:e(y),firstRotation:e(O)}),console.log("👥 Colaboradores:",e(v).length),console.log("🎭 Roles:",e(l).length),console.log("🔗 Roles agrupados:",R),console.log("📋 Asignaciones actuales:",e(g)),ke()){const a=new ha;a.initializeFromExistingAssignments(e(g));const t=a.getWeeklyDiversityStats();console.log("📊 Estadísticas de diversidad:",t);const n=Za(e(g));console.log("🎯 Evaluación de calidad:",n)}console.groupEnd()}}Wa(()=>(e(_),e(g)),()=>{e(_)&&e(g)&&je()}),Wa(()=>(e(_),e(l)),()=>{e(_)&&e(l).length>0&&q()}),Lo(),so();var X=fi(),ae=c(r(X),2),pe=r(ae),xe=r(pe),qe=r(xe),le=c(qe,2),he=r(le),ye=r(he,!0);s(he);var Ee=c(he,2),Ie=r(Ee,!0);s(Ee);var _e=c(Ee,2),de=r(_e),ce=r(de),Ae=r(ce);s(ce);var Se=c(ce,2),ie=r(Se,!0);s(Se),s(de);var te=c(de,2);{var we=a=>{var t=In(),n=r(t);s(t),Y((i,d)=>T(n,`${i!=null?i:""} - ${d!=null?d:""}`),[()=>Me(e(y).monday),()=>Me(e(y).friday)],He),E(a,t)};U(te,a=>{e(y)&&e(y).monday&&e(y).friday&&a(we)})}var ue=c(te,2);{var Ce=a=>{var t=qn();E(a,t)};U(ue,a=>{e(C)===1&&!e(O)&&a(Ce)})}var be=c(ue,2);{var De=a=>{var t=On(),n=c(r(t),2),i=r(n);s(n),s(t),Y(d=>T(i,`Iniciado el ${d!=null?d:""}`),[()=>Me(e(O))],He),E(a,t)};U(be,a=>{e(O)&&a(De)})}s(_e),s(le);var na=c(le,2);s(xe);var Ze=c(xe,2),Ca=r(Ze);{var it=a=>{var t=zn(),n=Dt(t),i=r(n);s(n),Ma(2),Y(d=>Xa(i,`width: ${d!=null?d:""}%`),[()=>(new Date().getDay()||7)/7*100],He),E(a,t)},lt=(a,t)=>{{var n=d=>{var b=Fn();Ma(2),E(d,b)},i=d=>{var b=Bn();Ma(2),E(d,b)};U(a,d=>{Ve().isFutureWeek?d(n):d(i,!1)},t)}};U(Ca,a=>{Ve().isCurrentWeek?a(it):a(lt,!1)})}s(Ze);var Pa=c(Ze,2),Ct=r(Pa);{var xt=a=>{var t=Nn();E(a,t)};U(Ct,a=>{e(O)||a(xt)})}var ct=c(Ct,2);{var Ga=a=>{var t=Ln(),n=c(r(t),2),i=r(n);s(n),s(t),Y(d=>T(i,`${d!=null?d:""} asignaciones realizadas`),[We],He),E(a,t)},Ue=a=>{var t=jn();E(a,t)};U(ct,a=>{ke()?a(Ga):a(Ue,!1)})}s(Pa),s(pe);var $a=c(pe,2);{var Rt=a=>{var t=Pn(),n=r(t),i=c(n);s(t),Y(()=>{var d,b;ca(t,1,`status-message ${(d=e(ne)?"success":"error")!=null?d:""}`),T(n,`${(b=e(P))!=null?b:""} `)}),I("click",i,()=>f(se,!1)),E(a,t)};U($a,a=>{e(se)&&a(Rt)})}var ao=c($a,2),Ta=r(ao);{var kt=a=>{var t=Wn(),n=c(r(t),2),i=c(r(n),2);{var d=S=>{var x=Gn();x.textContent=generationStep,E(S,x)};U(i,S=>{generationStep&&S(d)})}var b=c(i,2);{var k=S=>{var j;var x=Hn(),A=Dt(x),oe=r(A);Xa(oe,`width: ${generationProgress!=null?generationProgress:""}%`),s(A);var ge=c(A,2);ge.textContent=`${(j=Math.round(generationProgress))!=null?j:""}%`,E(S,x)};U(b,S=>{generationProgress>0&&S(k)})}s(n),s(t),E(a,t)};U(Ta,a=>{e(B)&&a(kt)})}var lo=c(Ta,2),dt=r(lo),Et=r(dt),po=c(r(Et));oa(po,1,()=>z,wa,(a,t)=>{var n=Jn(),i=r(n,!0);s(n),Y(()=>T(i,e(t).name)),E(a,n)}),s(Et),s(dt);var co=c(dt),bs=r(co);{var ys=a=>{var t=ns(),n=Dt(t);oa(n,1,()=>e(l),i=>i.id||i.name,(i,d)=>{var b=Qn(),k=r(b),S=r(k),x=r(S),A=r(x,!0);s(x);var oe=c(x,2);{var ge=ea=>{var Ne=Un();E(ea,Ne)};U(oe,ea=>{e(d).priority===2&&ea(ge)})}var j=c(oe,2),re=r(j),Be=r(re);s(re);var ze=c(re,2),_a=r(ze);s(ze),s(j),s(S),s(k);var Aa=c(k);oa(Aa,1,()=>z,ea=>ea.id,(ea,Ne)=>{var Ua=Xn(),ut=r(Ua);{var At=Oe=>{var Ke=Yn();E(Oe,Ke)},Fe=(Oe,Ke)=>{{var xa=aa=>{var Pe=Vn(),fa=r(Pe),Ia=r(fa),Ya=r(Ia,!0);s(Ia),s(fa),s(Pe),Y((Ha,za,Va,to)=>{ca(Pe,1,`assignment-button assigned ${Ha!=null?Ha:""} 
                        ${za!=null?za:""}
                        ${Va!=null?Va:""}`),T(Ya,to)},[()=>typeof e(g)[e(Ne).id][e(d).name]=="string"&&e(g)[e(Ne).id][e(d).name].includes("Sin")?"warning":"",()=>typeof e(g)[e(Ne).id][e(d).name]=="string"&&e(g)[e(Ne).id][e(d).name].includes("Faltan")?"incomplete":"",()=>typeof e(g)[e(Ne).id][e(d).name]=="string"&&e(g)[e(Ne).id][e(d).name].includes("Omitido")?"omitted":"",()=>J(e(g)[e(Ne).id][e(d).name])],He),I("click",Pe,()=>St(e(d).name,e(Ne).id)),E(aa,Pe)},ia=aa=>{var Pe=Kn();I("click",Pe,()=>St(e(d).name,e(Ne).id)),E(aa,Pe)};U(Oe,aa=>{e(g)&&e(g)[e(Ne).id]&&e(g)[e(Ne).id][e(d).name]?aa(xa):aa(ia,!1)},Ke)}};U(ut,Oe=>{ve(e(d),e(Ne).id)?Oe(At):Oe(Fe,!1)})}s(Ua),E(ea,Ua)}),s(b),Y(()=>{T(A,e(d).name),T(Be,`Mín: ${e(d).min||1}`),T(_a,`Máx: ${e(d).max||5}`)}),E(i,b)}),E(a,t)},_s=a=>{var t=Zn();E(a,t)};U(bs,a=>{e(l)&&e(l).length>0?a(ys):a(_s,!1)})}s(co),s(lo),s(ao);var ho=c(ao,2),jo=r(ho),bo=r(jo),Po=c(r(bo),2),ws=r(Po,!0);s(Po),s(bo);var yo=c(bo,2),Go=c(r(yo),2),Ss=r(Go,!0);s(Go),s(yo);var _o=c(yo,2),Ho=c(r(_o),2),Cs=r(Ho,!0);s(Ho),s(_o);var wo=c(_o,2),Wo=c(r(wo),2),xs=r(Wo,!0);s(Wo),s(wo);var Rs=c(wo,2);{var ks=a=>{var t=ei(),n=c(r(t),2),i=r(n,!0);s(n),s(t),Y(d=>T(i,d),[()=>Me(e(O))],He),E(a,t)};U(Rs,a=>{e(O)&&a(ks)})}s(jo),s(ho);var Jo=c(ho,2),So=r(Jo),Bt=c(So,2),Co=r(Bt),Es=r(Co,!0);s(Co);var Uo=c(Co,2),As=r(Uo,!0);s(Uo),s(Bt);var xo=c(Bt,2),Ro=c(xo,2),Yo=c(Ro,2);{var Ds=a=>{var t=ai(),n=Dt(t),i=c(n,2);Y(()=>{n.disabled=e(B),i.disabled=e(B)}),I("click",n,ba),I("click",i,ua),E(a,t)};U(Yo,a=>{ke()&&a(Ds)})}var Ms=c(Yo,2);{var $s=a=>{var t=ti();I("click",t,G),E(a,t)};U(Ms,a=>{typeof window!="undefined"&&window.location.hostname==="localhost"&&a($s)})}s(Jo),s(ae);var Ts=c(ae,2);{var Is=a=>{var t=vi(),n=r(t),i=r(n),d=r(i),b=c(r(d),2);{var k=Fe=>{var Oe=oi(),Ke=r(Oe);s(Oe),Y(()=>{var xa,ia;return T(Ke,`para ${(xa=e(Z).name)!=null?xa:""} el ${(ia=e(V).name)!=null?ia:""}`)}),E(Fe,Oe)};U(b,Fe=>{e(Z)&&e(V)&&Fe(k)})}s(d);var S=c(d,2);s(i);var x=c(i,2),A=r(x);{var oe=Fe=>{var Oe=si(),Ke=r(Oe),xa=c(r(Ke),2),ia=r(xa),aa=c(r(ia),2),Pe=r(aa);s(aa),s(ia);var fa=c(ia,2),Ia=c(r(fa),2),Ya=r(Ia,!0);s(Ia),s(fa),s(xa),s(Ke);var Ha=c(Ke,2),za=r(Ha),Va=c(r(za),2),to=r(Va,!0);s(Va),s(za);var Nt=c(za,2),uo=c(r(Nt),2),ko=r(uo,!0);s(uo),s(Nt);var oo=c(Nt,2),Ra=c(r(oo),2),Ka=r(Ra,!0);s(Ra),s(oo);var Vo=c(oo,2),Ko=c(r(Vo),2),qs=r(Ko,!0);s(Ko),s(Vo),s(Ha),s(Oe),Y((vo,Os,zs)=>{var Xo;T(Pe,`#${(Xo=e(C))!=null?Xo:""}`),T(Ya,vo),T(to,e(Z).min||1),T(ko,Os),T(Ka,e(N)?e(N).length:0),T(qs,zs)},[()=>Ve().statusText,()=>{var vo;return $e(e(Z),(vo=e(V))==null?void 0:vo.id)},()=>Math.max(0,(e(Z).min||1)-(e(N)?e(N).length:0))],He),E(Fe,Oe)};U(A,Fe=>{e(Z)&&Fe(oe)})}var ge=c(A,2);{var j=Fe=>{var Oe=ni(),Ke=r(Oe),xa=c(r(Ke));s(Ke);var ia=c(Ke,2);oa(ia,5,()=>e(N),wa,(aa,Pe)=>{var fa=ri(),Ia=r(fa),Ya=r(Ia,!0);s(Ia);var Ha=c(Ia,2);s(fa),Y(()=>T(Ya,e(Pe))),I("click",Ha,()=>W(e(Pe))),E(aa,fa)}),s(ia),s(Oe),Y(()=>{var aa;return T(xa,` Colaboradores asignados (${(aa=e(N).length)!=null?aa:""}):`)}),E(Fe,Oe)};U(ge,Fe=>{e(N)&&e(N).length>0&&Fe(j)})}var re=c(ge,2);{var Be=Fe=>{var Oe=di(),Ke=r(Oe),xa=c(r(Ke));s(Ke);var ia=c(Ke,2);oa(ia,5,()=>e(me),wa,(aa,Pe)=>{var fa=ci(),Ia=r(fa),Ya=r(Ia),Ha=r(Ya,!0);s(Ya);var za=c(Ya,2),Va=r(za),to=r(Va,!0);s(Va),Ma(2),s(za);var Nt=c(za,2);{var uo=Ra=>{var Ka=ii();E(Ra,Ka)};U(Nt,Ra=>{e(Pe).unavailableDays&&Object.values(e(Pe).unavailableDays).some(Ka=>Ka)&&Ra(uo)})}var ko=c(Nt,2);{var oo=Ra=>{var Ka=li();E(Ra,Ka)};U(ko,Ra=>{e(N)&&e(N).includes(e(Pe).name)&&Ra(oo)})}s(Ia),s(fa),Y((Ra,Ka)=>{ca(fa,1,`collaborator-item ${Ra!=null?Ra:""}`),Fa(fa,"title",Ka),T(Ha,e(Pe).name),T(to,e(Pe).certifications?e(Pe).certifications.length:0)},[()=>e(N)&&e(N).includes(e(Pe).name)?"already-assigned":"available",()=>e(N)&&e(N).includes(e(Pe).name)?"Ya asignado":"Clic para asignar"],He),I("click",fa,()=>$(e(Pe).name)),E(aa,fa)}),s(ia),s(Oe),Y(()=>{var aa;return T(xa,` Colaboradores disponibles (${(aa=e(me).length)!=null?aa:""}):`)}),E(Fe,Oe)},ze=Fe=>{var Oe=ui();E(Fe,Oe)};U(re,Fe=>{e(me)&&e(me).length>0?Fe(Be):Fe(ze,!1)})}s(x);var _a=c(x,2),Aa=r(_a),ea=r(Aa),Ne=r(ea);{var Ua=Fe=>{var Oe=Ps();Y(()=>{var Ke,xa,ia;return T(Oe,`Rotación #${(Ke=e(C))!=null?Ke:""} • ${(xa=e(Z).name)!=null?xa:""} • ${(ia=e(V).name)!=null?ia:""}`)}),E(Fe,Oe)};U(Ne,Fe=>{e(Z)&&e(V)&&Fe(Ua)})}s(ea),s(Aa);var ut=c(Aa,2),At=r(ut);s(ut),s(_a),s(n),s(t),I("click",S,m),I("click",At,m),I("click",n,jt(function(Fe){Pt.call(this,o,Fe)})),I("click",t,m),E(a,t)};U(Ts,a=>{e(Q)&&a(Is)})}s(X),Y((a,t,n,i,d,b,k,S)=>{var x;ca(pe,1,`rotation-header ${a!=null?a:""}`),qe.disabled=e(C)<=1,T(ye,t),T(Ie,n),T(Ae,`Rotación #${(x=e(C))!=null?x:""}`),ca(Se,1,`week-status ${i!=null?i:""}`),T(ie,d),T(ws,e(l)?e(l).length:0),T(Ss,e(v)?e(v).length:0),T(Cs,e(h)?e(h).length:0),T(xs,b),So.disabled=e(B),Bt.disabled=e(B)||!e(l).length||!e(v).length,Fa(Bt,"title",e(O)?"Generar nueva rotación automáticamente":"Generar primera rotación y establecer calendario"),T(Es,e(O)?"✨":"🎯"),T(As,e(O)?"Generar Rotación":"Iniciar Sistema"),xo.disabled=k,Ro.disabled=S},[()=>Ve().isCurrentWeek?"current-week":Ve().isFutureWeek?"future-week":"past-week",Oa,ka,()=>Ve().isCurrentWeek?"current":Ve().isFutureWeek?"future":"past",()=>Ve().statusText,We,()=>e(B)||!ke(),()=>e(B)||!ke()],He),I("click",qe,pa),I("click",na,ma),I("click",So,Xe),I("click",Bt,Vt),I("click",xo,tt),I("click",Ro,Te),E(u,X),no()}var mi=D('<div class="loading-overlay svelte-1jgu8eq"><div class="spinner svelte-1jgu8eq"></div> <p class="svelte-1jgu8eq">Cambiando de equipo...</p></div>'),pi=D('<div class="dashboard-grid svelte-1jgu8eq"><div class="grid-item roles-section svelte-1jgu8eq"><!></div> <div class="grid-item collaborators-section svelte-1jgu8eq"><!></div> <div class="grid-item rotation-section svelte-1jgu8eq"><!></div></div>'),hi=D('<main class="svelte-1jgu8eq"><!> <div class="background-gradient svelte-1jgu8eq"></div> <div class="content-wrapper svelte-1jgu8eq"><header class="svelte-1jgu8eq"><h1 class="svelte-1jgu8eq">Área de Soporte QA</h1> <p class="svelte-1jgu8eq"> </p></header> <!> <div class="actions svelte-1jgu8eq"><button class="back-button svelte-1jgu8eq"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="back-icon svelte-1jgu8eq"><path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path><path d="M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg> Volver al inicio</button></div></div> <div class="copyright svelte-1jgu8eq"><p class="svelte-1jgu8eq">Creado por José Ismael Morales Uriarte para Edwards Lifescienses CR</p></div></main>');function Ei(u,o){ro(o,!1);const l=!0,v=!1,h="always";let _=K(0),R=K(!1),g=!1;const P=go.subscribe(M=>L(this,null,function*(){if(M!==e(_)&&!g){g=!0,f(R,!0);try{yield Re.switchTeam(M),f(_,M)}catch(ee){console.error("Error cambiando de equipo:",ee)}finally{f(R,!1),g=!1}}}));function ne(){hr("/")}io(()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"));const M=document.querySelector("main");if(M){const ee=document.createElement("div");ee.className="custom-scrollbar-track",ee.style.position="fixed",ee.style.top="0",ee.style.right="0",ee.style.width="10px",ee.style.height="100%",ee.style.background="rgba(0, 0, 0, 0.1)",ee.style.zIndex="9999";const H=document.createElement("div");H.className="custom-scrollbar-thumb",H.style.position="absolute",H.style.top="0",H.style.right="0",H.style.width="6px",H.style.borderRadius="3px",H.style.background="rgba(52, 152, 219, 0.5)",H.style.cursor="pointer",H.style.transition="all 0.2s",H.style.zIndex="10000",H.style.minHeight="50px",H.style.opacity="0.5",H.style.boxShadow="0 0 3px rgba(0, 0, 0, 0.2)",H.addEventListener("mouseenter",()=>{H.style.width="8px",H.style.background="rgba(52, 152, 219, 0.8)",H.style.opacity="0.9"}),H.addEventListener("mouseleave",()=>{Le||(H.style.width="6px",H.style.background="rgba(52, 152, 219, 0.5)",H.style.opacity="0.5")}),ee.appendChild(H),document.body.appendChild(ee);const q=()=>{const Ye=M.scrollHeight/M.clientHeight,Ge=Math.max(50,M.clientHeight/Ye);H.style.height=`${Ge}px`;const da=M.scrollTop/(M.scrollHeight-M.clientHeight)*(M.clientHeight-Ge);H.style.top=`${da}px`};q(),M.addEventListener("scroll",q),ee.addEventListener("click",Ye=>{if(Ye.target===ee){const Ge=Ye.clientY,Me=ee.getBoundingClientRect(),da=parseFloat(H.style.height),Oa=Me.height;let ka;Ge<Me.top+da/2?ka=0:Ge>Me.bottom-da/2?ka=M.scrollHeight-M.clientHeight:ka=(Ge-Me.top-da/2)/(Oa-da)*(M.scrollHeight-M.clientHeight),M.scrollTo({top:ka,behavior:"smooth"})}});let Le=!1,je=0,sa=0;H.addEventListener("mousedown",Ye=>{Le=!0,je=Ye.clientY,sa=M.scrollTop,H.style.width="8px",H.style.background="rgba(52, 152, 219, 1)",H.style.opacity="1",H.style.boxShadow="0 0 8px rgba(52, 152, 219, 0.5)",document.body.style.userSelect="none",Ye.preventDefault()}),document.addEventListener("mousemove",Ye=>{if(!Le)return;const Ge=Ye.clientY-je,Me=ee.clientHeight,da=parseFloat(H.style.height),ka=Ge/(Me-da)*(M.scrollHeight-M.clientHeight);M.scrollTop=Math.max(0,Math.min(sa+ka,M.scrollHeight-M.clientHeight))}),document.addEventListener("mouseup",()=>{Le&&(Le=!1,H.style.width="6px",H.style.background="rgba(52, 152, 219, 0.5)",H.style.opacity="0.5",H.style.boxShadow="0 0 3px rgba(0, 0, 0, 0.2)",document.body.style.userSelect="")}),window.addEventListener("resize",q);const ra=()=>{M.scrollHeight>M.clientHeight?(ee.style.display="block",q()):ee.style.display="none"};ra(),new ResizeObserver(()=>{ra()}).observe(M);let ma;const pa=()=>{H.style.opacity="0.5",ee.style.opacity="1",clearTimeout(ma),ma=setTimeout(()=>{!Le&&!H.matches(":hover")&&(H.style.opacity="0.2",ee.style.opacity="0.5")},1500)};M.addEventListener("mousemove",pa),M.addEventListener("scroll",pa),pa()}},100)}),mo(()=>{P()}),so();var se=hi(),B=r(se);Ir(B,{});var C=c(B,4),y=r(C),O=c(r(y),2),z=r(O);s(O),s(y);var Q=c(y,2);{var Z=M=>{var ee=mi();E(M,ee)},V=M=>{var ee=ns(),H=Dt(ee);br(H,()=>e(_),q=>{var Le=pi(),je=r(Le),sa=r(je);tn(sa,{}),s(je);var ra=c(je,2),Ba=r(ra);Tn(Ba,{}),s(ra);var ma=c(ra,2),pa=r(ma);gi(pa,{}),s(ma),s(Le),E(q,Le)}),E(M,ee)};U(Q,M=>{e(R)?M(Z):M(V,!1)})}var me=c(Q,2),N=r(me);return s(me),s(C),Ma(2),s(se),Y(()=>T(z,`Control inteligente de turnos y horarios - Equipo ${e(_)+1}`)),I("click",N,ne),E(u,se),Io(o,"prerender",l),Io(o,"ssr",v),Io(o,"trailingSlash",h),no({prerender:l,ssr:v,trailingSlash:h})}export{Ei as component};
